import{J as K,r as w,q as f}from"./main-DU5QQqOg.js";import{a as d}from"./index-B9ygI19o.js";const Q=K("invoices",()=>{const l=w([]),c=w(null),i=w(!1),o=w(null),h=w(""),y=w(null),I=f(()=>l.value.filter(e=>e.status==="draft")),F=f(()=>l.value.filter(e=>["sent","viewed"].includes(e.status))),b=f(()=>l.value.filter(e=>e.status==="paid")),g=f(()=>l.value.filter(e=>e.status==="overdue")),x=f(()=>{if(!h.value)return l.value;const e=h.value.toLowerCase();return l.value.filter(n=>{var a,t,r;return((a=n.invoice_number)==null?void 0:a.toLowerCase().includes(e))||((t=n.client_name)==null?void 0:t.toLowerCase().includes(e))||((r=n.project_name)==null?void 0:r.toLowerCase().includes(e))})}),L=f(()=>l.value.length),$=f(()=>l.value.filter(e=>["sent","viewed","overdue"].includes(e.status)).reduce((e,n)=>e+parseFloat(n.total||0),0)),m={draft:["sent","cancelled"],sent:["viewed","paid","overdue","cancelled"],viewed:["paid","overdue","cancelled"],paid:[],overdue:["paid","cancelled"],cancelled:[]};async function j(e={}){var n,a;i.value=!0,o.value=null;try{const t=await d.get("/api/invoices",{params:e});return l.value=t.data.data||[],l.value}catch(t){throw o.value=((a=(n=t.response)==null?void 0:n.data)==null?void 0:a.error)||"Failed to fetch invoices",t}finally{i.value=!1}}async function k(e){var n,a;i.value=!0,o.value=null;try{const t=await d.get(`/api/invoices/${e}`);return c.value=t.data.data,c.value}catch(t){throw o.value=((a=(n=t.response)==null?void 0:n.data)==null?void 0:a.error)||"Failed to fetch invoice",t}finally{i.value=!1}}async function T(e){var n,a;i.value=!0,o.value=null;try{const r=(await d.post("/api/invoices",e)).data.data;return l.value.unshift(r),r}catch(t){throw o.value=((a=(n=t.response)==null?void 0:n.data)==null?void 0:a.error)||"Failed to create invoice",t}finally{i.value=!1}}async function C(e,n){var a,t,r;i.value=!0,o.value=null;try{const u=(await d.put(`/api/invoices/${e}`,n)).data.data,v=l.value.findIndex(p=>p.id===e);return v!==-1&&(l.value[v]=u),((a=c.value)==null?void 0:a.id)===e&&(c.value=u),u}catch(s){throw o.value=((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to update invoice",s}finally{i.value=!1}}async function P(e){var n,a,t;i.value=!0,o.value=null;try{return await d.delete(`/api/invoices/${e}`),l.value=l.value.filter(r=>r.id!==e),((n=c.value)==null?void 0:n.id)===e&&(c.value=null),!0}catch(r){throw o.value=((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.error)||"Failed to delete invoice",r}finally{i.value=!1}}async function R(e,n){var a,t,r;i.value=!0,o.value=null;try{const u=(await d.post(`/api/invoices/${e}/status`,{status:n})).data.data,v=l.value.findIndex(p=>p.id===e);return v!==-1&&(l.value[v]=u),((a=c.value)==null?void 0:a.id)===e&&(c.value=u),u}catch(s){throw o.value=((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to update status",s}finally{i.value=!1}}async function S(e,n={}){var a,t,r;i.value=!0,o.value=null;try{const s=await d.post(`/api/invoices/${e}/send`,n),u=s.data.data,v=l.value.findIndex(p=>p.id===e);return v!==-1&&(l.value[v]=u),((a=c.value)==null?void 0:a.id)===e&&(c.value=u),s.data}catch(s){throw o.value=((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to send invoice",s}finally{i.value=!1}}async function U(e,n={}){var a,t;i.value=!0,o.value=null;try{return(await d.post(`/api/invoices/${e}/resend`,n)).data}catch(r){throw o.value=((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.error)||"Failed to resend invoice",r}finally{i.value=!1}}async function O(e,n={}){var a,t,r;i.value=!0,o.value=null;try{const u=(await d.post(`/api/invoices/${e}/mark-paid`,n)).data.data,v=l.value.findIndex(p=>p.id===e);return v!==-1&&(l.value[v]=u),((a=c.value)==null?void 0:a.id)===e&&(c.value=u),u}catch(s){throw o.value=((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to mark as paid",s}finally{i.value=!1}}async function _(e){var n,a;try{const t=await d.get(`/api/invoices/${e}/pdf`,{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=r;const u=t.headers["content-disposition"];let v=`invoice-${e}.pdf`;if(u){const p=u.match(/filename="?(.+)"?/);p&&(v=p[1])}return s.setAttribute("download",v),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(r),!0}catch(t){throw o.value=((a=(n=t.response)==null?void 0:n.data)==null?void 0:a.error)||"Failed to download PDF",t}}async function D(e){var n,a;try{const t=await d.get(`/api/invoices/${e}/preview`,{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([t.data],{type:"application/pdf"}));return window.open(r,"_blank"),r}catch(t){throw o.value=((a=(n=t.response)==null?void 0:n.data)==null?void 0:a.error)||"Failed to preview PDF",t}}async function A(){var e,n;try{const a=await d.get("/api/invoices/stats");return y.value=a.data.data,y.value}catch(a){throw o.value=((n=(e=a.response)==null?void 0:e.data)==null?void 0:n.error)||"Failed to fetch stats",a}}async function B(){var e,n;i.value=!0,o.value=null;try{return(await d.get("/api/invoices/overdue")).data.data||[]}catch(a){throw o.value=((n=(e=a.response)==null?void 0:e.data)==null?void 0:n.error)||"Failed to fetch overdue invoices",a}finally{i.value=!1}}async function E(e,n={}){var a,t;i.value=!0,o.value=null;try{const s=(await d.post("/api/invoices/from-project",{project_id:e,...n})).data.data;return l.value.unshift(s),s}catch(r){throw o.value=((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.error)||"Failed to create invoice from project",r}finally{i.value=!1}}function q(e,n){return(m[e]||[]).includes(n)}function J(e){return m[e]||[]}function z(e){h.value=e}function G(){o.value=null}function H(){l.value=[],c.value=null,i.value=!1,o.value=null,h.value="",y.value=null}return{invoices:l,currentInvoice:c,loading:i,error:o,searchTerm:h,stats:y,draftInvoices:I,sentInvoices:F,paidInvoices:b,overdueInvoices:g,filteredInvoices:x,invoiceCount:L,totalOutstanding:$,fetchInvoices:j,fetchInvoice:k,createInvoice:T,updateInvoice:C,deleteInvoice:P,updateStatus:R,sendInvoice:S,resendInvoice:U,markPaid:O,downloadPdf:_,previewPdf:D,fetchStats:A,fetchOverdue:B,createFromProject:E,canTransitionTo:q,getAvailableStatuses:J,setSearchTerm:z,clearError:G,reset:H}});export{Q as u};
