import{_ as F,b as H,h as D,i as b,r as y,k as v,o as n,e as t,d as x,c as d,l as w,j as _,t as l,F as I,g as L,n as C}from"./main-Dw3b53V2.js";import{a as p}from"./index-B9ygI19o.js";import{A as z}from"./AdminLayout-C6ZnkvFv.js";const T={__name:"CsvHistory",setup(S,{expose:e}){e();const u=y(!1),r=y(null),m=y([]),k=y(null);async function c(){var s,o;u.value=!0,r.value=null;try{const[i,g]=await Promise.all([p.get("/api/csv/imports"),p.get("/api/csv/import/statistics")]);m.value=i.data||[],k.value=g.data||{}}catch(i){r.value=((o=(s=i.response)==null?void 0:s.data)==null?void 0:o.error)||"Failed to load import history"}finally{u.value=!1}}async function a(s){var o,i;if(confirm("Cancel this import?"))try{await p.post(`/api/csv/import/${s.id}/cancel`),await c()}catch(g){alert(((i=(o=g.response)==null?void 0:o.data)==null?void 0:i.error)||"Failed to cancel import")}}async function f(s){var o,i;if(confirm("Delete this import record?"))try{await p.delete(`/api/csv/import/${s.id}`),await c()}catch(g){alert(((i=(o=g.response)==null?void 0:o.data)==null?void 0:i.error)||"Failed to delete import")}}function B(s){return s?s<1024?s+" B":s<1024*1024?(s/1024).toFixed(1)+" KB":(s/(1024*1024)).toFixed(1)+" MB":"0 B"}function V(s){return s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"â€”"}function j(s){const o={clients:"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400",contacts:"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400",notes:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400"};return o[s]||o.clients}function M(s){const o={pending:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400",processing:"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400",completed:"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400",partial:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400",failed:"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400",cancelled:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"};return o[s]||o.pending}v(()=>c());const h={loading:u,error:r,imports:m,stats:k,loadHistory:c,cancelImport:a,deleteImport:f,formatFileSize:B,formatDate:V,getTypeClasses:j,getStatusClasses:M,ref:y,onMounted:v,get axios(){return p},AdminLayout:z};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}},A={class:"space-y-6"},N={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},R={class:"flex items-center gap-2"},E={key:0,class:"grid grid-cols-2 md:grid-cols-4 gap-4"},P={class:"p-4 rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-900"},K={class:"text-2xl font-bold text-gray-900 dark:text-white"},O={class:"p-4 rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-900"},U={class:"text-2xl font-bold text-green-600"},q={class:"p-4 rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-900"},G={class:"text-2xl font-bold text-red-600"},J={class:"p-4 rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-900"},Q={class:"text-2xl font-bold text-blue-600"},W={class:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},X={key:0,class:"p-8 text-center"},Y={key:1,class:"p-8 text-center"},Z={class:"text-sm text-red-700 dark:text-red-400"},$={key:2,class:"p-8 text-center"},tt={key:3,class:"min-w-full"},et={class:"divide-y divide-gray-200 dark:divide-gray-700"},rt={class:"px-5 py-4"},st={class:"flex items-center gap-2"},at={class:"text-sm font-medium text-gray-900 dark:text-white"},ot={class:"text-xs text-gray-500"},lt={class:"px-5 py-4"},nt={class:"px-5 py-4"},dt={key:0,class:"w-2 h-2 rounded-full bg-current animate-pulse"},it={class:"px-5 py-4"},ct={class:"text-sm"},xt={class:"text-green-600"},gt={class:"text-gray-600 dark:text-gray-300"},yt={key:0,class:"text-red-600 ml-1"},pt={class:"px-5 py-4 text-sm text-gray-600 dark:text-gray-300"},ut={class:"px-5 py-4"},mt={class:"flex items-center justify-end gap-2"},kt=["onClick"],ft=["onClick"];function bt(S,e,u,r,m,k){const c=H("router-link");return n(),D(r.AdminLayout,null,{default:b(()=>[t("div",A,[t("div",N,[e[2]||(e[2]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Import History"),t("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"View past CSV import operations")],-1)),t("div",R,[w(c,{to:"/crm/csv/import",class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-brand-600 rounded-lg hover:bg-brand-700"},{default:b(()=>[...e[0]||(e[0]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1),_(" New Import ",-1)])]),_:1}),w(c,{to:"/crm/csv/export",class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700"},{default:b(()=>[...e[1]||(e[1]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),_(" Export Data ",-1)])]),_:1})])]),x(" Statistics "),r.stats?(n(),d("div",E,[t("div",P,[t("p",K,l(r.stats.total_imports||0),1),e[3]||(e[3]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Total Imports",-1))]),t("div",O,[t("p",U,l(r.stats.successful_imports||0),1),e[4]||(e[4]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Successful",-1))]),t("div",q,[t("p",G,l(r.stats.failed_imports||0),1),e[5]||(e[5]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Failed",-1))]),t("div",J,[t("p",Q,l(r.stats.total_records_imported||0),1),e[6]||(e[6]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Records Imported",-1))])])):x("v-if",!0),x(" History Table "),t("div",W,[r.loading?(n(),d("div",X,[...e[7]||(e[7]=[t("div",{class:"inline-block w-8 h-8 border-4 border-brand-500 border-t-transparent rounded-full animate-spin"},null,-1),t("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"Loading history...",-1)])])):r.error?(n(),d("div",Y,[t("p",Z,l(r.error),1),t("button",{onClick:r.loadHistory,class:"mt-2 text-sm text-brand-600 hover:underline"},"Try again")])):r.imports.length===0?(n(),d("div",$,[...e[8]||(e[8]=[t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),t("p",{class:"mt-2 text-sm text-gray-900 dark:text-white font-medium"},"No imports yet",-1),t("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"Start by importing a CSV file",-1)])])):(n(),d("table",tt,[e[13]||(e[13]=t("thead",null,[t("tr",{class:"border-b border-gray-200 dark:border-gray-700"},[t("th",{class:"px-5 py-3 text-left"},[t("p",{class:"font-medium text-gray-500 text-xs dark:text-gray-400"},"File")]),t("th",{class:"px-5 py-3 text-left"},[t("p",{class:"font-medium text-gray-500 text-xs dark:text-gray-400"},"Type")]),t("th",{class:"px-5 py-3 text-left"},[t("p",{class:"font-medium text-gray-500 text-xs dark:text-gray-400"},"Status")]),t("th",{class:"px-5 py-3 text-left"},[t("p",{class:"font-medium text-gray-500 text-xs dark:text-gray-400"},"Records")]),t("th",{class:"px-5 py-3 text-left"},[t("p",{class:"font-medium text-gray-500 text-xs dark:text-gray-400"},"Date")]),t("th",{class:"px-5 py-3 text-right"},[t("p",{class:"font-medium text-gray-500 text-xs dark:text-gray-400"},"Actions")])])],-1)),t("tbody",et,[(n(!0),d(I,null,L(r.imports,a=>(n(),d("tr",{key:a.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800/50"},[t("td",rt,[t("div",st,[e[9]||(e[9]=t("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),t("div",null,[t("p",at,l(a.filename),1),t("p",ot,l(r.formatFileSize(a.file_size)),1)])])]),t("td",lt,[t("span",{class:C(["inline-flex items-center px-2.5 py-0.5 text-xs font-medium rounded-full capitalize",r.getTypeClasses(a.entity_type)])},l(a.entity_type),3)]),t("td",nt,[t("span",{class:C(["inline-flex items-center gap-1 px-2.5 py-0.5 text-xs font-medium rounded-full",r.getStatusClasses(a.status)])},[a.status==="processing"?(n(),d("span",dt)):x("v-if",!0),_(" "+l(a.status),1)],2)]),t("td",it,[t("div",ct,[t("span",xt,l(a.rows_imported||0),1),e[10]||(e[10]=t("span",{class:"text-gray-400"}," / ",-1)),t("span",gt,l(a.rows_processed||0),1),a.rows_failed>0?(n(),d("span",yt,"("+l(a.rows_failed)+" failed)",1)):x("v-if",!0)])]),t("td",pt,l(r.formatDate(a.created_at)),1),t("td",ut,[t("div",mt,[a.status==="pending"||a.status==="processing"?(n(),d("button",{key:0,onClick:f=>r.cancelImport(a),class:"p-1.5 text-gray-600 hover:text-red-600 dark:text-gray-400",title:"Cancel"},[...e[11]||(e[11]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,kt)):x("v-if",!0),t("button",{onClick:f=>r.deleteImport(a),class:"p-1.5 text-gray-600 hover:text-red-600 dark:text-gray-400",title:"Delete"},[...e[12]||(e[12]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ft)])])]))),128))])]))])])]),_:1})}const wt=F(T,[["render",bt],["__file","/home/btafoya/projects/openclient/resources/js/src/views/CRM/CSV/CsvHistory.vue"]]);export{wt as default};
