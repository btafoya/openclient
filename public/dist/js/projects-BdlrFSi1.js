import{J,r as f,q as j}from"./main-DbkULGVR.js";import{a as v}from"./index-B9ygI19o.js";const D=J("projects",()=>{const s=f([]),c=f(null),u=f(!1),o=f(null),h=f(""),p=f("all"),g=j(()=>s.value.filter(e=>e.is_active)),P=j(()=>{let e=s.value;if(h.value){const t=h.value.toLowerCase();e=e.filter(a=>{var r,l,n;return((r=a.name)==null?void 0:r.toLowerCase().includes(t))||((l=a.description)==null?void 0:l.toLowerCase().includes(t))||((n=a.client_name)==null?void 0:n.toLowerCase().includes(t))})}return p.value&&p.value!=="all"&&(e=e.filter(t=>t.status===p.value)),e}),_=j(()=>s.value.length),m=j(()=>g.value.length),F=j(()=>{const e={total:s.value.length,active:0,planning:0,in_progress:0,on_hold:0,completed:0,total_budget:0,total_hours:0};return s.value.forEach(t=>{switch(t.is_active&&e.active++,t.status){case"planning":e.planning++;break;case"in_progress":e.in_progress++;break;case"on_hold":e.on_hold++;break;case"completed":e.completed++;break}t.budget&&(e.total_budget+=parseFloat(t.budget)),t.total_hours&&(e.total_hours+=parseFloat(t.total_hours))}),e});async function w(e=!0){var t,a;u.value=!0,o.value=null;try{const r=await v.get("/api/projects",{params:{active:e}});return s.value=r.data.data||[],s.value}catch(r){throw o.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch projects",r}finally{u.value=!1}}async function b(e){var t,a;u.value=!0,o.value=null;try{const r=await v.get(`/api/projects/${e}`);return c.value=r.data.data,c.value}catch(r){throw o.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch project",r}finally{u.value=!1}}async function x(){var e,t;try{return(await v.get("/api/projects/stats")).data.data}catch(a){throw o.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch statistics",a}}async function S(e){var t,a;u.value=!0,o.value=null;try{const l=(await v.post("/api/projects",e)).data.data;return s.value.push(l),l}catch(r){throw o.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to create project",r}finally{u.value=!1}}async function C(e,t){var a,r,l;u.value=!0,o.value=null;try{const i=(await v.put(`/api/projects/${e}`,t)).data.data,d=s.value.findIndex(y=>y.id===e);return d!==-1&&(s.value[d]=i),((a=c.value)==null?void 0:a.id)===e&&(c.value=i),i}catch(n){throw o.value=((l=(r=n.response)==null?void 0:r.data)==null?void 0:l.error)||"Failed to update project",n}finally{u.value=!1}}async function $(e,t){var a,r,l;u.value=!0,o.value=null;try{const i=(await v.patch(`/api/projects/${e}/status`,{status:t})).data.data,d=s.value.findIndex(y=>y.id===e);return d!==-1&&(s.value[d]=i),((a=c.value)==null?void 0:a.id)===e&&(c.value=i),i}catch(n){throw o.value=((l=(r=n.response)==null?void 0:r.data)==null?void 0:l.error)||"Failed to update project status",n}finally{u.value=!1}}async function k(e){var t,a,r;u.value=!0,o.value=null;try{return await v.delete(`/api/projects/${e}`),s.value=s.value.filter(l=>l.id!==e),((t=c.value)==null?void 0:t.id)===e&&(c.value=null),!0}catch(l){throw o.value=((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to delete project",l}finally{u.value=!1}}async function L(e){var t,a,r;u.value=!0,o.value=null;try{const n=(await v.post(`/api/projects/${e}/toggle-active`)).data.data,i=s.value.findIndex(d=>d.id===e);return i!==-1&&(s.value[i]=n),((t=c.value)==null?void 0:t.id)===e&&(c.value=n),n}catch(l){throw o.value=((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to toggle project status",l}finally{u.value=!1}}async function I(e,t=!0){var a,r;if(!e)return w(t);u.value=!0,o.value=null;try{const l=await v.get("/api/projects",{params:{search:e,active:t}});return s.value=l.data.data||[],s.value}catch(l){throw o.value=((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to search projects",l}finally{u.value=!1}}function E(e){h.value=e}function T(e){p.value=e}function q(){o.value=null}function A(){s.value=[],c.value=null,u.value=!1,o.value=null,h.value="",p.value="all"}return{projects:s,currentProject:c,loading:u,error:o,searchTerm:h,statusFilter:p,activeProjects:g,filteredProjects:P,projectCount:_,activeProjectCount:m,projectStats:F,fetchProjects:w,fetchProject:b,fetchProjectStats:x,createProject:S,updateProject:C,updateProjectStatus:$,deleteProject:k,toggleActive:L,searchProjects:I,setSearchTerm:E,setStatusFilter:T,clearError:q,reset:A}});export{D as u};
