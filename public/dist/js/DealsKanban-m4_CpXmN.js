import{_ as te,b as re,h as ae,i as C,I as K,r as x,u as M,q as S,K as U,k as q,o as l,e,d,c as n,l as E,t as i,w as p,F as _,g as P,z,j,L as B,C as V,n as L,v as D}from"./main-DU5QQqOg.js";import{u as A}from"./pipelines-W5BYDhct.js";import{u as H}from"./deals-CuGBIftD.js";import{A as oe}from"./AdminLayout-k0cXXt9e.js";import"./index-B9ygI19o.js";const se={__name:"DealsKanban",setup(T,{expose:t}){t();const h=K(),r=A(),c=H(),u=x(null),v=x(!1),m=x(!1),f=x(null),b=x(null),a=x(null),o=M({name:"",value:null,expected_close_date:"",priority:"",description:""}),k=S(()=>r.pipelines),O=S(()=>c.kanbanBoard);async function F(){try{await r.fetchPipelines(!0),k.value.length>0&&(u.value=h.query.pipeline_id||k.value[0].id,await w())}catch(s){console.error("Failed to load pipelines:",s)}}async function w(){if(u.value)try{await c.fetchKanbanBoard(u.value),f.value=await c.fetchDealStats(u.value)}catch(s){console.error("Failed to load kanban:",s)}}function R(s,g,y){b.value=g,a.value=y,s.dataTransfer.effectAllowed="move",s.target.classList.add("opacity-50")}function W(s){s.target.classList.remove("opacity-50")}async function I(s,g){if(!b.value||a.value===g)return;const y=b.value,$=a.value;c.updateKanbanLocally($,g,y.id,0);try{await c.moveDeal(y.id,g),f.value=await c.fetchDealStats(u.value)}catch(ee){console.error("Failed to move deal:",ee),await w(),alert("Failed to move deal. Please try again.")}b.value=null,a.value=null}async function G(){var s,g;if(!o.name.trim()){alert("Deal name is required");return}m.value=!0;try{const y={pipeline_id:u.value,name:o.name.trim(),value:o.value||null,expected_close_date:o.expected_close_date||null,priority:o.priority||null,description:o.description.trim()||null};await c.createDeal(y),await w(),o.name="",o.value=null,o.expected_close_date="",o.priority="",o.description="",v.value=!1}catch(y){console.error("Failed to create deal:",y),alert(((g=(s=y.response)==null?void 0:s.data)==null?void 0:g.error)||"Failed to create deal. Please try again.")}finally{m.value=!1}}function J(s){return Number(s||0).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}function Q(s){return s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):""}function X(s){return s?new Date(s)<new Date:!1}function Y(s){const g={low:"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400",medium:"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/20 dark:text-yellow-400",high:"bg-red-100 text-red-600 dark:bg-red-900/20 dark:text-red-400"};return g[s]||g.low}function Z(s){return s>=75?"bg-green-500":s>=50?"bg-yellow-500":s>=25?"bg-orange-500":"bg-gray-400"}U(()=>h.query.pipeline_id,s=>{s&&s!==u.value&&(u.value=s,w())}),q(()=>{F()});const N={route:h,pipelineStore:r,dealStore:c,selectedPipelineId:u,showCreateDeal:v,creatingDeal:m,stats:f,draggedDeal:b,draggedFromStage:a,newDeal:o,pipelines:k,kanbanBoard:O,loadPipelines:F,loadKanban:w,handleDragStart:R,handleDragEnd:W,handleDrop:I,createDeal:G,formatCurrency:J,formatDate:Q,isOverdue:X,getPriorityClasses:Y,getProbabilityColor:Z,ref:x,reactive:M,computed:S,onMounted:q,watch:U,get useRoute(){return K},get usePipelineStore(){return A},get useDealStore(){return H},AdminLayout:oe};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}},le={class:"h-full flex flex-col"},ne={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-6"},de={class:"flex items-center gap-4"},ie={class:"text-2xl font-bold text-gray-900 dark:text-white"},ge={class:"flex gap-3"},ue=["value"],ce={key:0,class:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6"},ye={class:"bg-white dark:bg-white/[0.03] rounded-lg border border-gray-200 dark:border-gray-800 p-4"},be={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-white"},xe={class:"bg-white dark:bg-white/[0.03] rounded-lg border border-gray-200 dark:border-gray-800 p-4"},me={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-white"},fe={class:"bg-white dark:bg-white/[0.03] rounded-lg border border-gray-200 dark:border-gray-800 p-4"},pe={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-white"},ve={class:"bg-white dark:bg-white/[0.03] rounded-lg border border-gray-200 dark:border-gray-800 p-4"},ke={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-white"},we={key:1,class:"flex-1 flex items-center justify-center"},he={class:"flex-1 overflow-x-auto"},_e={class:"inline-flex gap-4 pb-4 min-w-full"},De={class:"flex items-center gap-2"},Ce={class:"font-medium text-gray-900 dark:text-white"},Se={class:"text-xs bg-white/50 dark:bg-gray-800/50 px-2 py-0.5 rounded-full text-gray-600 dark:text-gray-400"},Pe={class:"text-sm font-medium text-gray-600 dark:text-gray-400"},je=["onDrop"],Be=["onDragstart"],Ve={class:"flex items-start justify-between"},Le={key:0,class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},Fe={class:"mt-2 flex items-center justify-between"},Ne={key:0,class:"text-sm font-medium text-gray-700 dark:text-gray-300"},Ke={key:1,class:"text-sm text-gray-400"},Me={key:1,class:"mt-2"},Ue={class:"flex items-center gap-2"},qe={class:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-1.5"},Ee={class:"text-xs text-gray-500 dark:text-gray-400"},ze={key:0,class:"text-center py-8 text-gray-400 dark:text-gray-500"},Ae={class:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto"},He={class:"flex justify-end gap-3 pt-4"},Te=["disabled"],Oe={key:0,class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"};function Re(T,t,h,r,c,u){const v=re("router-link");return l(),ae(r.AdminLayout,null,{default:C(()=>{var m,f,b;return[e("div",le,[d(" Page Header "),e("div",ne,[e("div",de,[E(v,{to:"/pipelines",class:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},{default:C(()=>[...t[10]||(t[10]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),_:1}),e("div",null,[e("h1",ie,i(((f=(m=r.kanbanBoard)==null?void 0:m.pipeline)==null?void 0:f.name)||"Deals"),1),t[11]||(t[11]=e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Drag and drop deals between stages ",-1))])]),e("div",ge,[p(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>r.selectedPipelineId=a),onChange:r.loadKanban,class:"px-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},[(l(!0),n(_,null,P(r.pipelines,a=>(l(),n("option",{key:a.id,value:a.id},i(a.name),9,ue))),128))],544),[[z,r.selectedPipelineId]]),e("button",{onClick:t[1]||(t[1]=a=>r.showCreateDeal=!0),class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-brand-600 rounded-lg hover:bg-brand-700"},[...t[12]||(t[12]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),j(" New Deal ",-1)])])])]),d(" Stats Bar "),r.stats?(l(),n("div",ce,[e("div",ye,[t[13]||(t[13]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Total Deals",-1)),e("p",be,i(r.stats.total_deals),1)]),e("div",xe,[t[14]||(t[14]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Pipeline Value",-1)),e("p",me,"$"+i(r.formatCurrency(r.stats.total_value)),1)]),e("div",fe,[t[15]||(t[15]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Weighted Value",-1)),e("p",pe,"$"+i(r.formatCurrency(r.stats.weighted_value)),1)]),e("div",ve,[t[16]||(t[16]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Win Rate",-1)),e("p",ke,i(r.stats.win_rate)+"%",1)])])):d("v-if",!0),d(" Loading State "),r.dealStore.loading?(l(),n("div",we,[...t[17]||(t[17]=[e("div",{class:"text-center"},[e("div",{class:"inline-block w-8 h-8 border-4 border-brand-500 border-t-transparent rounded-full animate-spin"}),e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"Loading deals...")],-1)])])):(l(),n(_,{key:2},[d(" Kanban Board "),e("div",he,[e("div",_e,[(l(!0),n(_,null,P(((b=r.kanbanBoard)==null?void 0:b.columns)||[],a=>(l(),n("div",{key:a.stage.id,class:"flex-shrink-0 w-80"},[d(" Column Header "),e("div",{class:"flex items-center justify-between p-3 rounded-t-lg",style:B({backgroundColor:a.stage.color+"20"})},[e("div",De,[e("span",{class:"w-3 h-3 rounded-full",style:B({backgroundColor:a.stage.color})},null,4),e("span",Ce,i(a.stage.name),1),e("span",Se,i(a.deal_count),1)]),e("span",Pe," $"+i(r.formatCurrency(a.total_value)),1)],4),d(" Column Content "),e("div",{class:"bg-gray-100 dark:bg-gray-900/50 rounded-b-lg p-2 min-h-[400px]",onDragover:t[2]||(t[2]=V(()=>{},["prevent"])),onDrop:o=>r.handleDrop(o,a.stage.id)},[(l(!0),n(_,null,P(a.deals,o=>(l(),n("div",{key:o.id,draggable:"true",onDragstart:k=>r.handleDragStart(k,o,a.stage.id),onDragend:r.handleDragEnd,class:"bg-white dark:bg-gray-800 rounded-lg p-3 mb-2 shadow-sm cursor-move hover:shadow-md transition-shadow border border-gray-200 dark:border-gray-700"},[e("div",Ve,[E(v,{to:`/deals/${o.id}`,class:"font-medium text-gray-900 dark:text-white hover:text-brand-600 dark:hover:text-brand-400"},{default:C(()=>[j(i(o.name),1)]),_:2},1032,["to"]),o.priority?(l(),n("span",{key:0,class:L([r.getPriorityClasses(o.priority),"text-xs px-1.5 py-0.5 rounded"])},i(o.priority),3)):d("v-if",!0)]),o.client_name?(l(),n("div",Le,i(o.client_name),1)):d("v-if",!0),e("div",Fe,[o.value?(l(),n("span",Ne," $"+i(r.formatCurrency(o.value)),1)):(l(),n("span",Ke,"-")),o.expected_close_date?(l(),n("span",{key:2,class:L([r.isOverdue(o.expected_close_date)?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400","text-xs"])},i(r.formatDate(o.expected_close_date)),3)):d("v-if",!0)]),o.probability?(l(),n("div",Me,[e("div",Ue,[e("div",qe,[e("div",{class:L(["h-1.5 rounded-full",r.getProbabilityColor(o.probability)]),style:B({width:`${o.probability}%`})},null,6)]),e("span",Ee,i(o.probability)+"%",1)])])):d("v-if",!0)],40,Be))),128)),d(" Empty State "),a.deals.length===0?(l(),n("div",ze,[...t[18]||(t[18]=[e("p",{class:"text-sm"},"No deals",-1)])])):d("v-if",!0)],40,je)]))),128))])])],2112)),d(" Create Deal Modal "),r.showCreateDeal?(l(),n("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:t[9]||(t[9]=V(a=>r.showCreateDeal=!1,["self"]))},[e("div",Ae,[t[25]||(t[25]=e("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[e("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Create New Deal")],-1)),e("form",{onSubmit:V(r.createDeal,["prevent"]),class:"p-6 space-y-4"},[e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Deal Name *",-1)),p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>r.newDeal.name=a),type:"text",required:"",class:"w-full px-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[D,r.newDeal.name]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Value ($)",-1)),p(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>r.newDeal.value=a),type:"number",min:"0",step:"0.01",class:"w-full px-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[D,r.newDeal.value,void 0,{number:!0}]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Expected Close Date",-1)),p(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>r.newDeal.expected_close_date=a),type:"date",class:"w-full px-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[D,r.newDeal.expected_close_date]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Priority",-1)),p(e("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>r.newDeal.priority=a),class:"w-full px-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[...t[22]||(t[22]=[e("option",{value:""},"None",-1),e("option",{value:"low"},"Low",-1),e("option",{value:"medium"},"Medium",-1),e("option",{value:"high"},"High",-1)])],512),[[z,r.newDeal.priority]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Description",-1)),p(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=a=>r.newDeal.description=a),rows:"3",class:"w-full px-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[D,r.newDeal.description]])]),e("div",He,[e("button",{type:"button",onClick:t[8]||(t[8]=a=>r.showCreateDeal=!1),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600"}," Cancel "),e("button",{type:"submit",disabled:r.creatingDeal,class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-brand-600 rounded-lg hover:bg-brand-700 disabled:opacity-50"},[r.creatingDeal?(l(),n("span",Oe)):d("v-if",!0),j(" "+i(r.creatingDeal?"Creating...":"Create Deal"),1)],8,Te)])],32)])])):d("v-if",!0)])]}),_:1})}const Xe=te(se,[["render",Re],["__file","/home/btafoya/projects/openclient/resources/js/src/views/Pipelines/DealsKanban.vue"]]);export{Xe as default};
