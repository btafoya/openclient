import{J as R,r as f,q as p}from"./main-Dc7XXzbq.js";import{a as d}from"./index-B9ygI19o.js";const W=R("tickets",()=>{const o=f([]),c=f(null),u=f(!1),n=f(null),k=f(""),h=f(null),g=f("all"),y=f("all"),T=p(()=>{let e=o.value;if(g.value!=="all"&&(e=e.filter(t=>t.status===g.value)),y.value!=="all"&&(e=e.filter(t=>t.priority===y.value)),k.value){const t=k.value.toLowerCase();e=e.filter(a=>{var r,l,s;return((r=a.ticket_number)==null?void 0:r.toLowerCase().includes(t))||((l=a.subject)==null?void 0:l.toLowerCase().includes(t))||((s=a.description)==null?void 0:s.toLowerCase().includes(t))})}return e}),F=p(()=>o.value.length),m=p(()=>o.value.filter(e=>["open","in_progress","waiting"].includes(e.status))),C=p(()=>o.value.filter(e=>e.status==="resolved")),$=p(()=>o.value.filter(e=>e.status==="closed")),S=p(()=>o.value.filter(e=>e.priority==="urgent"&&e.status!=="closed")),x={urgent:0,high:1,normal:2,low:3},_=p(()=>[...o.value].sort((e,t)=>(x[e.priority]||2)-(x[t.priority]||2)));async function L(e={}){var t,a;u.value=!0,n.value=null;try{const r=await d.get("/api/tickets",{params:e});return o.value=r.data.data||[],o.value}catch(r){throw n.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch tickets",r}finally{u.value=!1}}async function b(e){var t,a;u.value=!0,n.value=null;try{const r=await d.get(`/api/tickets/${e}`);return c.value=r.data.data,c.value}catch(r){throw n.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch ticket",r}finally{u.value=!1}}async function I(e){var t,a;u.value=!0,n.value=null;try{const l=(await d.post("/api/tickets",e)).data.data;return o.value.unshift(l),l}catch(r){throw n.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to create ticket",r}finally{u.value=!1}}async function P(e,t){var a,r,l;u.value=!0,n.value=null;try{const i=(await d.patch(`/api/tickets/${e}`,t)).data.data,v=o.value.findIndex(w=>w.id===e);return v!==-1&&(o.value[v]=i),((a=c.value)==null?void 0:a.id)===e&&(c.value=i),i}catch(s){throw n.value=((l=(r=s.response)==null?void 0:r.data)==null?void 0:l.error)||"Failed to update ticket",s}finally{u.value=!1}}async function O(e){var t,a,r;u.value=!0,n.value=null;try{return await d.delete(`/api/tickets/${e}`),o.value=o.value.filter(l=>l.id!==e),((t=c.value)==null?void 0:t.id)===e&&(c.value=null),!0}catch(l){throw n.value=((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to delete ticket",l}finally{u.value=!1}}async function j(e,t){var a,r,l;u.value=!0,n.value=null;try{const i=(await d.post(`/api/tickets/${e}/assign`,{user_id:t})).data.data,v=o.value.findIndex(w=>w.id===e);return v!==-1&&(o.value[v]=i),((a=c.value)==null?void 0:a.id)===e&&(c.value=i),i}catch(s){throw n.value=((l=(r=s.response)==null?void 0:r.data)==null?void 0:l.error)||"Failed to assign ticket",s}finally{u.value=!1}}async function q(e){var t,a,r;u.value=!0,n.value=null;try{const s=(await d.post(`/api/tickets/${e}/resolve`)).data.data,i=o.value.findIndex(v=>v.id===e);return i!==-1&&(o.value[i]=s),((t=c.value)==null?void 0:t.id)===e&&(c.value=s),s}catch(l){throw n.value=((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to resolve ticket",l}finally{u.value=!1}}async function B(e){var t,a,r;u.value=!0,n.value=null;try{const s=(await d.post(`/api/tickets/${e}/close`)).data.data,i=o.value.findIndex(v=>v.id===e);return i!==-1&&(o.value[i]=s),((t=c.value)==null?void 0:t.id)===e&&(c.value=s),s}catch(l){throw n.value=((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to close ticket",l}finally{u.value=!1}}async function E(e){var t,a,r;u.value=!0,n.value=null;try{const s=(await d.post(`/api/tickets/${e}/reopen`)).data.data,i=o.value.findIndex(v=>v.id===e);return i!==-1&&(o.value[i]=s),((t=c.value)==null?void 0:t.id)===e&&(c.value=s),s}catch(l){throw n.value=((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to reopen ticket",l}finally{u.value=!1}}async function J(e,t,a=!1){var r,l,s;u.value=!0,n.value=null;try{const i=await d.post(`/api/tickets/${e}/messages`,{message:t,is_internal:a});return((r=c.value)==null?void 0:r.id)===e&&await b(e),i.data.data}catch(i){throw n.value=((s=(l=i.response)==null?void 0:l.data)==null?void 0:s.error)||"Failed to add message",i}finally{u.value=!1}}async function M(){var e,t;try{const a=await d.get("/api/tickets/stats");return h.value=a.data.data,h.value}catch(a){throw n.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch ticket stats",a}}async function z(){var e,t;try{return(await d.get("/api/tickets/overdue")).data.data||[]}catch(a){throw n.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch overdue tickets",a}}function A(e){k.value=e}function D(e){g.value=e}function G(e){y.value=e}function H(){n.value=null}function K(){c.value=null}function N(e){const t={open:"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400",in_progress:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400",waiting:"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400",resolved:"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400",closed:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"};return t[e]||t.open}function Q(e){const t={low:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400",normal:"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400",high:"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400",urgent:"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400"};return t[e]||t.normal}return{tickets:o,currentTicket:c,loading:u,error:n,searchTerm:k,stats:h,statusFilter:g,priorityFilter:y,filteredTickets:T,ticketCount:F,openTickets:m,resolvedTickets:C,closedTickets:$,urgentTickets:S,sortedByPriority:_,fetchTickets:L,fetchTicket:b,createTicket:I,updateTicket:P,deleteTicket:O,assignTicket:j,resolveTicket:q,closeTicket:B,reopenTicket:E,addMessage:J,fetchStats:M,fetchOverdue:z,setSearchTerm:A,setStatusFilter:D,setPriorityFilter:G,clearError:H,clearCurrentTicket:K,getStatusColor:N,getPriorityColor:Q}});export{W as u};
