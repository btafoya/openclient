import{J as z,r as f,q as m}from"./main-DbkULGVR.js";import{a as c}from"./index-B9ygI19o.js";const G=z("timeTracking",()=>{const i=f([]),v=f(null),o=f(null),u=f(!1),l=f(null),y=f(null),d=f(0),E=m(()=>o.value!==null),g=m(()=>i.value.filter(e=>e.is_billable)),b=m(()=>i.value.reduce((e,t)=>e+(parseFloat(t.hours)||0),0)),F=m(()=>g.value.reduce((e,t)=>e+(parseFloat(t.hours)||0),0)),S=m(()=>{const e=Math.floor(d.value/3600),t=Math.floor(d.value%3600/60),a=d.value%60;return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`});async function $(e={}){var t,a;u.value=!0,l.value=null;try{const r=await c.get("/api/time-entries",{params:e});return i.value=r.data.data||[],i.value}catch(r){throw l.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch time entries",r}finally{u.value=!1}}async function _(e){var t,a;u.value=!0,l.value=null;try{const r=await c.get(`/api/time-entries/${e}`);return v.value=r.data.data,v.value}catch(r){throw l.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch time entry",r}finally{u.value=!1}}async function x(){var e,t;try{const a=await c.get("/api/time-entries/timer/running");return a.data.data&&(o.value=a.data.data,w()),o.value}catch(a){throw l.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to check running timer",a}}async function k(e,t=null,a=null){var r,n;u.value=!0,l.value=null;try{const s=await c.post("/api/time-entries/timer/start",{project_id:e,task_id:t,description:a});return o.value=s.data.data,d.value=0,w(),o.value}catch(s){throw l.value=((n=(r=s.response)==null?void 0:r.data)==null?void 0:n.error)||"Failed to start timer",s}finally{u.value=!1}}async function I(e=null){var t,a;u.value=!0,l.value=null;try{const n=(await c.post("/api/time-entries/timer/stop",{description:e})).data.data;return T(),o.value=null,d.value=0,i.value.unshift(n),n}catch(r){throw l.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to stop timer",r}finally{u.value=!1}}async function M(e){var t,a;u.value=!0,l.value=null;try{const n=(await c.post("/api/time-entries",e)).data.data;return i.value.unshift(n),n}catch(r){throw l.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to create time entry",r}finally{u.value=!1}}async function j(e,t){var a,r,n;u.value=!0,l.value=null;try{const p=(await c.put(`/api/time-entries/${e}`,t)).data.data,h=i.value.findIndex(U=>U.id===e);return h!==-1&&(i.value[h]=p),((a=v.value)==null?void 0:a.id)===e&&(v.value=p),p}catch(s){throw l.value=((n=(r=s.response)==null?void 0:r.data)==null?void 0:n.error)||"Failed to update time entry",s}finally{u.value=!1}}async function B(e){var t,a,r;u.value=!0,l.value=null;try{const s=(await c.patch(`/api/time-entries/${e}/toggle-billable`)).data.data,p=i.value.findIndex(h=>h.id===e);return p!==-1&&(i.value[p]=s),((t=v.value)==null?void 0:t.id)===e&&(v.value=s),s}catch(n){throw l.value=((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to toggle billable status",n}finally{u.value=!1}}async function H(e){var t,a,r;u.value=!0,l.value=null;try{return await c.delete(`/api/time-entries/${e}`),i.value=i.value.filter(n=>n.id!==e),((t=v.value)==null?void 0:t.id)===e&&(v.value=null),!0}catch(n){throw l.value=((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to delete time entry",n}finally{u.value=!1}}async function R(e){var t,a;try{return(await c.get(`/api/projects/${e}/time-entries/summary`)).data.data}catch(r){throw l.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch billable summary",r}}async function q(e,t=null,a=null){var r,n;try{const s={};return t&&(s.start_date=t),a&&(s.end_date=a),(await c.get(`/api/users/${e}/time-entries/stats`,{params:s})).data.data}catch(s){throw l.value=((n=(r=s.response)==null?void 0:r.data)==null?void 0:n.error)||"Failed to fetch user statistics",s}}function w(){if(o.value&&o.value.start_time){const e=new Date(o.value.start_time);d.value=Math.floor((Date.now()-e.getTime())/1e3),y.value=setInterval(()=>{d.value=Math.floor((Date.now()-e.getTime())/1e3)},1e3)}}function T(){y.value&&(clearInterval(y.value),y.value=null)}function D(){l.value=null}function J(){i.value=[],v.value=null,o.value=null,u.value=!1,l.value=null,T(),d.value=0}return{timeEntries:i,currentEntry:v,runningTimer:o,loading:u,error:l,elapsedSeconds:d,isTimerRunning:E,billableEntries:g,totalHours:b,billableHours:F,formattedElapsedTime:S,fetchTimeEntries:$,fetchTimeEntry:_,checkRunningTimer:x,startTimer:k,stopTimer:I,createTimeEntry:M,updateTimeEntry:j,toggleBillable:B,deleteTimeEntry:H,getBillableSummary:R,getUserStats:q,clearError:D,reset:J}});export{G as u};
