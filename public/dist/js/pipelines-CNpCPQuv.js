import{J as z,r as f,q as g}from"./main-DU1UAF-x.js";import{a as c}from"./index-B9ygI19o.js";const D=z("pipelines",()=>{const p=f([]),s=f(null),u=f(!1),n=f(null),v=f(""),y=g(()=>p.value.filter(a=>a.is_active)),w=g(()=>{let a=p.value;if(v.value){const l=v.value.toLowerCase();a=a.filter(t=>{var e,r;return((e=t.name)==null?void 0:e.toLowerCase().includes(l))||((r=t.description)==null?void 0:r.toLowerCase().includes(l))})}return a}),P=g(()=>p.value.length),m=g(()=>y.value.length);async function F(a=!0){var l,t;u.value=!0,n.value=null;try{const e=await c.get("/api/pipelines",{params:{active:a}});return p.value=e.data.data||[],p.value}catch(e){throw n.value=((t=(l=e.response)==null?void 0:l.data)==null?void 0:t.error)||"Failed to fetch pipelines",e}finally{u.value=!1}}async function S(a){var l,t;u.value=!0,n.value=null;try{const e=await c.get(`/api/pipelines/${a}`);return s.value=e.data.data,s.value}catch(e){throw n.value=((t=(l=e.response)==null?void 0:l.data)==null?void 0:t.error)||"Failed to fetch pipeline",e}finally{u.value=!1}}async function $(a){var l,t;try{return(await c.get(`/api/pipelines/${a}/stats`)).data.data}catch(e){throw n.value=((t=(l=e.response)==null?void 0:l.data)==null?void 0:t.error)||"Failed to fetch statistics",e}}async function x(a){var l,t;u.value=!0,n.value=null;try{const r=(await c.post("/api/pipelines",a)).data.data;return p.value.push(r),r}catch(e){throw n.value=((t=(l=e.response)==null?void 0:l.data)==null?void 0:t.error)||"Failed to create pipeline",e}finally{u.value=!1}}async function C(a,l){var t,e,r;u.value=!0,n.value=null;try{const o=(await c.put(`/api/pipelines/${a}`,l)).data.data,d=p.value.findIndex(h=>h.id===a);return d!==-1&&(p.value[d]=o),((t=s.value)==null?void 0:t.id)===a&&(s.value=o),o}catch(i){throw n.value=((r=(e=i.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to update pipeline",i}finally{u.value=!1}}async function L(a){var l,t,e;u.value=!0,n.value=null;try{return await c.delete(`/api/pipelines/${a}`),p.value=p.value.filter(r=>r.id!==a),((l=s.value)==null?void 0:l.id)===a&&(s.value=null),!0}catch(r){throw n.value=((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.error)||"Failed to delete pipeline",r}finally{u.value=!1}}async function T(a,l){var t,e,r;u.value=!0,n.value=null;try{const o=(await c.post(`/api/pipelines/${a}/stages`,l)).data.data;return((t=s.value)==null?void 0:t.id)===a&&(s.value.stages||(s.value.stages=[]),s.value.stages.push(o)),o}catch(i){throw n.value=((r=(e=i.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to add stage",i}finally{u.value=!1}}async function q(a,l,t){var e,r,i;u.value=!0,n.value=null;try{const d=(await c.put(`/api/pipelines/${a}/stages/${l}`,t)).data.data;if(((e=s.value)==null?void 0:e.id)===a&&s.value.stages){const h=s.value.stages.findIndex(k=>k.id===l);h!==-1&&(s.value.stages[h]=d)}return d}catch(o){throw n.value=((i=(r=o.response)==null?void 0:r.data)==null?void 0:i.error)||"Failed to update stage",o}finally{u.value=!1}}async function E(a,l){var t,e,r;u.value=!0,n.value=null;try{return await c.delete(`/api/pipelines/${a}/stages/${l}`),((t=s.value)==null?void 0:t.id)===a&&s.value.stages&&(s.value.stages=s.value.stages.filter(i=>i.id!==l)),!0}catch(i){throw n.value=((r=(e=i.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to delete stage",i}finally{u.value=!1}}async function J(a,l){var t,e,r;u.value=!0,n.value=null;try{const o=(await c.put(`/api/pipelines/${a}/stages/reorder`,{order:l})).data.data;return((t=s.value)==null?void 0:t.id)===a&&(s.value.stages=o),o}catch(i){throw n.value=((r=(e=i.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to reorder stages",i}finally{u.value=!1}}function _(a){v.value=a}function b(){n.value=null}function j(){p.value=[],s.value=null,u.value=!1,n.value=null,v.value=""}return{pipelines:p,currentPipeline:s,loading:u,error:n,searchTerm:v,activePipelines:y,filteredPipelines:w,pipelineCount:P,activePipelineCount:m,fetchPipelines:F,fetchPipeline:S,fetchPipelineStats:$,createPipeline:x,updatePipeline:C,deletePipeline:L,addStage:T,updateStage:q,deleteStage:E,reorderStages:J,setSearchTerm:_,clearError:b,reset:j}});export{D as u};
