import{_ as z,b as H,c as s,l as q,d as l,e as t,w as n,j as x,z as c,F as h,g as S,v as g,a as I,t as f,E as N,i as Q,C as O,I as R,H as M,r as p,q as D,k as T,o as i}from"./main-Dc7XXzbq.js";import{u as A}from"./recurringInvoices-CzEZok1k.js";import{u as B}from"./clients-DtdxGGMB.js";import{P as W}from"./PageBreadcrumb-DDO8EaZt.js";import"./index-B9ygI19o.js";const G={__name:"RecurringEdit",setup(E,{expose:e}){e();const b=R(),o=M(),v=A(),k=B(),w=p(!0),r=p(!1),m=p(""),u=p([]),y=p({client_id:"",title:"",frequency:"monthly",day_of_month:1,status:"active",end_date:"",max_invoices:null,items:[],tax_rate:0,payment_terms:"net_30",notes:"",auto_send:!1,auto_payment:!1}),V=D(()=>{const d=y.value.items.reduce((_,U)=>_+U.quantity*U.rate,0),a=d*(y.value.tax_rate/100);return d+a});function F(d){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(d||0)}function j(){y.value.items.push({description:"",quantity:1,rate:0})}function L(d){y.value.items.splice(d,1)}async function P(){var d,a;r.value=!0,m.value="";try{await v.updateSchedule(b.params.id,{...y.value,amount:V.value}),o.push(`/recurring-invoices/${b.params.id}`)}catch(_){m.value=((a=(d=_.response)==null?void 0:d.data)==null?void 0:a.error)||"Failed to update schedule"}finally{r.value=!1}}T(async()=>{var d;try{await k.fetchClients(),u.value=k.clients;const a=await v.fetchSchedule(b.params.id);y.value={client_id:a.client_id,title:a.title,frequency:a.frequency,day_of_month:a.day_of_month,status:a.status,end_date:((d=a.end_date)==null?void 0:d.split("T")[0])||"",max_invoices:a.max_invoices,items:a.items||[{description:"",quantity:1,rate:0}],tax_rate:a.tax_rate||0,payment_terms:a.payment_terms||"net_30",notes:a.notes||"",auto_send:a.auto_send??!1,auto_payment:a.auto_payment??!1}}catch(a){console.error("Failed to load schedule:",a)}finally{w.value=!1}});const C={route:b,router:o,recurringStore:v,clientStore:k,loading:w,saving:r,error:m,clients:u,form:y,total:V,formatCurrency:F,addItem:j,removeItem:L,handleSubmit:P,ref:p,computed:D,onMounted:T,get useRoute(){return R},get useRouter(){return M},get useRecurringInvoiceStore(){return A},get useClientStore(){return B},PageBreadcrumb:W};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}},J={key:0,class:"flex items-center justify-center py-12"},K={key:1,class:"rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-6"},X={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Y=["value"],Z={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},$=["value"],tt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},et={class:"border-t dark:border-gray-700 pt-6"},rt={class:"mb-6"},ot={class:"overflow-x-auto"},at={class:"w-full text-sm"},nt={class:"px-4 py-2"},lt=["onUpdate:modelValue"],dt={class:"px-4 py-2"},st=["onUpdate:modelValue"],it={class:"px-4 py-2"},ut=["onUpdate:modelValue"],gt={class:"px-4 py-2 text-right font-medium text-gray-900 dark:text-white"},yt={class:"px-4 py-2"},mt=["onClick"],pt={class:"bg-gray-50 dark:bg-gray-800"},bt={class:"px-4 py-3 text-right font-bold text-lg text-gray-900 dark:text-white"},xt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ct={class:"border-t dark:border-gray-700 pt-6 space-y-4"},ft={class:"flex items-center gap-3"},vt={class:"flex items-center gap-3"},kt={key:0,class:"p-4 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400"},wt={class:"flex items-center justify-end gap-4 pt-4 border-t dark:border-gray-700"},_t=["disabled"],ht={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"};function St(E,e,b,o,v,k){const w=H("router-link");return i(),s("div",null,[q(o.PageBreadcrumb,{pageTitle:"Edit Recurring Schedule"}),l(" Loading State "),o.loading?(i(),s("div",J,[...e[12]||(e[12]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-500"},null,-1)])])):(i(),s("div",K,[t("form",{onSubmit:O(o.handleSubmit,["prevent"]),class:"space-y-6"},[l(" Basic Info "),t("div",X,[t("div",null,[e[14]||(e[14]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"},[x(" Client "),t("span",{class:"text-red-500"},"*")],-1)),n(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.client_id=r),required:"",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},[e[13]||(e[13]=t("option",{value:""},"Select Client",-1)),(i(!0),s(h,null,S(o.clients,r=>(i(),s("option",{key:r.id,value:r.id},f(r.company_name||r.name),9,Y))),128))],512),[[c,o.form.client_id]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"},[x(" Title/Description "),t("span",{class:"text-red-500"},"*")],-1)),n(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.title=r),type:"text",required:"",placeholder:"Monthly Hosting Fee",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,512),[[g,o.form.title]])])]),l(" Frequency "),t("div",Z,[t("div",null,[e[17]||(e[17]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"},[x(" Frequency "),t("span",{class:"text-red-500"},"*")],-1)),n(t("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.frequency=r),required:"",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},[...e[16]||(e[16]=[I('<option value="weekly">Weekly</option><option value="bi-weekly">Bi-weekly</option><option value="monthly">Monthly</option><option value="quarterly">Quarterly</option><option value="semi-annually">Semi-Annually</option><option value="annually">Annually</option>',6)])],512),[[c,o.form.frequency]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Day of Month ",-1)),n(t("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.day_of_month=r),class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},[(i(),s(h,null,S(28,r=>t("option",{key:r,value:r},f(r),9,$)),64))],512),[[c,o.form.day_of_month]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Status ",-1)),n(t("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.status=r),class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},[...e[19]||(e[19]=[t("option",{value:"active"},"Active",-1),t("option",{value:"paused"},"Paused",-1),t("option",{value:"cancelled"},"Cancelled",-1)])],512),[[c,o.form.status]])])]),l(" Dates "),t("div",tt,[t("div",null,[e[21]||(e[21]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," End Date (optional) ",-1)),n(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.end_date=r),type:"date",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,512),[[g,o.form.end_date]]),e[22]||(e[22]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"Leave empty for indefinite billing",-1))]),t("div",null,[e[23]||(e[23]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Max Invoices (optional) ",-1)),n(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.max_invoices=r),type:"number",min:"1",placeholder:"No limit",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,512),[[g,o.form.max_invoices,void 0,{number:!0}]])])]),l(" Invoice Template "),t("div",et,[e[32]||(e[32]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Invoice Template",-1)),l(" Line Items "),t("div",rt,[e[28]||(e[28]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Line Items ",-1)),t("div",ot,[t("table",at,[e[27]||(e[27]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left"},"Description"),t("th",{class:"px-4 py-3 text-right w-24"},"Qty"),t("th",{class:"px-4 py-3 text-right w-32"},"Rate"),t("th",{class:"px-4 py-3 text-right w-32"},"Amount"),t("th",{class:"px-4 py-3 w-12"})])],-1)),t("tbody",null,[(i(!0),s(h,null,S(o.form.items,(r,m)=>(i(),s("tr",{key:m,class:"border-b dark:border-gray-700"},[t("td",nt,[n(t("input",{"onUpdate:modelValue":u=>r.description=u,type:"text",placeholder:"Item description",class:"w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 text-gray-900 dark:text-white px-2 py-1"},null,8,lt),[[g,r.description]])]),t("td",dt,[n(t("input",{"onUpdate:modelValue":u=>r.quantity=u,type:"number",min:"1",class:"w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 text-gray-900 dark:text-white px-2 py-1 text-right"},null,8,st),[[g,r.quantity,void 0,{number:!0}]])]),t("td",it,[n(t("input",{"onUpdate:modelValue":u=>r.rate=u,type:"number",step:"0.01",min:"0",class:"w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 text-gray-900 dark:text-white px-2 py-1 text-right"},null,8,ut),[[g,r.rate,void 0,{number:!0}]])]),t("td",gt,f(o.formatCurrency(r.quantity*r.rate)),1),t("td",yt,[o.form.items.length>1?(i(),s("button",{key:0,type:"button",onClick:u=>o.removeItem(m),class:"p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded"},[...e[24]||(e[24]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,mt)):l("v-if",!0)])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",{colspan:"5",class:"px-4 py-2"},[t("button",{type:"button",onClick:o.addItem,class:"text-sm text-brand-600 hover:text-brand-700"}," + Add Line Item ")])]),t("tr",pt,[e[25]||(e[25]=t("td",{colspan:"3",class:"px-4 py-3 text-right font-medium"},"Total per Invoice:",-1)),t("td",bt,f(o.formatCurrency(o.total)),1),e[26]||(e[26]=t("td",null,null,-1))])])])])]),l(" Tax "),t("div",xt,[t("div",null,[e[29]||(e[29]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Tax Rate (%) ",-1)),n(t("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>o.form.tax_rate=r),type:"number",step:"0.01",min:"0",max:"100",placeholder:"0",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,512),[[g,o.form.tax_rate,void 0,{number:!0}]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Payment Due ",-1)),n(t("select",{"onUpdate:modelValue":e[8]||(e[8]=r=>o.form.payment_terms=r),class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},[...e[30]||(e[30]=[I('<option value="due_on_receipt">Due on Receipt</option><option value="net_15">Net 15</option><option value="net_30">Net 30</option><option value="net_45">Net 45</option><option value="net_60">Net 60</option>',5)])],512),[[c,o.form.payment_terms]])])])]),l(" Notes "),t("div",null,[e[33]||(e[33]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Notes (included on each invoice) ",-1)),n(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=r=>o.form.notes=r),rows:"3",placeholder:"Notes to include on generated invoices...",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,512),[[g,o.form.notes]])]),l(" Settings "),t("div",ct,[e[36]||(e[36]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Settings",-1)),t("label",ft,[n(t("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>o.form.auto_send=r),type:"checkbox",class:"rounded border-gray-300 text-brand-600 focus:ring-brand-500"},null,512),[[N,o.form.auto_send]]),e[34]||(e[34]=t("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"Automatically send invoice to client when generated",-1))]),t("label",vt,[n(t("input",{"onUpdate:modelValue":e[11]||(e[11]=r=>o.form.auto_payment=r),type:"checkbox",class:"rounded border-gray-300 text-brand-600 focus:ring-brand-500"},null,512),[[N,o.form.auto_payment]]),e[35]||(e[35]=t("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"Automatically charge saved payment method",-1))])]),l(" Error Message "),o.error?(i(),s("div",kt,f(o.error),1)):l("v-if",!0),l(" Actions "),t("div",wt,[q(w,{to:`/recurring-invoices/${o.route.params.id}`,class:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg"},{default:Q(()=>[...e[37]||(e[37]=[x(" Cancel ",-1)])]),_:1},8,["to"]),t("button",{type:"submit",disabled:o.saving,class:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2"},[o.saving?(i(),s("svg",ht,[...e[38]||(e[38]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):l("v-if",!0),e[39]||(e[39]=x(" Save Changes ",-1))],8,_t)])],32)]))])}const Nt=z(G,[["render",St],["__file","/home/btafoya/projects/openclient/resources/js/src/views/RecurringInvoices/RecurringEdit.vue"]]);export{Nt as default};
