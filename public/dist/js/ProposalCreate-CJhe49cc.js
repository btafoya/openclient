import{_ as H,b as J,c as n,l as V,e as t,C as R,d as i,w as s,j as c,z as U,F as k,g as v,v as g,t as b,E as z,i as Q,H as T,r as m,q as P,k as q,o as d}from"./main-DU1UAF-x.js";import{u as M}from"./proposals-yTgM_A94.js";import{u as N}from"./clients-DvlY7_j-.js";import{P as W}from"./PageBreadcrumb-FTqaECM3.js";import"./index-B9ygI19o.js";const G={__name:"ProposalCreate",setup(I,{expose:e}){e();const w=T(),o=M(),x=N(),f=m(!1),y=m(""),r=m([]),u=m([]),a=m({client_id:"",title:"",valid_until:"",template_id:"",sections:[{title:"Executive Summary",content:""},{title:"Scope of Work",content:""},{title:"Timeline",content:""}],items:[{description:"",quantity:1,rate:0}],terms:"",notes:"",require_signature:!0,status:"draft"}),_=P(()=>a.value.items.reduce((l,p)=>l+p.quantity*p.rate,0));function j(l){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(l||0)}function B(){a.value.sections.push({title:"",content:""})}function D(l){a.value.sections.splice(l,1)}function A(){a.value.items.push({description:"",quantity:1,rate:0})}function L(l){a.value.items.splice(l,1)}async function O(){if(!a.value.template_id)return;const l=u.value.find(p=>p.id===a.value.template_id);l&&(a.value.sections=JSON.parse(JSON.stringify(l.sections||[])),a.value.items=JSON.parse(JSON.stringify(l.items||[{description:"",quantity:1,rate:0}])),a.value.terms=l.terms||"")}async function E(l=!1){var p,S;f.value=!0,y.value="";try{const h={...a.value,status:l?"draft":"sent",total:_.value},F=await o.createProposal(h);w.push(`/proposals/${F.id}`)}catch(h){y.value=((S=(p=h.response)==null?void 0:p.data)==null?void 0:S.error)||"Failed to create proposal"}finally{f.value=!1}}q(async()=>{await x.fetchClients(),r.value=x.clients,await o.fetchTemplates(),u.value=o.templates;const l=new Date;l.setDate(l.getDate()+30),a.value.valid_until=l.toISOString().split("T")[0]});const C={router:w,proposalStore:o,clientStore:x,loading:f,error:y,clients:r,templates:u,form:a,total:_,formatCurrency:j,addSection:B,removeSection:D,addItem:A,removeItem:L,loadTemplate:O,handleSubmit:E,ref:m,computed:P,onMounted:q,get useRouter(){return T},get useProposalStore(){return M},get useClientStore(){return N},PageBreadcrumb:W};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}},K={class:"rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-6"},X={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Y=["value"],Z={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},$=["value"],tt={class:"space-y-4"},et={class:"flex items-center justify-between mb-3"},rt=["onUpdate:modelValue"],ot=["onClick"],at=["onUpdate:modelValue"],lt={class:"overflow-x-auto"},st={class:"w-full text-sm"},nt={class:"px-4 py-2"},dt=["onUpdate:modelValue"],it={class:"px-4 py-2"},ut=["onUpdate:modelValue"],gt={class:"px-4 py-2"},pt=["onUpdate:modelValue"],ct={class:"px-4 py-2 text-right font-medium text-gray-900 dark:text-white"},mt={class:"px-4 py-2"},yt=["onClick"],bt={class:"bg-gray-50 dark:bg-gray-800"},xt={class:"px-4 py-3 text-right font-bold text-lg text-gray-900 dark:text-white"},ft={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},kt={class:"border-t dark:border-gray-700 pt-6"},vt={class:"flex items-center gap-3"},wt={key:0,class:"p-4 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400"},ht={class:"flex items-center justify-end gap-4 pt-4 border-t dark:border-gray-700"},_t=["disabled"],Ct=["disabled"],St={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"};function Vt(I,e,w,o,x,f){const y=J("router-link");return d(),n("div",null,[V(o.PageBreadcrumb,{pageTitle:"Create Proposal"}),t("div",K,[t("form",{onSubmit:R(o.handleSubmit,["prevent"]),class:"space-y-6"},[i(" Client Selection "),t("div",X,[t("div",null,[e[9]||(e[9]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Client "),t("span",{class:"text-red-500"},"*")],-1)),s(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.client_id=r),required:"",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},[e[8]||(e[8]=t("option",{value:""},"Select Client",-1)),(d(!0),n(k,null,v(o.clients,r=>(d(),n("option",{key:r.id,value:r.id},b(r.company_name||r.name),9,Y))),128))],512),[[U,o.form.client_id]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Title "),t("span",{class:"text-red-500"},"*")],-1)),s(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.title=r),type:"text",required:"",placeholder:"Proposal Title",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,512),[[g,o.form.title]])])]),i(" Dates "),t("div",Z,[t("div",null,[e[11]||(e[11]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"},[c(" Valid Until "),t("span",{class:"text-red-500"},"*")],-1)),s(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.valid_until=r),type:"date",required:"",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,512),[[g,o.form.valid_until]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Template ",-1)),s(t("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.template_id=r),class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500",onChange:o.loadTemplate},[e[12]||(e[12]=t("option",{value:""},"No Template",-1)),(d(!0),n(k,null,v(o.templates,r=>(d(),n("option",{key:r.id,value:r.id},b(r.name),9,$))),128))],544),[[U,o.form.template_id]])])]),i(" Content Sections "),t("div",null,[e[16]||(e[16]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Proposal Content ",-1)),t("div",tt,[(d(!0),n(k,null,v(o.form.sections,(r,u)=>(d(),n("div",{key:u,class:"border border-gray-200 dark:border-gray-700 rounded-lg p-4"},[t("div",et,[s(t("input",{"onUpdate:modelValue":a=>r.title=a,type:"text",placeholder:"Section Title",class:"flex-1 rounded-lg border border-gray-300 dark:border-gray-600 px-3 py-2 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,8,rt),[[g,r.title]]),t("button",{type:"button",onClick:a=>o.removeSection(u),class:"ml-2 p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg"},[...e[14]||(e[14]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ot)]),s(t("textarea",{"onUpdate:modelValue":a=>r.content=a,rows:"4",placeholder:"Section content...",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-3 py-2 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,8,at),[[g,r.content]])]))),128)),t("button",{type:"button",onClick:o.addSection,class:"flex items-center gap-2 text-brand-600 hover:text-brand-700"},[...e[15]||(e[15]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),c(" Add Section ",-1)])])])]),i(" Line Items "),t("div",null,[e[21]||(e[21]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Pricing / Line Items ",-1)),t("div",lt,[t("table",st,[e[20]||(e[20]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left"},"Description"),t("th",{class:"px-4 py-3 text-right w-24"},"Qty"),t("th",{class:"px-4 py-3 text-right w-32"},"Rate"),t("th",{class:"px-4 py-3 text-right w-32"},"Amount"),t("th",{class:"px-4 py-3 w-12"})])],-1)),t("tbody",null,[(d(!0),n(k,null,v(o.form.items,(r,u)=>(d(),n("tr",{key:u,class:"border-b dark:border-gray-700"},[t("td",nt,[s(t("input",{"onUpdate:modelValue":a=>r.description=a,type:"text",placeholder:"Item description",class:"w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 text-gray-900 dark:text-white px-2 py-1"},null,8,dt),[[g,r.description]])]),t("td",it,[s(t("input",{"onUpdate:modelValue":a=>r.quantity=a,type:"number",min:"1",class:"w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 text-gray-900 dark:text-white px-2 py-1 text-right"},null,8,ut),[[g,r.quantity,void 0,{number:!0}]])]),t("td",gt,[s(t("input",{"onUpdate:modelValue":a=>r.rate=a,type:"number",step:"0.01",min:"0",class:"w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 text-gray-900 dark:text-white px-2 py-1 text-right"},null,8,pt),[[g,r.rate,void 0,{number:!0}]])]),t("td",ct,b(o.formatCurrency(r.quantity*r.rate)),1),t("td",mt,[t("button",{type:"button",onClick:a=>o.removeItem(u),class:"p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded"},[...e[17]||(e[17]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,yt)])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",{colspan:"5",class:"px-4 py-2"},[t("button",{type:"button",onClick:o.addItem,class:"text-sm text-brand-600 hover:text-brand-700"}," + Add Line Item ")])]),t("tr",bt,[e[18]||(e[18]=t("td",{colspan:"3",class:"px-4 py-3 text-right font-medium"},"Total:",-1)),t("td",xt,b(o.formatCurrency(o.total)),1),e[19]||(e[19]=t("td",null,null,-1))])])])])]),i(" Terms & Notes "),t("div",ft,[t("div",null,[e[22]||(e[22]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Terms & Conditions ",-1)),s(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.terms=r),rows:"4",placeholder:"Terms and conditions...",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,512),[[g,o.form.terms]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Notes ",-1)),s(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.notes=r),rows:"4",placeholder:"Additional notes...",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,512),[[g,o.form.notes]])])]),i(" Signature Settings "),t("div",kt,[t("label",vt,[s(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.require_signature=r),type:"checkbox",class:"rounded border-gray-300 text-brand-600 focus:ring-brand-500"},null,512),[[z,o.form.require_signature]]),e[24]||(e[24]=t("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"Require electronic signature for acceptance",-1))])]),i(" Error Message "),o.error?(d(),n("div",wt,b(o.error),1)):i("v-if",!0),i(" Actions "),t("div",ht,[V(y,{to:"/proposals",class:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg"},{default:Q(()=>[...e[25]||(e[25]=[c(" Cancel ",-1)])]),_:1}),t("button",{type:"button",onClick:e[7]||(e[7]=r=>o.handleSubmit(!0)),disabled:o.loading,class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50"}," Save as Draft ",8,_t),t("button",{type:"submit",disabled:o.loading,class:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2"},[o.loading?(d(),n("svg",St,[...e[26]||(e[26]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):i("v-if",!0),e[27]||(e[27]=c(" Create Proposal ",-1))],8,Ct)])],32)])])}const Nt=H(G,[["render",Vt],["__file","/home/btafoya/projects/openclient/resources/js/src/views/Proposals/ProposalCreate.vue"]]);export{Nt as default};
