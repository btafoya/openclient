import{J,r as d,q as p}from"./main-DU1UAF-x.js";import{a as i}from"./index-B9ygI19o.js";const k=J("contacts",()=>{const r=d([]),o=d(null),c=d(!1),l=d(null),f=d(""),h=p(()=>r.value.filter(e=>e.is_active)),C=p(()=>r.value.filter(e=>e.is_primary&&e.is_active)),g=p(()=>{if(!f.value)return r.value;const e=f.value.toLowerCase();return r.value.filter(t=>{var n,a,s,u;return((n=t.first_name)==null?void 0:n.toLowerCase().includes(e))||((a=t.last_name)==null?void 0:a.toLowerCase().includes(e))||((s=t.email)==null?void 0:s.toLowerCase().includes(e))||((u=t.job_title)==null?void 0:u.toLowerCase().includes(e))})}),w=p(()=>r.value.length),_=p(()=>h.value.length);async function m(e=!0){var t,n;c.value=!0,l.value=null;try{const a=await i.get("/api/contacts",{params:{active_only:e}});return r.value=a.data.data||[],r.value}catch(a){throw l.value=((n=(t=a.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to fetch contacts",a}finally{c.value=!1}}async function F(e){var t,n;c.value=!0,l.value=null;try{const a=await i.get(`/api/contacts/${e}`);return o.value=a.data.data,o.value}catch(a){throw l.value=((n=(t=a.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to fetch contact",a}finally{c.value=!1}}async function $(e,t=!0){var n,a;c.value=!0,l.value=null;try{return(await i.get(`/api/clients/${e}/contacts`,{params:{active_only:t}})).data.data||[]}catch(s){throw l.value=((a=(n=s.response)==null?void 0:n.data)==null?void 0:a.message)||"Failed to fetch client contacts",s}finally{c.value=!1}}async function x(e){try{return(await i.get(`/api/clients/${e}/contacts/primary`)).data.data}catch{return null}}async function L(e){var t,n;c.value=!0,l.value=null;try{const s=(await i.post("/api/contacts",e)).data.data;return r.value.push(s),s}catch(a){throw l.value=((n=(t=a.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to create contact",a}finally{c.value=!1}}async function S(e,t){var n,a,s;c.value=!0,l.value=null;try{const v=(await i.put(`/api/contacts/${e}`,t)).data.data,y=r.value.findIndex(E=>E.id===e);return y!==-1&&(r.value[y]=v),((n=o.value)==null?void 0:n.id)===e&&(o.value=v),v}catch(u){throw l.value=((s=(a=u.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to update contact",u}finally{c.value=!1}}async function I(e,t=!1){var n,a,s;c.value=!0,l.value=null;try{return await i.delete(`/api/contacts/${e}`,{params:{purge:t}}),r.value=r.value.filter(u=>u.id!==e),((n=o.value)==null?void 0:n.id)===e&&(o.value=null),!0}catch(u){throw l.value=((s=(a=u.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to delete contact",u}finally{c.value=!1}}async function T(e){var t,n,a;c.value=!0,l.value=null;try{const u=(await i.post(`/api/contacts/${e}/toggle-active`)).data.data,v=r.value.findIndex(y=>y.id===e);return v!==-1&&(r.value[v]=u),((t=o.value)==null?void 0:t.id)===e&&(o.value=u),u}catch(s){throw l.value=((a=(n=s.response)==null?void 0:n.data)==null?void 0:a.message)||"Failed to toggle contact status",s}finally{c.value=!1}}async function b(e,t=!0){var n,a;if(!e)return m(t);c.value=!0,l.value=null;try{const s=await i.get("/api/contacts/search",{params:{term:e,active_only:t}});return r.value=s.data.data||[],r.value}catch(s){throw l.value=((a=(n=s.response)==null?void 0:n.data)==null?void 0:a.message)||"Failed to search contacts",s}finally{c.value=!1}}function j(e){return e?`${e.first_name||""} ${e.last_name||""}`.trim():""}function q(e){f.value=e}function A(){l.value=null}function B(){r.value=[],o.value=null,c.value=!1,l.value=null,f.value=""}return{contacts:r,currentContact:o,loading:c,error:l,searchTerm:f,activeContacts:h,primaryContacts:C,filteredContacts:g,contactCount:w,activeContactCount:_,fetchContacts:m,fetchContact:F,fetchContactsByClient:$,fetchPrimaryContact:x,createContact:L,updateContact:S,deleteContact:I,toggleActive:T,searchContacts:b,getFullName:j,setSearchTerm:q,clearError:A,reset:B}});export{k as u};
