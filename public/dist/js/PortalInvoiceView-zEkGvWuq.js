import{_ as E,b as Q,c as o,d as s,e as t,l as I,i as S,F as g,t as i,n as G,j as m,g as j,w as J,v as K,a as X,I as B,H as F,r as y,q as h,k as V,o as n}from"./main-DU1UAF-x.js";import{u as L}from"./portal-rj4kCz22.js";import"./index-B9ygI19o.js";const Y={__name:"PortalInvoiceView",setup(N,{expose:r}){r();const b=B(),e=F(),c=L(),w=y(!0),u=y(!1),d=y(!1),l=y(null),C=y([]),k=y(null),P=y(""),f=y(""),_=h(()=>{var a;return(a=l.value)!=null&&a.due_date?new Date(l.value.due_date)<new Date:!1}),R=h(()=>{var p,v;const a={draft:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",sent:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",viewed:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300",paid:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",partial:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",overdue:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"},x=_.value&&((p=l.value)==null?void 0:p.status)!=="paid"?"overdue":(v=l.value)==null?void 0:v.status;return a[x]||a.draft}),T=h(()=>{var a,x,p,v,D;return _.value&&((a=l.value)==null?void 0:a.status)!=="paid"?"Overdue":((p=(x=l.value)==null?void 0:x.status)==null?void 0:p.charAt(0).toUpperCase())+((D=(v=l.value)==null?void 0:v.status)==null?void 0:D.slice(1))||"Draft"});function H(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a||0)}function z(a){return a?new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-"}async function A(a){if(k.value=a,!["stripe_card","paypal"].includes(a.type))try{const x=await c.getPaymentInstructions(l.value.id,a.type);P.value=x}catch(x){console.error("Failed to get payment instructions:",x)}}async function U(){u.value=!0;try{const a=await c.createStripeIntent(l.value.id);window.location.href=a.url}catch(a){console.error("Failed to initiate payment:",a)}finally{u.value=!1}}async function O(){if(f.value){u.value=!0;try{await c.recordManualPayment(l.value.id,k.value.type,f.value),l.value=await c.fetchInvoice(b.params.id),k.value=null,f.value=""}catch(a){console.error("Failed to record payment:",a)}finally{u.value=!1}}}async function q(){d.value=!0;try{await c.downloadInvoicePdf(l.value.id)}catch(a){console.error("Failed to download PDF:",a)}finally{d.value=!1}}function W(){c.logout(),e.push("/portal")}V(async()=>{try{l.value=await c.fetchInvoice(b.params.id),C.value=await c.fetchPaymentMethods()}catch(a){console.error("Failed to load invoice:",a)}finally{w.value=!1}});const M={route:b,router:e,portalStore:c,loading:w,processing:u,downloading:d,invoice:l,paymentMethods:C,selectedMethod:k,paymentInstructions:P,paymentReference:f,isOverdue:_,statusClass:R,statusLabel:T,formatCurrency:H,formatDate:z,selectMethod:A,payWithStripe:U,recordManualPayment:O,downloadPdf:q,logout:W,ref:y,computed:h,onMounted:V,get useRoute(){return B},get useRouter(){return F},get usePortalStore(){return L}};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}},Z={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},$={class:"bg-white dark:bg-gray-800 shadow-sm"},tt={class:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between"},et={class:"flex items-center gap-4"},rt={key:0,class:"flex items-center justify-center py-12"},at={class:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ot={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden mb-6"},st={class:"p-6"},nt={class:"flex flex-col md:flex-row md:items-start md:justify-between gap-4"},dt={class:"text-2xl font-bold text-gray-900 dark:text-white"},it={class:"text-gray-500 dark:text-gray-400 mt-1"},lt={class:"text-left md:text-right"},ct={class:"text-3xl font-bold text-gray-900 dark:text-white"},yt={key:0,class:"px-6 py-3 bg-red-50 dark:bg-red-900/20 border-t border-red-200 dark:border-red-800"},ut={class:"text-sm text-red-600 dark:text-red-400 flex items-center gap-2"},xt={key:1,class:"px-6 py-3 bg-yellow-50 dark:bg-yellow-900/20 border-t border-yellow-200 dark:border-yellow-800"},gt={class:"text-sm text-yellow-600 dark:text-yellow-400"},mt={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden mb-6"},pt={class:"overflow-x-auto"},vt={class:"w-full"},bt={class:"divide-y divide-gray-200 dark:divide-gray-700"},kt={class:"px-6 py-4 text-gray-900 dark:text-white"},ft={class:"px-6 py-4 text-right text-gray-900 dark:text-white"},ht={class:"px-6 py-4 text-right text-gray-900 dark:text-white"},wt={class:"px-6 py-4 text-right font-medium text-gray-900 dark:text-white"},_t={class:"bg-gray-50 dark:bg-gray-900/50"},Ct={class:"px-6 py-3 text-right text-gray-900 dark:text-white"},Pt={key:0},Mt={class:"px-6 py-3 text-right text-gray-900 dark:text-white"},Dt={key:1},It={class:"px-6 py-3 text-right text-green-600 dark:text-green-400"},St={class:"border-t-2 border-gray-300 dark:border-gray-600"},jt={class:"px-6 py-4 text-right text-xl font-bold text-gray-900 dark:text-white"},Bt={key:0,class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6"},Ft={class:"text-gray-600 dark:text-gray-300 whitespace-pre-wrap"},Vt={key:1,class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6"},Lt={key:0,class:"space-y-3"},Nt=["onClick"],Rt={class:"flex items-center gap-3"},Tt={class:"text-gray-900 dark:text-white font-medium"},Ht={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},zt={class:"space-y-4"},At=["disabled"],Ut={key:0,class:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24"},Ot={class:"space-y-4"},qt={key:0,class:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4"},Wt={class:"font-medium text-gray-900 dark:text-white mb-2"},Et=["innerHTML"],Qt={class:"border-t dark:border-gray-700 pt-4"},Gt=["disabled"],Jt={class:"mt-6 text-center"},Kt=["disabled"],Xt={class:"text-center py-12"};function Yt(N,r,b,e,c,w){const u=Q("router-link");return n(),o("div",Z,[s(" Portal Header "),t("header",$,[t("div",tt,[t("div",et,[I(u,{to:"/portal/dashboard",class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},{default:S(()=>[...r[3]||(r[3]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),_:1}),r[4]||(r[4]=t("h1",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Invoice Details",-1))]),t("button",{onClick:e.logout,class:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}," Logout ")])]),s(" Loading State "),e.loading?(n(),o("div",rt,[...r[5]||(r[5]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-500"},null,-1)])])):e.invoice?(n(),o(g,{key:1},[s(" Invoice Content "),t("main",at,[s(" Invoice Header "),t("div",ot,[t("div",st,[t("div",nt,[t("div",null,[t("h2",dt,"Invoice #"+i(e.invoice.invoice_number),1),t("p",it,"Issued: "+i(e.formatDate(e.invoice.issue_date)),1)]),t("div",lt,[r[6]||(r[6]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Amount Due",-1)),t("p",ct,i(e.formatCurrency(e.invoice.balance_due)),1),t("span",{class:G(["mt-2 inline-block px-3 py-1 rounded-full text-sm font-medium",e.statusClass])},i(e.statusLabel),3)])])]),s(" Due Date Warning "),e.invoice.status!=="paid"&&e.isOverdue?(n(),o("div",yt,[t("p",ut,[r[7]||(r[7]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),m(" This invoice is overdue. Due date was "+i(e.formatDate(e.invoice.due_date)),1)])])):e.invoice.status!=="paid"?(n(),o("div",xt,[t("p",gt," Payment due by "+i(e.formatDate(e.invoice.due_date)),1)])):s("v-if",!0)]),s(" Line Items "),t("div",mt,[t("div",pt,[t("table",vt,[r[12]||(r[12]=t("thead",{class:"bg-gray-50 dark:bg-gray-900/50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Description"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Qty"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Rate"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase"},"Amount")])],-1)),t("tbody",bt,[(n(!0),o(g,null,j(e.invoice.items,(d,l)=>(n(),o("tr",{key:l},[t("td",kt,i(d.description),1),t("td",ft,i(d.quantity),1),t("td",ht,i(e.formatCurrency(d.rate)),1),t("td",wt,i(e.formatCurrency(d.quantity*d.rate)),1)]))),128))]),t("tfoot",_t,[t("tr",null,[r[8]||(r[8]=t("td",{colspan:"3",class:"px-6 py-3 text-right text-gray-600 dark:text-gray-400"},"Subtotal:",-1)),t("td",Ct,i(e.formatCurrency(e.invoice.subtotal)),1)]),e.invoice.tax_amount?(n(),o("tr",Pt,[r[9]||(r[9]=t("td",{colspan:"3",class:"px-6 py-3 text-right text-gray-600 dark:text-gray-400"},"Tax:",-1)),t("td",Mt,i(e.formatCurrency(e.invoice.tax_amount)),1)])):s("v-if",!0),e.invoice.amount_paid>0?(n(),o("tr",Dt,[r[10]||(r[10]=t("td",{colspan:"3",class:"px-6 py-3 text-right text-gray-600 dark:text-gray-400"},"Paid:",-1)),t("td",It,"-"+i(e.formatCurrency(e.invoice.amount_paid)),1)])):s("v-if",!0),t("tr",St,[r[11]||(r[11]=t("td",{colspan:"3",class:"px-6 py-4 text-right font-medium text-gray-900 dark:text-white"},"Balance Due:",-1)),t("td",jt,i(e.formatCurrency(e.invoice.balance_due)),1)])])])])]),s(" Notes "),e.invoice.notes?(n(),o("div",Bt,[r[13]||(r[13]=t("h3",{class:"text-sm font-medium text-gray-900 dark:text-white mb-2"},"Notes",-1)),t("p",Ft,i(e.invoice.notes),1)])):s("v-if",!0),s(" Payment Section "),e.invoice.balance_due>0?(n(),o("div",Vt,[r[21]||(r[21]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Pay This Invoice",-1)),s(" Payment Method Selection "),e.selectedMethod?e.selectedMethod.type==="stripe_card"?(n(),o(g,{key:1},[s(" Credit Card Payment "),t("div",zt,[t("button",{onClick:r[0]||(r[0]=d=>e.selectedMethod=null),class:"text-sm text-brand-600 hover:text-brand-700 flex items-center gap-1"},[...r[16]||(r[16]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),m(" Back ",-1)])]),r[18]||(r[18]=t("p",{class:"text-gray-600 dark:text-gray-400"},"Pay with credit or debit card via Stripe secure checkout.",-1)),t("button",{onClick:e.payWithStripe,disabled:e.processing,class:"w-full px-4 py-3 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center justify-center gap-2"},[e.processing?(n(),o("svg",Ut,[...r[17]||(r[17]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):s("v-if",!0),m(" Pay "+i(e.formatCurrency(e.invoice.balance_due)),1)],8,At)])],2112)):(n(),o(g,{key:2},[s(" Manual Payment Instructions "),t("div",Ot,[t("button",{onClick:r[1]||(r[1]=d=>e.selectedMethod=null),class:"text-sm text-brand-600 hover:text-brand-700 flex items-center gap-1"},[...r[19]||(r[19]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),m(" Back ",-1)])]),e.paymentInstructions?(n(),o("div",qt,[t("h4",Wt,i(e.selectedMethod.name)+" Instructions",1),t("div",{class:"prose dark:prose-invert text-sm max-w-none",innerHTML:e.paymentInstructions},null,8,Et)])):s("v-if",!0),t("div",Qt,[r[20]||(r[20]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-3"}," After making your payment, please provide a reference for our records: ",-1)),J(t("input",{"onUpdate:modelValue":r[2]||(r[2]=d=>e.paymentReference=d),type:"text",placeholder:"Transaction ID or confirmation number",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500 mb-3"},null,512),[[K,e.paymentReference]]),t("button",{onClick:e.recordManualPayment,disabled:e.processing||!e.paymentReference,class:"w-full px-4 py-3 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50"}," Submit Payment Confirmation ",8,Gt)])])],2112)):(n(),o("div",Lt,[r[15]||(r[15]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-4"},"Select a payment method:",-1)),(n(!0),o(g,null,j(e.paymentMethods,d=>(n(),o("button",{key:d.type,onClick:l=>e.selectMethod(d),class:"w-full flex items-center justify-between p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[t("div",Rt,[t("span",Tt,i(d.name),1),d.note?(n(),o("span",Ht,i(d.note),1)):s("v-if",!0)]),r[14]||(r[14]=t("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))],8,Nt))),128))]))])):(n(),o(g,{key:2},[s(" Already Paid "),r[22]||(r[22]=X('<div class="bg-green-50 dark:bg-green-900/20 rounded-xl border border-green-200 dark:border-green-800 p-6 text-center"><svg class="w-12 h-12 mx-auto text-green-500 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><h3 class="text-lg font-semibold text-green-800 dark:text-green-200">Invoice Paid</h3><p class="text-green-600 dark:text-green-400 mt-1">Thank you for your payment!</p></div>',1))],2112)),s(" Download PDF "),t("div",Jt,[t("button",{onClick:e.downloadPdf,disabled:e.downloading,class:"text-brand-600 hover:text-brand-700 font-medium flex items-center gap-2 mx-auto"},[...r[23]||(r[23]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),m(" Download PDF ",-1)])],8,Kt)])])],2112)):(n(),o(g,{key:2},[s(" Not Found "),t("div",Xt,[r[25]||(r[25]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Invoice not found.",-1)),I(u,{to:"/portal/dashboard",class:"text-brand-600 hover:text-brand-700 mt-2 inline-block"},{default:S(()=>[...r[24]||(r[24]=[m(" Back to Dashboard ",-1)])]),_:1})])],2112))])}const ee=E(Y,[["render",Yt],["__file","/home/btafoya/projects/openclient/resources/js/src/views/Portal/PortalInvoiceView.vue"]]);export{ee as default};
