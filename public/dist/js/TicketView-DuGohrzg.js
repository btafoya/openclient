import{_ as P,b as H,h as U,i as p,I as h,H as _,r as x,q as C,k as T,o as i,c as n,e as t,d as s,t as l,n as b,l as S,j as y,F as E,g as O,w as D,v as Q,E as W}from"./main-Dc7XXzbq.js";import{u as M}from"./tickets-BtA3sVWy.js";import{A as q}from"./AdminLayout-DxqTGoZO.js";import"./index-B9ygI19o.js";const G={__name:"TicketView",setup(j,{expose:r}){r();const u=h(),e=_(),d=M(),m=x(!1),g=x(!1),a=x(""),f=x(!1),c=C(()=>d.currentTicket);async function v(){m.value=!0;try{await d.fetchTicket(u.params.id)}catch(o){console.error("Failed to load ticket:",o)}finally{m.value=!1}}async function F(){if(a.value.trim()){g.value=!0;try{await d.addMessage(c.value.id,a.value,f.value),a.value="",f.value=!1}catch(o){console.error("Failed to send reply:",o),alert("Failed to send reply. Please try again.")}finally{g.value=!1}}}async function B(o){try{await d.updateTicket(c.value.id,{status:o})}catch(k){console.error("Failed to update status:",k),alert("Failed to update ticket status.")}}async function R(){if(confirm("Mark this ticket as resolved?"))try{await d.resolveTicket(c.value.id)}catch(o){console.error("Failed to resolve ticket:",o),alert("Failed to resolve ticket.")}}async function N(){if(confirm("Close this ticket?"))try{await d.closeTicket(c.value.id)}catch(o){console.error("Failed to close ticket:",o),alert("Failed to close ticket.")}}async function V(){if(confirm("Reopen this ticket?"))try{await d.reopenTicket(c.value.id)}catch(o){console.error("Failed to reopen ticket:",o),alert("Failed to reopen ticket.")}}function z(){const o=["low","normal","high","urgent"];o.indexOf(c.value.priority);const k=prompt("Enter new priority (low, normal, high, urgent):",c.value.priority);k&&o.includes(k.toLowerCase())&&d.updateTicket(c.value.id,{priority:k.toLowerCase()})}function A(o){return o?new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):null}function L(o){return o?new Date(o).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}):"—"}function I(o){return(o==null?void 0:o.replace("_"," "))||o}T(()=>v());const w={route:u,router:e,ticketStore:d,loading:m,sending:g,newMessage:a,isInternalNote:f,ticket:c,loadTicket:v,sendReply:F,updateStatus:B,resolveTicket:R,closeTicket:N,reopenTicket:V,changePriority:z,formatDate:A,formatDateTime:L,formatStatus:I,ref:x,computed:C,onMounted:T,get useRoute(){return h},get useRouter(){return _},get useTicketStore(){return M},AdminLayout:q};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}},J={key:0,class:"flex items-center justify-center py-12"},K={key:1,class:"mx-auto max-w-5xl space-y-6"},X={class:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between"},Y={class:"flex-1"},Z={class:"flex items-center gap-3 flex-wrap"},$={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},tt={class:"mt-2 text-2xl font-bold text-gray-900 dark:text-white"},et={key:0,class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},rt={class:"flex gap-3"},ot={class:"grid grid-cols-1 gap-6 lg:grid-cols-3"},st={class:"lg:col-span-2 space-y-6"},it={class:"rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-gray-900"},at={class:"prose prose-sm dark:prose-invert max-w-none"},nt={class:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},lt={class:"rounded-lg border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-900"},dt={class:"p-4 space-y-4 max-h-96 overflow-y-auto"},ct={key:0,class:"text-center py-8"},gt={class:"flex items-start justify-between mb-2"},yt={class:"flex items-center gap-2"},kt={class:"font-medium text-sm text-gray-900 dark:text-white"},xt={key:0,class:"text-xs px-2 py-0.5 bg-yellow-200 text-yellow-800 rounded dark:bg-yellow-800 dark:text-yellow-200"},mt={class:"text-xs text-gray-500 dark:text-gray-400"},ut={class:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},ft={key:0,class:"p-4 border-t border-gray-200 dark:border-gray-800"},pt={class:"space-y-3"},bt={class:"flex items-center justify-between"},vt={class:"flex items-center gap-2"},wt=["disabled"],ht={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},_t={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ct={class:"space-y-6"},Tt={class:"rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-gray-900"},St={class:"space-y-4"},Dt={class:"mt-1 text-sm text-gray-900 dark:text-white capitalize"},Mt={class:"mt-1 text-sm text-gray-900 dark:text-white capitalize"},jt={class:"mt-1 text-sm text-gray-900 dark:text-white"},Ft={class:"mt-1 text-sm text-gray-900 dark:text-white"},Bt={class:"mt-1 text-sm text-gray-900 dark:text-white"},Rt={key:0},Nt={class:"mt-1 text-sm text-gray-900 dark:text-white"},Vt={key:1},zt={class:"mt-1 text-sm text-gray-900 dark:text-white"},At={class:"rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-gray-900"},Lt={class:"space-y-2"},It={key:2,class:"text-center py-12"};function Pt(j,r,u,e,d,m){const g=H("router-link");return i(),U(e.AdminLayout,null,{default:p(()=>[e.loading?(i(),n("div",J,[...r[4]||(r[4]=[t("div",{class:"h-12 w-12 animate-spin rounded-full border-4 border-gray-300 border-t-brand-600"},null,-1)])])):e.ticket?(i(),n("div",K,[s(" Header "),t("div",X,[t("div",Y,[t("div",Z,[t("span",$,l(e.ticket.ticket_number),1),t("span",{class:b(["inline-flex items-center gap-1.5 px-2.5 py-0.5 text-xs font-medium rounded-full capitalize",e.ticketStore.getStatusColor(e.ticket.status)])},l(e.formatStatus(e.ticket.status)),3),t("span",{class:b(["inline-flex items-center px-2.5 py-0.5 text-xs font-medium rounded-full capitalize",e.ticketStore.getPriorityColor(e.ticket.priority)])},l(e.ticket.priority),3)]),t("h1",tt,l(e.ticket.subject),1),e.ticket.client_name?(i(),n("p",et," Client: "+l(e.ticket.client_name),1)):s("v-if",!0)]),t("div",rt,[S(g,{to:"/tickets",class:"inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"},{default:p(()=>[...r[5]||(r[5]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),y(" Back ",-1)])]),_:1}),["open","in_progress","waiting"].includes(e.ticket.status)?(i(),n("button",{key:0,onClick:e.resolveTicket,class:"inline-flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700"},[...r[6]||(r[6]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),y(" Resolve ",-1)])])):s("v-if",!0),e.ticket.status==="resolved"?(i(),n("button",{key:1,onClick:e.closeTicket,class:"inline-flex items-center gap-2 rounded-lg bg-gray-600 px-4 py-2 text-sm font-medium text-white hover:bg-gray-700"},[...r[7]||(r[7]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),y(" Close ",-1)])])):s("v-if",!0),e.ticket.status==="closed"?(i(),n("button",{key:2,onClick:e.reopenTicket,class:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700"},[...r[8]||(r[8]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),y(" Reopen ",-1)])])):s("v-if",!0)])]),s(" Ticket Details "),t("div",ot,[s(" Main Content "),t("div",st,[s(" Description "),t("div",it,[r[9]||(r[9]=t("h2",{class:"mb-4 text-lg font-semibold text-gray-900 dark:text-white"},"Description",-1)),t("div",at,[t("p",nt,l(e.ticket.description||"No description provided."),1)])]),s(" Messages / Conversation "),t("div",lt,[r[14]||(r[14]=t("div",{class:"p-4 border-b border-gray-200 dark:border-gray-800"},[t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Conversation")],-1)),t("div",dt,[!e.ticket.messages||e.ticket.messages.length===0?(i(),n("div",ct,[...r[10]||(r[10]=[t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"No messages yet",-1)])])):s("v-if",!0),(i(!0),n(E,null,O(e.ticket.messages,a=>(i(),n("div",{key:a.id,class:b(["rounded-lg p-4",a.is_internal?"bg-yellow-50 border border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800":a.is_from_client?"bg-gray-50 dark:bg-gray-800":"bg-brand-50 dark:bg-brand-900/20"])},[t("div",gt,[t("div",yt,[t("span",kt,l(a.is_from_client?"Client":"Support"),1),a.is_internal?(i(),n("span",xt," Internal Note ")):s("v-if",!0)]),t("span",mt,l(e.formatDateTime(a.created_at)),1)]),t("p",ut,l(a.message),1)],2))),128))]),s(" Reply Form "),e.ticket.status!=="closed"?(i(),n("div",ft,[t("div",pt,[D(t("textarea",{"onUpdate:modelValue":r[0]||(r[0]=a=>e.newMessage=a),rows:"3",placeholder:"Type your reply...",class:"w-full px-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,512),[[Q,e.newMessage]]),t("div",bt,[t("label",vt,[D(t("input",{"onUpdate:modelValue":r[1]||(r[1]=a=>e.isInternalNote=a),type:"checkbox",class:"w-4 h-4 text-brand-600 border-gray-300 rounded focus:ring-brand-500"},null,512),[[W,e.isInternalNote]]),r[11]||(r[11]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Internal note (not visible to client)",-1))]),t("button",{onClick:e.sendReply,disabled:!e.newMessage.trim()||e.sending,class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-brand-600 rounded-lg hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed"},[e.sending?(i(),n("svg",ht,[...r[12]||(r[12]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(i(),n("svg",_t,[...r[13]||(r[13]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1)])])),y(" "+l(e.sending?"Sending...":"Send Reply"),1)],8,wt)])])])):s("v-if",!0)])]),s(" Sidebar "),t("div",Ct,[s(" Ticket Info "),t("div",Tt,[r[22]||(r[22]=t("h2",{class:"mb-4 text-lg font-semibold text-gray-900 dark:text-white"},"Details",-1)),t("dl",St,[t("div",null,[r[15]||(r[15]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Category",-1)),t("dd",Dt,l(e.ticket.category||"—"),1)]),t("div",null,[r[16]||(r[16]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Source",-1)),t("dd",Mt,l(e.ticket.source||"—"),1)]),t("div",null,[r[17]||(r[17]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Assigned To",-1)),t("dd",jt,l(e.ticket.assigned_user_name||"Unassigned"),1)]),t("div",null,[r[18]||(r[18]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Created",-1)),t("dd",Ft,l(e.formatDateTime(e.ticket.created_at)),1)]),t("div",null,[r[19]||(r[19]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Due Date",-1)),t("dd",Bt,l(e.formatDate(e.ticket.due_date)||"—"),1)]),e.ticket.resolved_at?(i(),n("div",Rt,[r[20]||(r[20]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Resolved",-1)),t("dd",Nt,l(e.formatDateTime(e.ticket.resolved_at)),1)])):s("v-if",!0),e.ticket.closed_at?(i(),n("div",Vt,[r[21]||(r[21]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Closed",-1)),t("dd",zt,l(e.formatDateTime(e.ticket.closed_at)),1)])):s("v-if",!0)])]),s(" Quick Actions "),t("div",At,[r[23]||(r[23]=t("h2",{class:"mb-4 text-lg font-semibold text-gray-900 dark:text-white"},"Quick Actions",-1)),t("div",Lt,[e.ticket.status==="open"?(i(),n("button",{key:0,onClick:r[2]||(r[2]=a=>e.updateStatus("in_progress")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg dark:text-gray-300 dark:hover:bg-gray-800"}," Start Working ")):s("v-if",!0),e.ticket.status==="in_progress"?(i(),n("button",{key:1,onClick:r[3]||(r[3]=a=>e.updateStatus("waiting")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg dark:text-gray-300 dark:hover:bg-gray-800"}," Mark as Waiting ")):s("v-if",!0),t("button",{onClick:e.changePriority,class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg dark:text-gray-300 dark:hover:bg-gray-800"}," Change Priority ")])])])])])):(i(),n("div",It,[r[25]||(r[25]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Ticket not found",-1)),S(g,{to:"/tickets",class:"mt-4 inline-block text-brand-600 hover:text-brand-700"},{default:p(()=>[...r[24]||(r[24]=[y(" Back to Tickets ",-1)])]),_:1})]))]),_:1})}const Qt=P(G,[["render",Pt],["__file","/home/btafoya/projects/openclient/resources/js/src/views/Tickets/TicketView.vue"]]);export{Qt as default};
