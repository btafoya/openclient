import{J as le,r as h,q as g}from"./main-DU1UAF-x.js";import{a as f}from"./index-B9ygI19o.js";var R="clover",ce=function(s){return s===3?"v3":s},T="https://js.stripe.com",ue="".concat(T,"/").concat(R,"/stripe.js"),de=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,pe=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var fe=function(s){return de.test(s)||pe.test(s)},ve=function(){for(var s=document.querySelectorAll('script[src^="'.concat(T,'"]')),o=0;o<s.length;o++){var l=s[o];if(fe(l.src))return l}return null},L=function(s){var o="",l=document.createElement("script");l.src="".concat(ue).concat(o);var u=document.head||document.body;if(!u)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return u.appendChild(l),l},ye=function(s,o){!s||!s._registerWrapper||s._registerWrapper({name:"stripe-js",version:"8.5.3",startTime:o})},P=null,b=null,F=null,me=function(s){return function(o){s(new Error("Failed to load Stripe.js",{cause:o}))}},he=function(s,o){return function(){window.Stripe?s(window.Stripe):o(new Error("Stripe.js not available"))}},we=function(s){return P!==null?P:(P=new Promise(function(o,l){if(typeof window>"u"||typeof document>"u"){o(null);return}if(window.Stripe){o(window.Stripe);return}try{var u=ve();if(!(u&&s)){if(!u)u=L(s);else if(u&&F!==null&&b!==null){var y;u.removeEventListener("load",F),u.removeEventListener("error",b),(y=u.parentNode)===null||y===void 0||y.removeChild(u),u=L(s)}}F=he(o,l),b=me(l),u.addEventListener("load",F),u.addEventListener("error",b)}catch(w){l(w);return}}),P.catch(function(o){return P=null,Promise.reject(o)}))},ge=function(s,o,l){if(s===null)return null;var u=o[0],y=u.match(/^pk_test/),w=ce(s.version),c=R;y&&w!==c&&console.warn("Stripe.js@".concat(w," was loaded on the page, but @stripe/stripe-js@").concat("8.5.3"," expected Stripe.js@").concat(c,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var n=s.apply(void 0,o);return ye(n,l),n},_,M=!1,$=function(){return _||(_=we(null).catch(function(s){return _=null,Promise.reject(s)}),_)};Promise.resolve().then(function(){return $()}).catch(function(d){M||console.warn(d)});var Se=function(){for(var s=arguments.length,o=new Array(s),l=0;l<s;l++)o[l]=arguments[l];M=!0;var u=Date.now();return $().then(function(y){return ge(y,o,u)})};const be=le("payments",()=>{const d=h([]),s=h(null),o=h([]),l=h([]),u=h({total_payments:0,succeeded:0,failed:0,pending:0,refunded:0,total_collected:0,total_refunded:0}),y=h({publishable_key:null,configured:!1}),w=h(null),c=h(!1),n=h(null),v=h(!1),C={stripe_card:{name:"Credit/Debit Card",icon:"credit-card",instant:!0},stripe_ach:{name:"Bank Transfer (ACH)",icon:"bank",instant:!1,note:"Takes 4-5 business days"},paypal:{name:"PayPal",icon:"paypal",instant:!0},zelle:{name:"Zelle",icon:"zelle",instant:!1,note:"Pending verification"},check:{name:"Check",icon:"check",instant:!1,note:"Pending verification"},wire:{name:"Wire Transfer",icon:"wire",instant:!1,note:"Pending verification"}},j=g(()=>d.value.filter(a=>a.status==="succeeded")),A=g(()=>d.value.filter(a=>a.status==="pending"||a.status==="processing")),I=g(()=>d.value.filter(a=>a.status==="failed")),U=g(()=>d.value.filter(a=>a.status==="refunded")),x=g(()=>y.value.configured),q=g(()=>o.value.length),V=g(()=>j.value.reduce((a,t)=>a+parseFloat(t.amount||0),0));async function D(a){var t,r;c.value=!0,n.value=null;try{const e=await f.get(`/api/invoices/${a}/payment-methods`);return e.data.success&&(l.value=e.data.data||[]),l.value}catch(e){throw n.value=((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to fetch payment methods",e}finally{c.value=!1}}async function S(a={}){var t,r;c.value=!0,n.value=null;try{const e=new URLSearchParams;a.status&&e.append("status",a.status),a.from_date&&e.append("from_date",a.from_date),a.to_date&&e.append("to_date",a.to_date);const i=e.toString(),p=`/api/payments${i?"?"+i:""}`,m=await f.get(p);m.data.success&&(d.value=m.data.data)}catch(e){n.value=((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to fetch payments",console.error("Failed to fetch payments:",e)}finally{c.value=!1}}async function G(a){var t,r;c.value=!0,n.value=null;try{const e=await f.get(`/api/payments/${a}`);if(e.data.success)return s.value=e.data.data,e.data.data}catch(e){n.value=((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to fetch payment",console.error("Failed to fetch payment:",e)}finally{c.value=!1}return null}async function J(a){var t,r;c.value=!0,n.value=null;try{const e=await f.get(`/api/invoices/${a}/payments`);if(e.data.success)return e.data.data}catch(e){n.value=((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to fetch invoice payments",console.error("Failed to fetch invoice payments:",e)}finally{c.value=!1}return[]}async function W(){try{const a=await f.get("/api/payments/stats");a.data.success&&(u.value=a.data.data)}catch(a){console.error("Failed to fetch payment stats:",a)}}async function E(){try{const a=await f.get("/api/payments/config");a.data.success&&(y.value=a.data.data,y.value.publishable_key&&(w.value=Se(y.value.publishable_key)))}catch(a){console.error("Failed to fetch Stripe config:",a),y.value={publishable_key:null,configured:!1}}}async function k(a){var t,r;v.value=!0,n.value=null;try{const e=await f.post("/api/payments/checkout",{invoice_id:a});if(e.data.success)return e.data.data}catch(e){throw n.value=((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to create checkout session",console.error("Failed to create checkout session:",e),e}finally{v.value=!1}}async function H(a){var t,r;v.value=!0,n.value=null;try{w.value||await E();const e=await k(a);if(!e||!e.url)throw new Error("Invalid checkout session response");return window.location.href=e.url,e}catch(e){throw n.value=((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.error)||e.message||"Failed to redirect to checkout",v.value=!1,e}}async function O(a){try{const t=await f.get(`/api/payments/success?session_id=${a}`);if(t.data.success)return t.data.data}catch(t){console.error("Failed to verify payment:",t)}return null}async function z(a=null){try{const t=a?`/api/payments/cancel?session_id=${a}`:"/api/payments/cancel";await f.get(t)}catch(t){console.error("Failed to handle payment cancel:",t)}}async function B(a,t=null,r="requested_by_customer"){var e,i;c.value=!0,n.value=null;try{const p=await f.post(`/api/payments/${a}/refund`,{amount:t,reason:r});if(p.data.success)return await S(),p.data.data}catch(p){throw n.value=((i=(e=p.response)==null?void 0:e.data)==null?void 0:i.error)||"Failed to process refund",console.error("Failed to process refund:",p),p}finally{c.value=!1}}async function N(){return w.value||await E(),w.value}function X(a){return{pending:{label:"Pending",color:"yellow"},processing:{label:"Processing",color:"blue"},succeeded:{label:"Paid",color:"green"},failed:{label:"Failed",color:"red"},refunded:{label:"Refunded",color:"gray"},cancelled:{label:"Cancelled",color:"gray"}}[a]||{label:a,color:"gray"}}function K(a,t="USD"){return new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(a)}async function Z(a){var t,r;v.value=!0,n.value=null;try{const e=await f.post("/api/payments/paypal/create-order",{invoice_id:a});if(e.data.success)return e.data.data}catch(e){throw n.value=((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to create PayPal order",e}finally{v.value=!1}}async function Q(a){var t,r;v.value=!0,n.value=null;try{const e=await f.post("/api/payments/paypal/capture",{order_id:a});if(e.data.success)return await S(),e.data.data}catch(e){throw n.value=((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to capture PayPal payment",e}finally{v.value=!1}}async function Y(a){var t,r;v.value=!0,n.value=null;try{const e=await f.post("/api/payments/ach/create-intent",{invoice_id:a});if(e.data.success)return e.data.data}catch(e){throw n.value=((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to create ACH payment intent",e}finally{v.value=!1}}async function ee(a,t){var r,e;v.value=!0,n.value=null;try{const i=await f.post("/api/payments/ach/verify-microdeposits",{payment_intent_id:a,amounts:t});if(i.data.success)return i.data.data}catch(i){throw n.value=((e=(r=i.response)==null?void 0:r.data)==null?void 0:e.error)||"Failed to verify microdeposits",i}finally{v.value=!1}}async function ae(a,t,r=null,e=""){var i,p;v.value=!0,n.value=null;try{const m=await f.post("/api/payments/manual/record",{invoice_id:a,payment_method:t,amount:r,reference:e});if(m.data.success)return await S(),m.data.data}catch(m){throw n.value=((p=(i=m.response)==null?void 0:i.data)==null?void 0:p.error)||"Failed to record payment",m}finally{v.value=!1}}async function te(){var a,t;c.value=!0,n.value=null;try{const r=await f.get("/api/payments/manual/pending");return r.data.success&&(o.value=r.data.data||[]),o.value}catch(r){throw n.value=((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.error)||"Failed to fetch pending payments",r}finally{c.value=!1}}async function re(a,t="",r=""){var e,i;c.value=!0,n.value=null;try{const p=await f.post(`/api/payments/manual/${a}/verify`,{reference:t,notes:r});if(p.data.success)return await S(),o.value=o.value.filter(m=>m.id!==a),p.data.data}catch(p){throw n.value=((i=(e=p.response)==null?void 0:e.data)==null?void 0:i.error)||"Failed to verify payment",p}finally{c.value=!1}}async function ne(a,t){var r,e;c.value=!0,n.value=null;try{const i=await f.post(`/api/payments/manual/${a}/reject`,{reason:t});if(i.data.success)return await S(),o.value=o.value.filter(p=>p.id!==a),i.data.data}catch(i){throw n.value=((e=(r=i.response)==null?void 0:r.data)==null?void 0:e.error)||"Failed to reject payment",i}finally{c.value=!1}}async function se(a,t){var r,e;c.value=!0,n.value=null;try{const i=await f.get(`/api/invoices/${a}/payment-instructions/${t}`);if(i.data.success)return i.data.data}catch(i){throw n.value=((e=(r=i.response)==null?void 0:r.data)==null?void 0:e.error)||"Failed to get payment instructions",i}finally{c.value=!1}}function oe(a){return C[a]||{name:a,icon:"credit-card"}}function ie(){d.value=[],s.value=null,o.value=[],l.value=[],n.value=null}return{payments:d,currentPayment:s,pendingManual:o,availableMethods:l,stats:u,stripeConfig:y,loading:c,error:n,processingPayment:v,succeededPayments:j,pendingPayments:A,failedPayments:I,refundedPayments:U,isStripeConfigured:x,pendingManualCount:q,totalCollected:V,paymentMethodConfig:C,fetchPayments:S,fetchPayment:G,fetchPaymentsByInvoice:J,fetchStats:W,fetchStripeConfig:E,createCheckoutSession:k,redirectToCheckout:H,verifyPaymentSuccess:O,handlePaymentCancel:z,refundPayment:B,getStripe:N,fetchAvailableMethods:D,getPaymentInstructions:se,getMethodConfig:oe,createPayPalOrder:Z,capturePayPalOrder:Q,createACHIntent:Y,verifyACHMicrodeposits:ee,recordManualPayment:ae,fetchPendingManualPayments:te,verifyManualPayment:re,rejectManualPayment:ne,getStatusDisplay:X,formatCurrency:K,clearState:ie}});export{be as u};
