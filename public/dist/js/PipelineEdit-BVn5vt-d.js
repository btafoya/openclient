import{_ as q,b as I,h as T,i as k,H as P,I as V,r as v,u as U,k as M,o as g,e,d as i,c as b,l as B,F as L,C as O,w as u,v as m,E as h,j as _,g as z,t as j}from"./main-DU1UAF-x.js";import{u as F}from"./pipelines-CNpCPQuv.js";import{A as G}from"./AdminLayout-Baccdx-S.js";import"./index-B9ygI19o.js";const J={__name:"PipelineEdit",setup(D,{expose:t}){t();const y=P(),o=V(),f=F(),x=v(!0),p=v(!1),r=v(null),a=U({name:"",description:"",is_active:!0,stages:[]});async function n(){x.value=!0;try{const s=o.params.id;r.value=await f.fetchPipeline(s),a.name=r.value.name,a.description=r.value.description||"",a.is_active=r.value.is_active,a.stages=(r.value.stages||[]).map(l=>({id:l.id,name:l.name,color:l.color||"#6b7280",probability:l.probability||0,is_won:l.is_won||!1,is_lost:l.is_lost||!1,deal_count:l.deal_count||0}))}catch(s){console.error("Failed to load pipeline:",s),alert("Failed to load pipeline. Please try again."),y.push("/pipelines")}finally{x.value=!1}}function E(){a.stages.push({id:null,name:"",color:"#6b7280",probability:50,is_won:!1,is_lost:!1,deal_count:0})}function N(s){if(a.stages[s].deal_count>0){alert("Cannot delete a stage that has deals. Move deals to another stage first.");return}a.stages.length>2&&a.stages.splice(s,1)}function A(s){a.stages[s].is_won&&(a.stages[s].is_lost=!1,a.stages[s].probability=100)}function R(s){a.stages[s].is_lost&&(a.stages[s].is_won=!1,a.stages[s].probability=0)}async function W(){var S,C;if(!a.name.trim()){alert("Pipeline name is required");return}const s=a.stages.some(d=>d.is_won),l=a.stages.some(d=>d.is_lost);if(!s||!l){alert("Please designate at least one Won stage and one Lost stage");return}p.value=!0;try{const d={name:a.name.trim(),description:a.description.trim()||null,is_active:a.is_active,stages:a.stages.map((c,H)=>({id:c.id,name:c.name,color:c.color,probability:c.probability,sort_order:H,is_won:c.is_won,is_lost:c.is_lost}))};await f.updatePipeline(o.params.id,d),y.push("/pipelines")}catch(d){console.error("Failed to update pipeline:",d),alert(((C=(S=d.response)==null?void 0:S.data)==null?void 0:C.error)||"Failed to update pipeline. Please try again.")}finally{p.value=!1}}M(()=>{n()});const w={router:y,route:o,pipelineStore:f,loading:x,saving:p,pipeline:r,form:a,loadPipeline:n,addStage:E,removeStage:N,handleWonChange:A,handleLostChange:R,handleSubmit:W,ref:v,reactive:U,onMounted:M,get useRouter(){return P},get useRoute(){return V},get usePipelineStore(){return F},AdminLayout:G};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}},K={class:"max-w-3xl mx-auto space-y-6"},Q={class:"flex items-center gap-4"},X={key:0,class:"p-8 text-center"},Y={class:"bg-white dark:bg-white/[0.03] rounded-xl border border-gray-200 dark:border-gray-800 p-6"},Z={class:"space-y-4"},$={class:"flex items-center"},ee={class:"bg-white dark:bg-white/[0.03] rounded-xl border border-gray-200 dark:border-gray-800 p-6"},te={class:"space-y-3"},re={class:"flex-shrink-0"},ae=["onUpdate:modelValue"],oe={class:"flex-1 space-y-3"},se={class:"grid grid-cols-2 gap-3"},ne=["onUpdate:modelValue"],ie=["onUpdate:modelValue"],le={class:"flex items-center gap-4"},de={class:"inline-flex items-center"},ue=["onUpdate:modelValue","onChange"],ge={class:"inline-flex items-center"},pe=["onUpdate:modelValue","onChange"],ce={key:0,class:"text-xs text-gray-500"},be=["onClick","disabled","title"],me={class:"flex items-center justify-end gap-3"},ye=["disabled"],fe={key:0,class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"};function xe(D,t,y,o,f,x){const p=I("router-link");return g(),T(o.AdminLayout,null,{default:k(()=>[e("div",K,[i(" Page Header "),e("div",Q,[B(p,{to:"/pipelines",class:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},{default:k(()=>[...t[3]||(t[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),_:1}),t[4]||(t[4]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Edit Pipeline"),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Update pipeline settings and stages ")],-1))]),i(" Loading State "),o.loading&&!o.pipeline?(g(),b("div",X,[...t[5]||(t[5]=[e("div",{class:"inline-block w-8 h-8 border-4 border-brand-500 border-t-transparent rounded-full animate-spin"},null,-1),e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"Loading pipeline...",-1)])])):(g(),b(L,{key:1},[i(" Form "),e("form",{onSubmit:O(o.handleSubmit,["prevent"]),class:"space-y-6"},[i(" Basic Info "),e("div",Y,[t[9]||(t[9]=e("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Basic Information",-1)),e("div",Z,[e("div",null,[t[6]||(t[6]=e("label",{for:"name",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Pipeline Name * ",-1)),u(e("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=r=>o.form.name=r),type:"text",required:"",class:"w-full px-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white",placeholder:"e.g., Sales Pipeline"},null,512),[[m,o.form.name]])]),e("div",null,[t[7]||(t[7]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Description ",-1)),u(e("textarea",{id:"description","onUpdate:modelValue":t[1]||(t[1]=r=>o.form.description=r),rows:"3",class:"w-full px-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white",placeholder:"Describe the purpose of this pipeline..."},null,512),[[m,o.form.description]])]),e("div",$,[u(e("input",{id:"is_active","onUpdate:modelValue":t[2]||(t[2]=r=>o.form.is_active=r),type:"checkbox",class:"rounded border-gray-300 text-brand-600 focus:ring-brand-500"},null,512),[[h,o.form.is_active]]),t[8]||(t[8]=e("label",{for:"is_active",class:"ml-2 text-sm text-gray-600 dark:text-gray-400"}," Pipeline is active ",-1))])])]),i(" Stages "),e("div",ee,[e("div",{class:"flex items-center justify-between mb-4"},[t[11]||(t[11]=e("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Stages",-1)),e("button",{type:"button",onClick:o.addStage,class:"inline-flex items-center gap-1 text-sm text-brand-600 hover:text-brand-700"},[...t[10]||(t[10]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),_(" Add Stage ",-1)])])]),e("div",te,[(g(!0),b(L,null,z(o.form.stages,(r,a)=>(g(),b("div",{key:r.id||a,class:"flex items-start gap-3 p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg"},[i(" Drag Handle "),t[17]||(t[17]=e("div",{class:"flex-shrink-0 cursor-move text-gray-400 mt-2"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 8h16M4 16h16"})])],-1)),i(" Color Picker "),e("div",re,[u(e("input",{type:"color","onUpdate:modelValue":n=>r.color=n,class:"w-8 h-8 rounded cursor-pointer border-0"},null,8,ae),[[m,r.color]])]),i(" Stage Details "),e("div",oe,[e("div",se,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Name",-1)),u(e("input",{"onUpdate:modelValue":n=>r.name=n,type:"text",required:"",class:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white",placeholder:"Stage name"},null,8,ne),[[m,r.name]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Probability (%)",-1)),u(e("input",{"onUpdate:modelValue":n=>r.probability=n,type:"number",min:"0",max:"100",class:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,8,ie),[[m,r.probability,void 0,{number:!0}]])])]),e("div",le,[e("label",de,[u(e("input",{type:"checkbox","onUpdate:modelValue":n=>r.is_won=n,onChange:n=>o.handleWonChange(a),class:"rounded border-gray-300 text-brand-600 focus:ring-brand-500"},null,40,ue),[[h,r.is_won]]),t[14]||(t[14]=e("span",{class:"ml-2 text-sm text-gray-600 dark:text-gray-400"},"Won Stage",-1))]),e("label",ge,[u(e("input",{type:"checkbox","onUpdate:modelValue":n=>r.is_lost=n,onChange:n=>o.handleLostChange(a),class:"rounded border-gray-300 text-brand-600 focus:ring-brand-500"},null,40,pe),[[h,r.is_lost]]),t[15]||(t[15]=e("span",{class:"ml-2 text-sm text-gray-600 dark:text-gray-400"},"Lost Stage",-1))]),r.deal_count?(g(),b("span",ce,j(r.deal_count)+" deals ",1)):i("v-if",!0)])]),i(" Remove Button "),e("button",{type:"button",onClick:n=>o.removeStage(a),class:"flex-shrink-0 p-1 text-gray-400 hover:text-red-600",disabled:o.form.stages.length<=2||r.deal_count>0,title:r.deal_count>0?"Cannot delete stage with deals":""},[...t[16]||(t[16]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,be)]))),128))]),t[18]||(t[18]=e("p",{class:"mt-3 text-xs text-gray-500 dark:text-gray-400"}," Tip: Stages with deals cannot be deleted. Move deals to another stage first. ",-1))]),i(" Actions "),e("div",me,[B(p,{to:"/pipelines",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700"},{default:k(()=>[...t[19]||(t[19]=[_(" Cancel ",-1)])]),_:1}),e("button",{type:"submit",disabled:o.saving,class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-brand-600 rounded-lg hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed"},[o.saving?(g(),b("span",fe)):i("v-if",!0),_(" "+j(o.saving?"Saving...":"Save Changes"),1)],8,ye)])],32)],2112))])]),_:1})}const we=q(J,[["render",xe],["__file","/home/btafoya/projects/openclient/resources/js/src/views/Pipelines/PipelineEdit.vue"]]);export{we as default};
