import{J as E,r as f,q as h}from"./main-DU1UAF-x.js";import{a as c}from"./index-B9ygI19o.js";const j=E("clients",()=>{const r=f([]),o=f(null),u=f(!1),s=f(null),d=f(""),y=h(()=>r.value.filter(a=>a.is_active)),m=h(()=>{if(!d.value)return r.value;const a=d.value.toLowerCase();return r.value.filter(l=>{var t,e,n;return((t=l.name)==null?void 0:t.toLowerCase().includes(a))||((e=l.email)==null?void 0:e.toLowerCase().includes(a))||((n=l.company)==null?void 0:n.toLowerCase().includes(a))})}),w=h(()=>r.value.length),C=h(()=>y.value.length);async function g(a=!0){var l,t;u.value=!0,s.value=null;try{const e=await c.get("/api/clients",{params:{active_only:a}});return r.value=e.data.data||[],r.value}catch(e){throw s.value=((t=(l=e.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to fetch clients",e}finally{u.value=!1}}async function F(a){var l,t;u.value=!0,s.value=null;try{const e=await c.get(`/api/clients/${a}`);return o.value=e.data.data,o.value}catch(e){throw s.value=((t=(l=e.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to fetch client",e}finally{u.value=!1}}async function x(a){var l,t;u.value=!0,s.value=null;try{const n=(await c.post("/api/clients",a)).data.data;return r.value.push(n),n}catch(e){throw s.value=((t=(l=e.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to create client",e}finally{u.value=!1}}async function $(a,l){var t,e,n;u.value=!0,s.value=null;try{const v=(await c.put(`/api/clients/${a}`,l)).data.data,p=r.value.findIndex(D=>D.id===a);return p!==-1&&(r.value[p]=v),((t=o.value)==null?void 0:t.id)===a&&(o.value=v),v}catch(i){throw s.value=((n=(e=i.response)==null?void 0:e.data)==null?void 0:n.message)||"Failed to update client",i}finally{u.value=!1}}async function L(a,l=!1){var t,e,n;u.value=!0,s.value=null;try{return await c.delete(`/api/clients/${a}`,{params:{purge:l}}),r.value=r.value.filter(i=>i.id!==a),((t=o.value)==null?void 0:t.id)===a&&(o.value=null),!0}catch(i){throw s.value=((n=(e=i.response)==null?void 0:e.data)==null?void 0:n.message)||"Failed to delete client",i}finally{u.value=!1}}async function S(a){var l,t,e;u.value=!0,s.value=null;try{const i=(await c.post(`/api/clients/${a}/toggle-active`)).data.data,v=r.value.findIndex(p=>p.id===a);return v!==-1&&(r.value[v]=i),((l=o.value)==null?void 0:l.id)===a&&(o.value=i),i}catch(n){throw s.value=((e=(t=n.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to toggle client status",n}finally{u.value=!1}}async function _(a,l=!0){var t,e;if(!a)return g(l);u.value=!0,s.value=null;try{const n=await c.get("/api/clients/search",{params:{term:a,active_only:l}});return r.value=n.data.data||[],r.value}catch(n){throw s.value=((e=(t=n.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to search clients",n}finally{u.value=!1}}async function I(a){var l,t;try{return(await c.get(`/api/clients/${a}/validate-delete`)).data}catch(e){throw s.value=((t=(l=e.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to validate deletion",e}}function T(a){d.value=a}function q(){s.value=null}function A(){r.value=[],o.value=null,u.value=!1,s.value=null,d.value=""}return{clients:r,currentClient:o,loading:u,error:s,searchTerm:d,activeClients:y,filteredClients:m,clientCount:w,activeClientCount:C,fetchClients:g,fetchClient:F,createClient:x,updateClient:$,deleteClient:L,toggleActive:S,searchClients:_,validateDelete:I,setSearchTerm:T,clearError:q,reset:A}});export{j as u};
