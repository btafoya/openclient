import{_ as Z,b as $,h as tt,i as j,I as P,H as T,r as _,q as v,k as N,o as i,e as t,d as a,c as l,F as h,l as A,t as u,j as y,C as et,w as c,g as U,z as F,v as b}from"./main-CeUa7Jrx.js";import{u as R}from"./invoices-Cw5eD3L8.js";import{u as H}from"./clients-CIVaTSep.js";import{u as z}from"./projects-ITvZMXmG.js";import{A as rt}from"./AdminLayout-B_43-oU8.js";import"./index-B9ygI19o.js";const ot={__name:"InvoiceEdit",setup(O,{expose:e}){e();const I=P(),r=T(),f=R(),C=H(),g=z(),o=_(!0),p=_(null),m=_(!1),D=_(null),n=_({client_id:"",project_id:"",invoice_date:"",due_date:"",discount:0,tax_rate:0,notes:"",terms:"",line_items:[]}),Q=v(()=>f.currentInvoice),G=v(()=>C.activeClients),J=v(()=>n.value.client_id?g.projects.filter(s=>s.client_id===n.value.client_id):g.activeProjects),S=v(()=>n.value.line_items.reduce((s,x)=>s+x.quantity*x.rate,0)),L=v(()=>(S.value-(n.value.discount||0))*((n.value.tax_rate||0)/100)),B=v(()=>S.value-(n.value.discount||0)+L.value);function K(){n.value.line_items.push({description:"",quantity:1,rate:0})}function W(s){n.value.line_items.length>1&&n.value.line_items.splice(s,1)}async function E(){var s,x,k,V,w;o.value=!0,p.value=null;try{if(await Promise.all([f.fetchInvoice(I.params.id),C.fetchClients(),g.fetchProjects()]),f.currentInvoice){const d=f.currentInvoice;n.value={client_id:d.client_id||"",project_id:d.project_id||"",invoice_date:((s=d.invoice_date)==null?void 0:s.split("T")[0])||"",due_date:((x=d.due_date)==null?void 0:x.split("T")[0])||"",discount:d.discount||0,tax_rate:d.tax_rate||0,notes:d.notes||"",terms:d.terms||"",line_items:((k=d.line_items)==null?void 0:k.length)>0?d.line_items.map(q=>({id:q.id,description:q.description,quantity:q.quantity,rate:q.rate})):[{description:"",quantity:1,rate:0}]}}}catch(d){p.value=((w=(V=d.response)==null?void 0:V.data)==null?void 0:w.error)||"Failed to load invoice"}finally{o.value=!1}}async function X(){var s,x;m.value=!0,D.value=null;try{const k=n.value.line_items.map(w=>({...w,amount:w.quantity*w.rate})),V={...n.value,line_items:k,subtotal:S.value,tax:L.value,total:B.value};await f.updateInvoice(I.params.id,V),r.push(`/invoices/${I.params.id}`)}catch(k){D.value=((x=(s=k.response)==null?void 0:s.data)==null?void 0:x.error)||"Failed to update invoice"}finally{m.value=!1}}function Y(s){return Number(s||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}N(()=>{E()});const M={route:I,router:r,invoiceStore:f,clientStore:C,projectStore:g,loading:o,loadError:p,saving:m,error:D,form:n,invoice:Q,clients:G,filteredProjects:J,subtotal:S,taxAmount:L,total:B,addLineItem:K,removeLineItem:W,loadInvoice:E,updateInvoice:X,formatCurrency:Y,ref:_,computed:v,onMounted:N,get useRoute(){return P},get useRouter(){return T},get useInvoiceStore(){return R},get useClientStore(){return H},get useProjectStore(){return z},AdminLayout:rt};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}},at={class:"space-y-6"},st={key:0,class:"flex items-center justify-center py-12"},nt={class:"p-8 text-center"},dt={class:"mt-4 text-sm text-gray-900 dark:text-white font-medium"},it={class:"p-8 text-center"},lt={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},ut={class:"font-medium capitalize"},ct={class:"flex items-center gap-3"},mt={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},gt={class:"rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-6"},bt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},xt=["value"],yt=["value"],ft={class:"rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-6"},vt={class:"space-y-4"},pt={class:"col-span-12 sm:col-span-5"},kt=["onUpdate:modelValue"],wt={class:"col-span-4 sm:col-span-2"},_t=["onUpdate:modelValue"],ht={class:"col-span-4 sm:col-span-2"},It=["onUpdate:modelValue"],jt={class:"col-span-3 sm:col-span-2"},Ct={class:"px-3 py-2 text-sm font-medium text-gray-900 dark:text-white"},St={class:"col-span-1 flex items-end"},Vt=["onClick","disabled"],qt={class:"mt-6 flex flex-col items-end space-y-3"},At={class:"flex items-center gap-4 w-72"},Dt={class:"ml-auto font-medium text-gray-900 dark:text-white"},Lt={class:"flex items-center gap-4 w-72"},Ut={class:"ml-auto flex items-center gap-2"},Bt={class:"flex items-center gap-4 w-72"},Et={class:"ml-auto flex items-center gap-2"},Mt={class:"flex items-center gap-4 w-72"},Pt={class:"ml-auto font-medium text-gray-900 dark:text-white"},Tt={class:"flex items-center gap-4 w-72 pt-3 border-t border-gray-200 dark:border-gray-700"},Nt={class:"ml-auto text-lg font-bold text-gray-900 dark:text-white"},Ft={class:"rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-6"},Rt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ht={key:0,class:"p-4 rounded-lg bg-red-50 dark:bg-red-900/20"},zt={class:"text-sm text-red-700 dark:text-red-400"},Ot={class:"flex items-center justify-end gap-4"},Qt=["disabled"];function Gt(O,e,I,r,f,C){const g=$("router-link");return i(),tt(r.AdminLayout,null,{default:j(()=>[t("div",at,[a(" Loading State "),r.loading?(i(),l("div",st,[...e[8]||(e[8]=[t("div",{class:"inline-block w-8 h-8 border-4 border-brand-500 border-t-transparent rounded-full animate-spin"},null,-1)])])):r.loadError?(i(),l(h,{key:1},[a(" Error State "),t("div",nt,[e[10]||(e[10]=t("div",{class:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/20"},[t("svg",{class:"w-6 h-6 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1)),t("p",dt,u(r.loadError),1),A(g,{to:"/invoices",class:"mt-4 inline-block px-4 py-2 text-sm font-medium text-brand-600 hover:text-brand-700"},{default:j(()=>[...e[9]||(e[9]=[y(" Back to Invoices ",-1)])]),_:1})])],2112)):r.invoice&&r.invoice.status!=="draft"?(i(),l(h,{key:2},[a(" Not Editable State "),t("div",it,[e[13]||(e[13]=t("div",{class:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-yellow-100 dark:bg-yellow-900/20"},[t("svg",{class:"w-6 h-6 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e[14]||(e[14]=t("p",{class:"mt-4 text-sm text-gray-900 dark:text-white font-medium"}," Only draft invoices can be edited ",-1)),t("p",lt,[e[11]||(e[11]=y(" This invoice has status: ",-1)),t("span",ut,u(r.invoice.status),1)]),A(g,{to:`/invoices/${r.invoice.id}`,class:"mt-4 inline-block px-4 py-2 text-sm font-medium text-brand-600 hover:text-brand-700"},{default:j(()=>[...e[12]||(e[12]=[y(" View Invoice ",-1)])]),_:1},8,["to"])])],2112)):r.invoice?(i(),l(h,{key:3},[a(" Edit Form "),a(" Page Header "),t("div",ct,[A(g,{to:`/invoices/${r.invoice.id}`,class:"p-1.5 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"},{default:j(()=>[...e[15]||(e[15]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),_:1},8,["to"]),t("div",null,[e[16]||(e[16]=t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Edit Invoice",-1)),t("p",mt,u(r.invoice.invoice_number),1)])]),a(" Invoice Form "),t("form",{onSubmit:et(r.updateInvoice,["prevent"]),class:"space-y-6"},[a(" Basic Info "),t("div",gt,[e[23]||(e[23]=t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Invoice Details",-1)),t("div",bt,[a(" Client "),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[y(" Client "),t("span",{class:"text-red-500"},"*")],-1)),c(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.form.client_id=o),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},[e[17]||(e[17]=t("option",{value:""},"Select a client...",-1)),(i(!0),l(h,null,U(r.clients,o=>(i(),l("option",{key:o.id,value:o.id},u(o.name),9,xt))),128))],512),[[F,r.form.client_id]])]),a(" Project "),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Project (Optional) ",-1)),c(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.form.project_id=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},[e[19]||(e[19]=t("option",{value:""},"No project",-1)),(i(!0),l(h,null,U(r.filteredProjects,o=>(i(),l("option",{key:o.id,value:o.id},u(o.name),9,yt))),128))],512),[[F,r.form.project_id]])]),a(" Invoice Date "),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[y(" Invoice Date "),t("span",{class:"text-red-500"},"*")],-1)),c(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.form.invoice_date=o),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,512),[[b,r.form.invoice_date]])]),a(" Due Date "),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[y(" Due Date "),t("span",{class:"text-red-500"},"*")],-1)),c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.form.due_date=o),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,512),[[b,r.form.due_date]])])])]),a(" Line Items "),t("div",ft,[t("div",{class:"flex items-center justify-between mb-4"},[e[25]||(e[25]=t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Line Items",-1)),t("button",{type:"button",onClick:r.addLineItem,class:"inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-brand-600 hover:text-brand-700"},[...e[24]||(e[24]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),y(" Add Item ",-1)])])]),t("div",vt,[(i(!0),l(h,null,U(r.form.line_items,(o,p)=>(i(),l("div",{key:p,class:"grid grid-cols-12 gap-4 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg"},[a(" Description "),t("div",pt,[e[26]||(e[26]=t("label",{class:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1"},"Description",-1)),c(t("input",{"onUpdate:modelValue":m=>o.description=m,type:"text",required:"",placeholder:"Service or product description",class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,8,kt),[[b,o.description]])]),a(" Quantity "),t("div",wt,[e[27]||(e[27]=t("label",{class:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1"},"Qty",-1)),c(t("input",{"onUpdate:modelValue":m=>o.quantity=m,type:"number",min:"0.01",step:"0.01",required:"",class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,8,_t),[[b,o.quantity,void 0,{number:!0}]])]),a(" Rate "),t("div",ht,[e[28]||(e[28]=t("label",{class:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1"},"Rate ($)",-1)),c(t("input",{"onUpdate:modelValue":m=>o.rate=m,type:"number",min:"0",step:"0.01",required:"",class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,8,It),[[b,o.rate,void 0,{number:!0}]])]),a(" Amount "),t("div",jt,[e[29]||(e[29]=t("label",{class:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1"},"Amount",-1)),t("p",Ct," $"+u(r.formatCurrency(o.quantity*o.rate)),1)]),a(" Remove Button "),t("div",St,[t("button",{type:"button",onClick:m=>r.removeLineItem(p),disabled:r.form.line_items.length===1,class:"p-2 text-gray-400 hover:text-red-600 disabled:opacity-50 disabled:cursor-not-allowed"},[...e[30]||(e[30]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Vt)])]))),128))]),a(" Totals "),t("div",qt,[t("div",At,[e[31]||(e[31]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Subtotal",-1)),t("span",Dt,"$"+u(r.formatCurrency(r.subtotal)),1)]),t("div",Lt,[e[33]||(e[33]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Discount",-1)),t("div",Ut,[e[32]||(e[32]=t("span",{class:"text-gray-500"},"$",-1)),c(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.form.discount=o),type:"number",min:"0",step:"0.01",class:"w-24 px-2 py-1 text-sm text-right border border-gray-300 rounded focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,512),[[b,r.form.discount,void 0,{number:!0}]])])]),t("div",Bt,[e[35]||(e[35]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Tax Rate",-1)),t("div",Et,[c(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>r.form.tax_rate=o),type:"number",min:"0",max:"100",step:"0.01",class:"w-20 px-2 py-1 text-sm text-right border border-gray-300 rounded focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,512),[[b,r.form.tax_rate,void 0,{number:!0}]]),e[34]||(e[34]=t("span",{class:"text-gray-500"},"%",-1))])]),t("div",Mt,[e[36]||(e[36]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Tax Amount",-1)),t("span",Pt,"$"+u(r.formatCurrency(r.taxAmount)),1)]),t("div",Tt,[e[37]||(e[37]=t("span",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Total",-1)),t("span",Nt,"$"+u(r.formatCurrency(r.total)),1)])])]),a(" Notes & Terms "),t("div",Ft,[e[40]||(e[40]=t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Additional Information",-1)),t("div",Rt,[a(" Notes "),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Notes (visible to client) ",-1)),c(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=o=>r.form.notes=o),rows:"4",placeholder:"Additional notes or instructions...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,512),[[b,r.form.notes]])]),a(" Terms "),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Terms & Conditions ",-1)),c(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=o=>r.form.terms=o),rows:"4",placeholder:"Payment terms, late fees, etc...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,512),[[b,r.form.terms]])])])]),a(" Error Message "),r.error?(i(),l("div",Ht,[t("p",zt,u(r.error),1)])):a("v-if",!0),a(" Form Actions "),t("div",Ot,[A(g,{to:`/invoices/${r.invoice.id}`,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600"},{default:j(()=>[...e[41]||(e[41]=[y(" Cancel ",-1)])]),_:1},8,["to"]),t("button",{type:"submit",disabled:r.saving,class:"px-6 py-2 text-sm font-medium text-white bg-brand-600 rounded-lg hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed"},u(r.saving?"Saving...":"Save Changes"),9,Qt)])],32)],64)):a("v-if",!0)])]),_:1})}const $t=Z(ot,[["render",Gt],["__file","/home/btafoya/projects/openclient/resources/js/src/views/Invoices/InvoiceEdit.vue"]]);export{$t as default};
