import{J as R,r as y,q as f}from"./main-Dc7XXzbq.js";import{a as p}from"./index-B9ygI19o.js";const X=R("proposals",()=>{const u=y([]),c=y(null),i=y([]),s=y(!1),o=y(null),h=y(""),F=f(()=>u.value.filter(e=>e.status==="draft")),P=f(()=>u.value.filter(e=>["sent","viewed"].includes(e.status))),$=f(()=>u.value.filter(e=>e.status==="accepted")),T=f(()=>u.value.filter(e=>e.status==="rejected")),x=f(()=>{if(!h.value)return u.value;const e=h.value.toLowerCase();return u.value.filter(r=>{var t,a,l;return((t=r.title)==null?void 0:t.toLowerCase().includes(e))||((a=r.client_name)==null?void 0:a.toLowerCase().includes(e))||((l=r.project_name)==null?void 0:l.toLowerCase().includes(e))})}),S=f(()=>u.value.length),g=f(()=>u.value.filter(e=>e.status==="accepted").reduce((e,r)=>e+parseFloat(r.total||0),0)),m={draft:["sent"],sent:["viewed","accepted","rejected","expired"],viewed:["accepted","rejected","expired"],accepted:[],rejected:["draft"],expired:["draft"]};async function j(e={}){var r,t;s.value=!0,o.value=null;try{const a=await p.get("/api/proposals",{params:e});return u.value=a.data.data||[],u.value}catch(a){throw o.value=((t=(r=a.response)==null?void 0:r.data)==null?void 0:t.error)||"Failed to fetch proposals",a}finally{s.value=!1}}async function C(e){var r,t;s.value=!0,o.value=null;try{const a=await p.get(`/api/proposals/${e}`);return c.value=a.data.data,c.value}catch(a){throw o.value=((t=(r=a.response)==null?void 0:r.data)==null?void 0:t.error)||"Failed to fetch proposal",a}finally{s.value=!1}}async function I(e){var r,t;s.value=!0,o.value=null;try{const l=(await p.post("/api/proposals",e)).data.data;return u.value.unshift(l),l}catch(a){throw o.value=((t=(r=a.response)==null?void 0:r.data)==null?void 0:t.error)||"Failed to create proposal",a}finally{s.value=!1}}async function L(e,r){var t,a,l;s.value=!0,o.value=null;try{const d=(await p.put(`/api/proposals/${e}`,r)).data.data,v=u.value.findIndex(w=>w.id===e);return v!==-1&&(u.value[v]=d),((t=c.value)==null?void 0:t.id)===e&&(c.value=d),d}catch(n){throw o.value=((l=(a=n.response)==null?void 0:a.data)==null?void 0:l.error)||"Failed to update proposal",n}finally{s.value=!1}}async function _(e){var r,t,a;s.value=!0,o.value=null;try{return await p.delete(`/api/proposals/${e}`),u.value=u.value.filter(l=>l.id!==e),((r=c.value)==null?void 0:r.id)===e&&(c.value=null),!0}catch(l){throw o.value=((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to delete proposal",l}finally{s.value=!1}}async function b(e,r={}){var t,a,l;s.value=!0,o.value=null;try{const n=await p.post(`/api/proposals/${e}/send`,r),d=n.data.data,v=u.value.findIndex(w=>w.id===e);return v!==-1&&(u.value[v]=d),((t=c.value)==null?void 0:t.id)===e&&(c.value=d),n.data}catch(n){throw o.value=((l=(a=n.response)==null?void 0:a.data)==null?void 0:l.error)||"Failed to send proposal",n}finally{s.value=!1}}async function q(e,r={}){var t,a;s.value=!0,o.value=null;try{return(await p.post(`/api/proposals/${e}/convert-to-invoice`,r)).data.data}catch(l){throw o.value=((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to convert to invoice",l}finally{s.value=!1}}async function A(e,r=null){var t,a;s.value=!0,o.value=null;try{const n=(await p.post(`/api/proposals/${e}/duplicate`,{title:r})).data.data;return u.value.unshift(n),n}catch(l){throw o.value=((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to duplicate proposal",l}finally{s.value=!1}}async function E(e=!0){var r,t;s.value=!0,o.value=null;try{const a=await p.get("/api/proposal-templates",{params:{active_only:e}});return i.value=a.data.data||[],i.value}catch(a){throw o.value=((t=(r=a.response)==null?void 0:r.data)==null?void 0:t.error)||"Failed to fetch templates",a}finally{s.value=!1}}async function J(e){var r,t;s.value=!0,o.value=null;try{const l=(await p.post("/api/proposal-templates",e)).data.data;return i.value.unshift(l),l}catch(a){throw o.value=((t=(r=a.response)==null?void 0:r.data)==null?void 0:t.error)||"Failed to create template",a}finally{s.value=!1}}async function V(e,r){var t,a;s.value=!0,o.value=null;try{const n=(await p.put(`/api/proposal-templates/${e}`,r)).data.data,d=i.value.findIndex(v=>v.id===e);return d!==-1&&(i.value[d]=n),n}catch(l){throw o.value=((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to update template",l}finally{s.value=!1}}async function k(e){var r,t;s.value=!0,o.value=null;try{return await p.delete(`/api/proposal-templates/${e}`),i.value=i.value.filter(a=>a.id!==e),!0}catch(a){throw o.value=((t=(r=a.response)==null?void 0:r.data)==null?void 0:t.error)||"Failed to delete template",a}finally{s.value=!1}}async function z(e,r=null){var t,a;s.value=!0,o.value=null;try{const n=(await p.post(`/api/proposal-templates/${e}/duplicate`,{name:r})).data.data;return i.value.unshift(n),n}catch(l){throw o.value=((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to duplicate template",l}finally{s.value=!1}}async function B(e,r){var t,a;s.value=!0,o.value=null;try{return(await p.post(`/api/proposals/${e}/sections`,r)).data.data}catch(l){throw o.value=((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to add section",l}finally{s.value=!1}}async function D(e,r,t){var a,l;s.value=!0,o.value=null;try{return(await p.put(`/api/proposals/${e}/sections/${r}`,t)).data.data}catch(n){throw o.value=((l=(a=n.response)==null?void 0:a.data)==null?void 0:l.error)||"Failed to update section",n}finally{s.value=!1}}async function G(e,r){var t,a;s.value=!0,o.value=null;try{return await p.delete(`/api/proposals/${e}/sections/${r}`),!0}catch(l){throw o.value=((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to delete section",l}finally{s.value=!1}}async function H(e,r){var t,a;s.value=!0,o.value=null;try{return(await p.post(`/api/proposals/${e}/sections/reorder`,{section_ids:r})).data.data}catch(l){throw o.value=((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to reorder sections",l}finally{s.value=!1}}function K(e,r){return(m[e]||[]).includes(r)}function M(e){return m[e]||[]}function N(e){h.value=e}function O(){o.value=null}function Q(){u.value=[],c.value=null,i.value=[],s.value=!1,o.value=null,h.value=""}return{proposals:u,currentProposal:c,templates:i,loading:s,error:o,searchTerm:h,draftProposals:F,sentProposals:P,acceptedProposals:$,rejectedProposals:T,filteredProposals:x,proposalCount:S,totalValue:g,fetchProposals:j,fetchProposal:C,createProposal:I,updateProposal:L,deleteProposal:_,sendProposal:b,convertToInvoice:q,duplicateProposal:A,fetchTemplates:E,createTemplate:J,updateTemplate:V,deleteTemplate:k,duplicateTemplate:z,addSection:B,updateSection:D,deleteSection:G,reorderSections:H,canTransitionTo:K,getAvailableStatuses:M,setSearchTerm:N,clearError:O,reset:Q}});export{X as u};
