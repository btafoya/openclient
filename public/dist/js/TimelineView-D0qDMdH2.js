import{_ as U,b as A,h,i as C,r as c,k as T,s,o as l,e,w as b,z,v as E,c as u,t as d,F as I,g as N,n as V,G as R,d as j,j as P}from"./main-DU5QQqOg.js";import{a as S}from"./index-B9ygI19o.js";import{A as G}from"./AdminLayout-k0cXXt9e.js";const O={__name:"TimelineView",setup(M,{expose:a}){a();const g=c(!1),t=c(null),m=c(""),x=c(""),p=c(""),r=c([]);let y=null;async function v(){var o,n;g.value=!0,t.value=null;try{const i=new URLSearchParams;m.value&&i.append("entity_type",m.value),x.value&&i.append("event_type",x.value),p.value&&i.append("search",p.value),i.append("limit","50");const f=await S.get(`/api/timeline?${i.toString()}`);r.value=f.data||[]}catch(i){t.value=((n=(o=i.response)==null?void 0:o.data)==null?void 0:n.error)||"Failed to load timeline",console.error("Timeline error:",i)}finally{g.value=!1}}function B(){clearTimeout(y),y=setTimeout(()=>{v()},300)}function H(o){return{client:`/crm/clients/${o.entity_id}`,contact:`/crm/contacts/${o.entity_id}`,project:`/projects/${o.entity_id}`,note:"/crm/notes",task:"/projects",invoice:`/invoices/${o.entity_id}`}[o.entity_type]||"#"}function _(o){const n={client:"bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400",contact:"bg-green-100 text-green-600 dark:bg-green-900/20 dark:text-green-400",note:"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/20 dark:text-yellow-400",project:"bg-purple-100 text-purple-600 dark:bg-purple-900/20 dark:text-purple-400",task:"bg-orange-100 text-orange-600 dark:bg-orange-900/20 dark:text-orange-400",invoice:"bg-pink-100 text-pink-600 dark:bg-pink-900/20 dark:text-pink-400"};return n[o]||n.client}function D(o){return _(o)}function L(o){const n={client:s("svg",{fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{d:"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z"})]),contact:s("svg",{fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z","clip-rule":"evenodd"})]),note:s("svg",{fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z","clip-rule":"evenodd"})]),project:s("svg",{fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 6a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zm1 5a1 1 0 00-1 1v2a1 1 0 001 1h12a1 1 0 001-1v-2a1 1 0 00-1-1H4z","clip-rule":"evenodd"})]),task:s("svg",{fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),invoice:s("svg",{fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z","clip-rule":"evenodd"})])};return n[o]||n.client}function F(o){if(!o)return"";const n=new Date(o),f=new Date-n,k=Math.floor(f/(1e3*60*60*24));return k===0?n.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):k===1?"Yesterday":k<7?n.toLocaleDateString("en-US",{weekday:"short"}):n.toLocaleDateString("en-US",{month:"short",day:"numeric"})}T(()=>v());const w={loading:g,error:t,entityFilter:m,eventTypeFilter:x,searchTerm:p,events:r,get debounceTimer(){return y},set debounceTimer(o){y=o},loadEvents:v,debouncedSearch:B,getVueRoute:H,getIconClasses:_,getTypeClasses:D,getIcon:L,formatDate:F,ref:c,h:s,onMounted:T,get axios(){return S},AdminLayout:G};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}},Y={class:"space-y-6"},q={class:"flex flex-col gap-4 sm:flex-row sm:items-center"},J={class:"flex-1 relative"},K={class:"space-y-4"},Q={key:0,class:"p-8 text-center"},W={key:1,class:"p-8 text-center rounded-lg border border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/20"},X={class:"text-sm text-red-700 dark:text-red-400"},Z={key:2,class:"p-8 text-center rounded-lg border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},$={key:3,class:"space-y-4"},ee={class:"flex-1 min-w-0"},te={class:"flex items-start justify-between gap-4"},re={class:"text-sm font-medium text-gray-900 dark:text-white"},ae={class:"mt-1 flex flex-wrap items-center gap-2 text-xs text-gray-500 dark:text-gray-400"},oe={key:1},ne={class:"flex-shrink-0 text-xs text-gray-500 dark:text-gray-400"},se={class:"mt-2 flex flex-wrap gap-2"},le={class:"inline-flex items-center gap-1.5 px-2.5 py-0.5 text-xs font-medium rounded-full bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300 capitalize"};function ie(M,a,g,t,m,x){const p=A("router-link");return l(),h(t.AdminLayout,null,{default:C(()=>[e("div",Y,[a[8]||(a[8]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Timeline"),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"View chronological activity across clients, contacts, notes, and projects")],-1)),e("div",q,[b(e("select",{"onUpdate:modelValue":a[0]||(a[0]=r=>t.entityFilter=r),onChange:t.loadEvents,class:"px-4 py-2 text-sm border border-gray-300 rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"},[...a[3]||(a[3]=[e("option",{value:""},"All Types",-1),e("option",{value:"client"},"Clients",-1),e("option",{value:"contact"},"Contacts",-1),e("option",{value:"note"},"Notes",-1),e("option",{value:"project"},"Projects",-1),e("option",{value:"task"},"Tasks",-1),e("option",{value:"invoice"},"Invoices",-1)])],544),[[z,t.entityFilter]]),b(e("select",{"onUpdate:modelValue":a[1]||(a[1]=r=>t.eventTypeFilter=r),onChange:t.loadEvents,class:"px-4 py-2 text-sm border border-gray-300 rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"},[...a[4]||(a[4]=[e("option",{value:""},"All Events",-1),e("option",{value:"created"},"Created",-1),e("option",{value:"updated"},"Updated",-1),e("option",{value:"deleted"},"Deleted",-1),e("option",{value:"status_changed"},"Status Changed",-1)])],544),[[z,t.eventTypeFilter]]),e("div",J,[b(e("input",{"onUpdate:modelValue":a[2]||(a[2]=r=>t.searchTerm=r),onInput:t.debouncedSearch,type:"text",placeholder:"Search timeline...",class:"w-full px-4 py-2 pl-10 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,544),[[E,t.searchTerm]]),a[5]||(a[5]=e("svg",{class:"absolute left-3 top-2.5 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),e("button",{onClick:t.loadEvents,class:"px-4 py-2 text-sm font-medium text-white bg-brand-600 rounded-lg hover:bg-brand-700"}," Refresh ")]),e("div",K,[t.loading?(l(),u("div",Q,[...a[6]||(a[6]=[e("div",{class:"inline-block w-8 h-8 border-4 border-brand-500 border-t-transparent rounded-full animate-spin"},null,-1),e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"Loading timeline...",-1)])])):t.error?(l(),u("div",W,[e("p",X,d(t.error),1),e("button",{onClick:t.loadEvents,class:"mt-2 text-sm text-red-600 hover:underline"},"Try again")])):t.events.length===0?(l(),u("div",Z,[...a[7]||(a[7]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),e("p",{class:"mt-2 text-sm text-gray-900 dark:text-white font-medium"},"No events found",-1),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"Try adjusting your filters or check back later",-1)])])):(l(),u("div",$,[(l(!0),u(I,null,N(t.events,r=>(l(),u("div",{key:r.id,class:"flex gap-4 rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-800 dark:bg-gray-900 hover:shadow-sm transition-shadow"},[e("div",{class:V([t.getIconClasses(r.entity_type),"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full"])},[(l(),h(R(t.getIcon(r.entity_type)),{class:"h-5 w-5"}))],2),e("div",ee,[e("div",te,[e("div",null,[e("p",re,d(r.description),1),e("div",ae,[r.entity_url?(l(),h(p,{key:0,to:t.getVueRoute(r),class:"text-brand-600 hover:underline"},{default:C(()=>[P(d(r.entity_name),1)]),_:2},1032,["to"])):j("v-if",!0),r.user_first_name?(l(),u("span",oe," by "+d(r.user_first_name)+" "+d(r.user_last_name),1)):j("v-if",!0)])]),e("span",ne,d(t.formatDate(r.created_at)),1)]),e("div",se,[e("span",{class:V([t.getTypeClasses(r.entity_type),"inline-flex items-center gap-1.5 px-2.5 py-0.5 text-xs font-medium rounded-full capitalize"])},d(r.entity_type),3),e("span",le,d(r.event_type.replace("_"," ")),1)])])]))),128))]))])])]),_:1})}const pe=U(O,[["render",ie],["__file","/home/btafoya/projects/openclient/resources/js/src/views/CRM/Timeline/TimelineView.vue"]]);export{pe as default};
