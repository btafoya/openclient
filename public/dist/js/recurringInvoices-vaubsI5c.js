import{J as j,r as f,q as p}from"./main-DU1UAF-x.js";import{a as v}from"./index-B9ygI19o.js";const K=j("recurringInvoices",()=>{const c=f([]),i=f(null),y=f([]),u=f(!1),l=f(null),h=f(""),g=p(()=>c.value.filter(e=>e.status==="active")),m=p(()=>c.value.filter(e=>e.status==="paused")),x=p(()=>c.value.filter(e=>e.status==="expired")),F=p(()=>{if(!h.value)return c.value;const e=h.value.toLowerCase();return c.value.filter(t=>{var a,r,n;return((a=t.title)==null?void 0:a.toLowerCase().includes(e))||((r=t.client_name)==null?void 0:r.toLowerCase().includes(e))||((n=t.description)==null?void 0:n.toLowerCase().includes(e))})}),b=p(()=>c.value.length),I=p(()=>g.value.reduce((e,t)=>{const a=parseFloat(t.amount||0);switch(t.frequency){case"weekly":return e+a*4.33;case"biweekly":return e+a*2.17;case"monthly":return e+a;case"quarterly":return e+a/3;case"semiannually":return e+a/6;case"annually":return e+a/12;default:return e+a}},0)),S={active:["paused","cancelled"],paused:["active","cancelled"],cancelled:[],expired:[]},w=[{value:"weekly",label:"Weekly",days:7},{value:"biweekly",label:"Bi-weekly",days:14},{value:"monthly",label:"Monthly",days:30},{value:"quarterly",label:"Quarterly",days:90},{value:"semiannually",label:"Semi-annually",days:182},{value:"annually",label:"Annually",days:365}];async function $(e={}){var t,a;u.value=!0,l.value=null;try{const r=await v.get("/api/recurring-invoices",{params:e});return c.value=r.data.data||[],c.value}catch(r){throw l.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch recurring invoices",r}finally{u.value=!1}}async function k(e){var t,a;u.value=!0,l.value=null;try{const r=await v.get(`/api/recurring-invoices/${e}`);return i.value=r.data.data,i.value}catch(r){throw l.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch recurring invoice",r}finally{u.value=!1}}async function q(e){var t,a;u.value=!0,l.value=null;try{const n=(await v.post("/api/recurring-invoices",e)).data.data;return c.value.unshift(n),n}catch(r){throw l.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to create recurring invoice",r}finally{u.value=!1}}async function C(e,t){var a,r,n;u.value=!0,l.value=null;try{const o=(await v.put(`/api/recurring-invoices/${e}`,t)).data.data,d=c.value.findIndex(_=>_.id===e);return d!==-1&&(c.value[d]=o),((a=i.value)==null?void 0:a.id)===e&&(i.value=o),o}catch(s){throw l.value=((n=(r=s.response)==null?void 0:r.data)==null?void 0:n.error)||"Failed to update recurring invoice",s}finally{u.value=!1}}async function L(e){var t,a,r;u.value=!0,l.value=null;try{return await v.delete(`/api/recurring-invoices/${e}`),c.value=c.value.filter(n=>n.id!==e),((t=i.value)==null?void 0:t.id)===e&&(i.value=null),!0}catch(n){throw l.value=((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to delete recurring invoice",n}finally{u.value=!1}}async function T(e){var t,a,r;u.value=!0,l.value=null;try{const s=(await v.post(`/api/recurring-invoices/${e}/pause`)).data.data,o=c.value.findIndex(d=>d.id===e);return o!==-1&&(c.value[o]=s),((t=i.value)==null?void 0:t.id)===e&&(i.value=s),s}catch(n){throw l.value=((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to pause schedule",n}finally{u.value=!1}}async function D(e){var t,a,r;u.value=!0,l.value=null;try{const s=(await v.post(`/api/recurring-invoices/${e}/resume`)).data.data,o=c.value.findIndex(d=>d.id===e);return o!==-1&&(c.value[o]=s),((t=i.value)==null?void 0:t.id)===e&&(i.value=s),s}catch(n){throw l.value=((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to resume schedule",n}finally{u.value=!1}}async function A(e){var t,a,r;u.value=!0,l.value=null;try{const s=(await v.post(`/api/recurring-invoices/${e}/cancel`)).data.data,o=c.value.findIndex(d=>d.id===e);return o!==-1&&(c.value[o]=s),((t=i.value)==null?void 0:t.id)===e&&(i.value=s),s}catch(n){throw l.value=((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to cancel schedule",n}finally{u.value=!1}}async function N(e){var t,a;u.value=!0,l.value=null;try{return(await v.post(`/api/recurring-invoices/${e}/generate`)).data.data}catch(r){throw l.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to generate invoice",r}finally{u.value=!1}}async function R(e=30){var t,a;u.value=!0,l.value=null;try{const r=await v.get("/api/recurring-invoices/upcoming",{params:{days:e}});return y.value=r.data.data||[],y.value}catch(r){throw l.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch upcoming invoices",r}finally{u.value=!1}}async function B(e){var t,a;u.value=!0,l.value=null;try{return(await v.get(`/api/recurring-invoices/${e}/invoices`)).data.data||[]}catch(r){throw l.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch generated invoices",r}finally{u.value=!1}}function E(e,t){return(S[e]||[]).includes(t)}function G(e){return S[e]||[]}function J(e){const t=w.find(a=>a.value===e);return(t==null?void 0:t.label)||e}function M(e,t){const a=new Date(e),r=w.find(n=>n.value===t);return r&&a.setDate(a.getDate()+r.days),a}function Q(e){h.value=e}function U(){l.value=null}function W(){c.value=[],i.value=null,y.value=[],u.value=!1,l.value=null,h.value=""}return{schedules:c,currentSchedule:i,upcomingInvoices:y,loading:u,error:l,searchTerm:h,activeSchedules:g,pausedSchedules:m,expiredSchedules:x,filteredSchedules:F,scheduleCount:b,monthlyRevenue:I,frequencies:w,fetchSchedules:$,fetchSchedule:k,createSchedule:q,updateSchedule:C,deleteSchedule:L,pauseSchedule:T,resumeSchedule:D,cancelSchedule:A,generateNow:N,fetchUpcoming:R,fetchGeneratedInvoices:B,canTransitionTo:E,getAvailableStatuses:G,getFrequencyLabel:J,calculateNextDate:M,setSearchTerm:Q,clearError:U,reset:W}});export{K as u};
