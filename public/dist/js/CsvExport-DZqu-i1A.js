import{_ as U,b as D,h as z,i as V,r as i,q as B,o as g,e,d as o,l as N,j as k,c as u,w as p,z as O,t as h,F as q,g as R,E as M,v as C,n as H}from"./main-DU1UAF-x.js";import{a as _}from"./index-B9ygI19o.js";import{A as I}from"./AdminLayout-Baccdx-S.js";const Q={__name:"CsvExport",setup(A,{expose:t}){t();const x=i(""),r=i([]),l=i([]),f=i({search:"",active_only:!1,created_after:"",created_before:""}),v=i(!1),a=i(!1),s=i(null),w=i(!1),E=B(()=>r.value.length>0&&l.value.length===r.value.length);function T(){E.value?l.value=[]:l.value=r.value.map(d=>d.name)}async function F(){var d,y;if(!x.value){r.value=[],l.value=[];return}v.value=!0,s.value=null;try{const b=(await _.get("/api/csv/export/fields",{params:{type:x.value}})).data.fields||{};r.value=Object.entries(b).map(([c,n])=>({name:c,label:n})),l.value=r.value.map(c=>c.name)}catch(m){s.value=((y=(d=m.response)==null?void 0:d.data)==null?void 0:y.error)||"Failed to load fields",r.value=[],l.value=[]}finally{v.value=!1}}async function S(){var d,y,m;if(!(!x.value||l.value.length===0)){a.value=!0,s.value=null,w.value=!1;try{const b=await _.post("/api/csv/export",{entity_type:x.value,fields:l.value,...f.value},{responseType:"blob"}),c=window.URL.createObjectURL(new Blob([b.data])),n=document.createElement("a");n.href=c,n.setAttribute("download",`${x.value}_export_${new Date().toISOString().slice(0,10)}.csv`),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(c),w.value=!0,setTimeout(()=>{w.value=!1},5e3)}catch(b){if(((d=b.response)==null?void 0:d.data)instanceof Blob){const c=await b.response.data.text();try{const n=JSON.parse(c);s.value=n.error||"Failed to export data"}catch{s.value="Failed to export data"}}else s.value=((m=(y=b.response)==null?void 0:y.data)==null?void 0:m.error)||"Failed to export data"}finally{a.value=!1}}}async function L(d){x.value=d,await F(),l.value=r.value.map(y=>y.name),f.value={search:"",active_only:!1,created_after:"",created_before:""},await S()}const j={entityType:x,availableFields:r,selectedFields:l,filters:f,loading:v,exporting:a,error:s,success:w,allFieldsSelected:E,toggleAllFields:T,loadFields:F,exportData:S,quickExport:L,ref:i,computed:B,get axios(){return _},AdminLayout:I};return Object.defineProperty(j,"__isScriptSetup",{enumerable:!1,value:!0}),j}},J={class:"space-y-6"},P={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},Y={class:"rounded-xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-gray-900"},G={class:"space-y-6"},K={key:0},W={class:"flex items-center justify-between mb-2"},X={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 p-4 border border-gray-200 rounded-lg dark:border-gray-700"},Z=["value"],$={class:"text-sm text-gray-700 dark:text-gray-300"},ee={key:1},te={class:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 border border-gray-200 rounded-lg dark:border-gray-700"},re={class:"flex items-center gap-2 mt-2"},ae={key:2,class:"p-4 rounded-lg bg-red-50 dark:bg-red-900/20"},le={class:"text-sm text-red-700 dark:text-red-400"},oe={key:3,class:"p-4 rounded-lg bg-green-50 dark:bg-green-900/20"},se={class:"flex justify-end"},de=["disabled"],ne={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},ie={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ge={class:"rounded-xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-gray-900"},xe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ce=["disabled"],ue=["disabled"],ye=["disabled"];function be(A,t,x,r,l,f){const v=D("router-link");return g(),z(r.AdminLayout,null,{default:V(()=>[e("div",J,[e("div",P,[t[10]||(t[10]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Export Data"),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"Export clients, contacts, or notes to CSV files")],-1)),N(v,{to:"/crm/csv/import",class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700"},{default:V(()=>[...t[9]||(t[9]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1),k(" Import Data ",-1)])]),_:1})]),e("div",Y,[e("div",G,[o(" Entity Type Selection "),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Entity Type",-1)),p(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>r.entityType=a),onChange:r.loadFields,class:"w-full px-4 py-2 border border-gray-300 rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"},[...t[11]||(t[11]=[e("option",{value:""},"Select type to export...",-1),e("option",{value:"clients"},"Clients",-1),e("option",{value:"contacts"},"Contacts",-1),e("option",{value:"notes"},"Notes",-1)])],544),[[O,r.entityType]])]),o(" Field Selection "),r.entityType&&r.availableFields.length>0?(g(),u("div",K,[e("div",W,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Fields to Export",-1)),e("button",{onClick:r.toggleAllFields,type:"button",class:"text-sm text-brand-600 hover:underline"},h(r.allFieldsSelected?"Deselect All":"Select All"),1)]),e("div",X,[(g(!0),u(q,null,R(r.availableFields,a=>(g(),u("label",{key:a.name,class:"flex items-center gap-2"},[p(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=s=>r.selectedFields=s),value:a.name,class:"rounded border-gray-300 text-brand-600 focus:ring-brand-500"},null,8,Z),[[M,r.selectedFields]]),e("span",$,h(a.label||a.name),1)]))),128))])])):o("v-if",!0),o(" Filters "),r.entityType?(g(),u("div",ee,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Filters (Optional)",-1)),e("div",te,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Search",-1)),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>r.filters.search=a),type:"text",placeholder:"Search in records...",class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,512),[[C,r.filters.search]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Status",-1)),e("label",re,[p(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=a=>r.filters.active_only=a),class:"rounded border-gray-300 text-brand-600 focus:ring-brand-500"},null,512),[[M,r.filters.active_only]]),t[15]||(t[15]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"Active records only",-1))])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Created After",-1)),p(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>r.filters.created_after=a),type:"date",class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,512),[[C,r.filters.created_after]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-xs text-gray-500 dark:text-gray-400 mb-1"},"Created Before",-1)),p(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>r.filters.created_before=a),type:"date",class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,512),[[C,r.filters.created_before]])])])])):o("v-if",!0),o(" Error Display "),r.error?(g(),u("div",ae,[e("p",le,h(r.error),1)])):o("v-if",!0),o(" Success Message "),r.success?(g(),u("div",oe,[...t[20]||(t[20]=[e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-5 h-5 text-green-600",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),e("p",{class:"text-sm text-green-700 dark:text-green-400"},"Export started! Your download should begin shortly.")],-1)])])):o("v-if",!0),o(" Export Button "),e("div",se,[e("button",{onClick:r.exportData,disabled:!r.entityType||r.selectedFields.length===0||r.exporting,class:H(["px-6 py-2 text-sm font-medium text-white rounded-lg flex items-center gap-2",!r.entityType||r.selectedFields.length===0||r.exporting?"bg-gray-400 cursor-not-allowed":"bg-brand-600 hover:bg-brand-700"])},[r.exporting?(g(),u("svg",ne,[...t[21]||(t[21]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(g(),u("svg",ie,[...t[22]||(t[22]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])])),k(" "+h(r.exporting?"Exporting...":"Export to CSV"),1)],10,de)])])]),o(" Quick Export Links "),e("div",ge,[t[26]||(t[26]=e("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Quick Export",-1)),t[27]||(t[27]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-4"},"Export all data with default fields",-1)),e("div",xe,[e("button",{onClick:t[6]||(t[6]=a=>r.quickExport("clients")),disabled:r.exporting,class:"flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-gray-700 bg-gray-50 border border-gray-200 rounded-lg hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700 dark:hover:bg-gray-700"},[...t[23]||(t[23]=[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1),k(" Export All Clients ",-1)])],8,ce),e("button",{onClick:t[7]||(t[7]=a=>r.quickExport("contacts")),disabled:r.exporting,class:"flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-gray-700 bg-gray-50 border border-gray-200 rounded-lg hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700 dark:hover:bg-gray-700"},[...t[24]||(t[24]=[e("svg",{class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1),k(" Export All Contacts ",-1)])],8,ue),e("button",{onClick:t[8]||(t[8]=a=>r.quickExport("notes")),disabled:r.exporting,class:"flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-gray-700 bg-gray-50 border border-gray-200 rounded-lg hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700 dark:hover:bg-gray-700"},[...t[25]||(t[25]=[e("svg",{class:"w-5 h-5 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),k(" Export All Notes ",-1)])],8,ye)])])])]),_:1})}const ke=U(Q,[["render",be],["__file","/home/btafoya/projects/openclient/resources/js/src/views/CRM/CSV/CsvExport.vue"]]);export{ke as default};
