import{_ as F,b as H,c as n,l as C,d as i,e as t,w as d,j as m,z as V,F as w,g as h,v as p,a as z,t as v,E as O,i as Q,C as G,I as U,H as q,r as y,q as P,k as j,o as u}from"./main-DU5QQqOg.js";import{u as M}from"./proposals-CGDc7SOs.js";import{u as T}from"./clients-C2hMtF4k.js";import{P as J}from"./PageBreadcrumb-Bc2RP6vt.js";import"./index-B9ygI19o.js";const K={__name:"ProposalEdit",setup(I,{expose:e}){e();const b=U(),o=q(),x=M(),f=T(),k=y(!0),r=y(!1),g=y(""),s=y([]),c=y({client_id:"",title:"",valid_until:"",status:"draft",sections:[],items:[],terms:"",notes:"",require_signature:!0}),_=P(()=>c.value.items.reduce((l,a)=>l+a.quantity*a.rate,0));function B(l){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(l||0)}function A(){c.value.sections.push({title:"",content:""})}function N(l){c.value.sections.splice(l,1)}function E(){c.value.items.push({description:"",quantity:1,rate:0})}function L(l){c.value.items.splice(l,1)}async function R(){var l,a;r.value=!0,g.value="";try{await x.updateProposal(b.params.id,{...c.value,total:_.value}),o.push(`/proposals/${b.params.id}`)}catch(D){g.value=((a=(l=D.response)==null?void 0:l.data)==null?void 0:a.error)||"Failed to update proposal"}finally{r.value=!1}}j(async()=>{var l;try{await f.fetchClients(),s.value=f.clients;const a=await x.fetchProposal(b.params.id);c.value={client_id:a.client_id,title:a.title,valid_until:((l=a.valid_until)==null?void 0:l.split("T")[0])||"",status:a.status,sections:a.sections||[],items:a.items||[{description:"",quantity:1,rate:0}],terms:a.terms||"",notes:a.notes||"",require_signature:a.require_signature??!0}}catch(a){console.error("Failed to load proposal:",a)}finally{k.value=!1}});const S={route:b,router:o,proposalStore:x,clientStore:f,loading:k,saving:r,error:g,clients:s,form:c,total:_,formatCurrency:B,addSection:A,removeSection:N,addItem:E,removeItem:L,handleSubmit:R,ref:y,computed:P,onMounted:j,get useRoute(){return U},get useRouter(){return q},get useProposalStore(){return M},get useClientStore(){return T},PageBreadcrumb:J};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}},W={key:0,class:"flex items-center justify-center py-12"},X={key:1,class:"rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-6"},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Z=["value"],$={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},tt={class:"space-y-4"},et={class:"flex items-center justify-between mb-3"},rt=["onUpdate:modelValue"],ot=["onClick"],at=["onUpdate:modelValue"],st={class:"overflow-x-auto"},lt={class:"w-full text-sm"},dt={class:"px-4 py-2"},nt=["onUpdate:modelValue"],it={class:"px-4 py-2"},ut=["onUpdate:modelValue"],gt={class:"px-4 py-2"},pt=["onUpdate:modelValue"],ct={class:"px-4 py-2 text-right font-medium text-gray-900 dark:text-white"},mt={class:"px-4 py-2"},yt=["onClick"],bt={class:"bg-gray-50 dark:bg-gray-800"},xt={class:"px-4 py-3 text-right font-bold text-lg text-gray-900 dark:text-white"},ft={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},kt={class:"border-t dark:border-gray-700 pt-6"},vt={class:"flex items-center gap-3"},wt={key:0,class:"p-4 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400"},ht={class:"flex items-center justify-end gap-4 pt-4 border-t dark:border-gray-700"},_t=["disabled"],St={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"};function Ct(I,e,b,o,x,f){const k=H("router-link");return u(),n("div",null,[C(o.PageBreadcrumb,{pageTitle:"Edit Proposal"}),i(" Loading State "),o.loading?(u(),n("div",W,[...e[7]||(e[7]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-500"},null,-1)])])):(u(),n("div",X,[t("form",{onSubmit:G(o.handleSubmit,["prevent"]),class:"space-y-6"},[i(" Client Selection "),t("div",Y,[t("div",null,[e[9]||(e[9]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"},[m(" Client "),t("span",{class:"text-red-500"},"*")],-1)),d(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.client_id=r),required:"",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},[e[8]||(e[8]=t("option",{value:""},"Select Client",-1)),(u(!0),n(w,null,h(o.clients,r=>(u(),n("option",{key:r.id,value:r.id},v(r.company_name||r.name),9,Z))),128))],512),[[V,o.form.client_id]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"},[m(" Title "),t("span",{class:"text-red-500"},"*")],-1)),d(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.title=r),type:"text",required:"",placeholder:"Proposal Title",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,512),[[p,o.form.title]])])]),i(" Dates "),t("div",$,[t("div",null,[e[11]||(e[11]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"},[m(" Valid Until "),t("span",{class:"text-red-500"},"*")],-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.valid_until=r),type:"date",required:"",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,512),[[p,o.form.valid_until]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Status ",-1)),d(t("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.status=r),class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},[...e[12]||(e[12]=[z('<option value="draft">Draft</option><option value="sent">Sent</option><option value="viewed">Viewed</option><option value="accepted">Accepted</option><option value="rejected">Rejected</option>',5)])],512),[[V,o.form.status]])])]),i(" Content Sections "),t("div",null,[e[16]||(e[16]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Proposal Content ",-1)),t("div",tt,[(u(!0),n(w,null,h(o.form.sections,(r,g)=>(u(),n("div",{key:g,class:"border border-gray-200 dark:border-gray-700 rounded-lg p-4"},[t("div",et,[d(t("input",{"onUpdate:modelValue":s=>r.title=s,type:"text",placeholder:"Section Title",class:"flex-1 rounded-lg border border-gray-300 dark:border-gray-600 px-3 py-2 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,8,rt),[[p,r.title]]),t("button",{type:"button",onClick:s=>o.removeSection(g),class:"ml-2 p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg"},[...e[14]||(e[14]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ot)]),d(t("textarea",{"onUpdate:modelValue":s=>r.content=s,rows:"4",placeholder:"Section content...",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-3 py-2 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,8,at),[[p,r.content]])]))),128)),t("button",{type:"button",onClick:o.addSection,class:"flex items-center gap-2 text-brand-600 hover:text-brand-700"},[...e[15]||(e[15]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),m(" Add Section ",-1)])])])]),i(" Line Items "),t("div",null,[e[21]||(e[21]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Pricing / Line Items ",-1)),t("div",st,[t("table",lt,[e[20]||(e[20]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left"},"Description"),t("th",{class:"px-4 py-3 text-right w-24"},"Qty"),t("th",{class:"px-4 py-3 text-right w-32"},"Rate"),t("th",{class:"px-4 py-3 text-right w-32"},"Amount"),t("th",{class:"px-4 py-3 w-12"})])],-1)),t("tbody",null,[(u(!0),n(w,null,h(o.form.items,(r,g)=>(u(),n("tr",{key:g,class:"border-b dark:border-gray-700"},[t("td",dt,[d(t("input",{"onUpdate:modelValue":s=>r.description=s,type:"text",placeholder:"Item description",class:"w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 text-gray-900 dark:text-white px-2 py-1"},null,8,nt),[[p,r.description]])]),t("td",it,[d(t("input",{"onUpdate:modelValue":s=>r.quantity=s,type:"number",min:"1",class:"w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 text-gray-900 dark:text-white px-2 py-1 text-right"},null,8,ut),[[p,r.quantity,void 0,{number:!0}]])]),t("td",gt,[d(t("input",{"onUpdate:modelValue":s=>r.rate=s,type:"number",step:"0.01",min:"0",class:"w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 text-gray-900 dark:text-white px-2 py-1 text-right"},null,8,pt),[[p,r.rate,void 0,{number:!0}]])]),t("td",ct,v(o.formatCurrency(r.quantity*r.rate)),1),t("td",mt,[t("button",{type:"button",onClick:s=>o.removeItem(g),class:"p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded"},[...e[17]||(e[17]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,yt)])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",{colspan:"5",class:"px-4 py-2"},[t("button",{type:"button",onClick:o.addItem,class:"text-sm text-brand-600 hover:text-brand-700"}," + Add Line Item ")])]),t("tr",bt,[e[18]||(e[18]=t("td",{colspan:"3",class:"px-4 py-3 text-right font-medium"},"Total:",-1)),t("td",xt,v(o.formatCurrency(o.total)),1),e[19]||(e[19]=t("td",null,null,-1))])])])])]),i(" Terms & Notes "),t("div",ft,[t("div",null,[e[22]||(e[22]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Terms & Conditions ",-1)),d(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.terms=r),rows:"4",placeholder:"Terms and conditions...",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,512),[[p,o.form.terms]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-300"}," Notes ",-1)),d(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.notes=r),rows:"4",placeholder:"Additional notes...",class:"w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2.5 text-gray-900 dark:text-white dark:bg-gray-800 focus:ring-2 focus:ring-brand-500"},null,512),[[p,o.form.notes]])])]),i(" Signature Settings "),t("div",kt,[t("label",vt,[d(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.form.require_signature=r),type:"checkbox",class:"rounded border-gray-300 text-brand-600 focus:ring-brand-500"},null,512),[[O,o.form.require_signature]]),e[24]||(e[24]=t("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"Require electronic signature for acceptance",-1))])]),i(" Error Message "),o.error?(u(),n("div",wt,v(o.error),1)):i("v-if",!0),i(" Actions "),t("div",ht,[C(k,{to:`/proposals/${o.route.params.id}`,class:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg"},{default:Q(()=>[...e[25]||(e[25]=[m(" Cancel ",-1)])]),_:1},8,["to"]),t("button",{type:"submit",disabled:o.saving,class:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2"},[o.saving?(u(),n("svg",St,[...e[26]||(e[26]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):i("v-if",!0),e[27]||(e[27]=m(" Save Changes ",-1))],8,_t)])],32)]))])}const Mt=F(K,[["render",Ct],["__file","/home/btafoya/projects/openclient/resources/js/src/views/Proposals/ProposalEdit.vue"]]);export{Mt as default};
