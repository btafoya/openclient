import{J as q,r as y,q as x,_ as J,b as R,h as U,i as S,k as F,o as v,e as t,l as G,j as K,w as O,v as Q,c as _,F as W,g as X,t as L,d as Y}from"./main-SWmWNSpG.js";import{a as p}from"./index-B9ygI19o.js";import{A as Z}from"./AdminLayout-p298wg5X.js";const j=q("contacts",()=>{const i=y([]),s=y(null),o=y(!1),a=y(null),f=y(""),m=x(()=>i.value.filter(e=>e.is_active)),k=x(()=>i.value.filter(e=>e.is_primary&&e.is_active)),u=x(()=>{if(!f.value)return i.value;const e=f.value.toLowerCase();return i.value.filter(n=>{var l,r,c,d;return((l=n.first_name)==null?void 0:l.toLowerCase().includes(e))||((r=n.last_name)==null?void 0:r.toLowerCase().includes(e))||((c=n.email)==null?void 0:c.toLowerCase().includes(e))||((d=n.job_title)==null?void 0:d.toLowerCase().includes(e))})}),w=x(()=>i.value.length),C=x(()=>m.value.length);async function g(e=!0){var n,l;o.value=!0,a.value=null;try{const r=await p.get("/api/contacts",{params:{active_only:e}});return i.value=r.data.data||[],i.value}catch(r){throw a.value=((l=(n=r.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to fetch contacts",r}finally{o.value=!1}}async function N(e){var n,l;o.value=!0,a.value=null;try{const r=await p.get(`/api/contacts/${e}`);return s.value=r.data.data,s.value}catch(r){throw a.value=((l=(n=r.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to fetch contact",r}finally{o.value=!1}}async function B(e,n=!0){var l,r;o.value=!0,a.value=null;try{return(await p.get(`/api/clients/${e}/contacts`,{params:{active_only:n}})).data.data||[]}catch(c){throw a.value=((r=(l=c.response)==null?void 0:l.data)==null?void 0:r.message)||"Failed to fetch client contacts",c}finally{o.value=!1}}async function M(e){try{return(await p.get(`/api/clients/${e}/contacts/primary`)).data.data}catch{return null}}async function T(e){var n,l;o.value=!0,a.value=null;try{const c=(await p.post("/api/contacts",e)).data.data;return i.value.push(c),c}catch(r){throw a.value=((l=(n=r.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to create contact",r}finally{o.value=!1}}async function E(e,n){var l,r,c;o.value=!0,a.value=null;try{const h=(await p.put(`/api/contacts/${e}`,n)).data.data,b=i.value.findIndex(z=>z.id===e);return b!==-1&&(i.value[b]=h),((l=s.value)==null?void 0:l.id)===e&&(s.value=h),h}catch(d){throw a.value=((c=(r=d.response)==null?void 0:r.data)==null?void 0:c.message)||"Failed to update contact",d}finally{o.value=!1}}async function A(e,n=!1){var l,r,c;o.value=!0,a.value=null;try{return await p.delete(`/api/contacts/${e}`,{params:{purge:n}}),i.value=i.value.filter(d=>d.id!==e),((l=s.value)==null?void 0:l.id)===e&&(s.value=null),!0}catch(d){throw a.value=((c=(r=d.response)==null?void 0:r.data)==null?void 0:c.message)||"Failed to delete contact",d}finally{o.value=!1}}async function D(e){var n,l,r;o.value=!0,a.value=null;try{const d=(await p.post(`/api/contacts/${e}/toggle-active`)).data.data,h=i.value.findIndex(b=>b.id===e);return h!==-1&&(i.value[h]=d),((n=s.value)==null?void 0:n.id)===e&&(s.value=d),d}catch(c){throw a.value=((r=(l=c.response)==null?void 0:l.data)==null?void 0:r.message)||"Failed to toggle contact status",c}finally{o.value=!1}}async function V(e,n=!0){var l,r;if(!e)return g(n);o.value=!0,a.value=null;try{const c=await p.get("/api/contacts/search",{params:{term:e,active_only:n}});return i.value=c.data.data||[],i.value}catch(c){throw a.value=((r=(l=c.response)==null?void 0:l.data)==null?void 0:r.message)||"Failed to search contacts",c}finally{o.value=!1}}function P(e){return e?`${e.first_name||""} ${e.last_name||""}`.trim():""}function $(e){f.value=e}function H(){a.value=null}function I(){i.value=[],s.value=null,o.value=!1,a.value=null,f.value=""}return{contacts:i,currentContact:s,loading:o,error:a,searchTerm:f,activeContacts:m,primaryContacts:k,filteredContacts:u,contactCount:w,activeContactCount:C,fetchContacts:g,fetchContact:N,fetchContactsByClient:B,fetchPrimaryContact:M,createContact:T,updateContact:E,deleteContact:A,toggleActive:D,searchContacts:V,getFullName:P,setSearchTerm:$,clearError:H,reset:I}}),tt={__name:"ContactList",setup(i,{expose:s}){s();const o=j(),a=y(""),f=x(()=>o.filteredContacts);async function m(){await o.fetchContacts()}function k(){o.setSearchTerm(a.value)}function u(g){alert("Edit contact functionality to be implemented")}async function w(g){confirm(`Delete contact ${o.getFullName(g)}?`)&&await o.deleteContact(g.id)}F(()=>m());const C={contactStore:o,searchTerm:a,displayedContacts:f,loadContacts:m,handleSearch:k,handleEdit:u,confirmDelete:w,ref:y,computed:x,onMounted:F,get useContactStore(){return j},AdminLayout:Z};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}},et={class:"space-y-6"},at={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},st={class:"flex flex-col gap-4 sm:flex-row sm:items-center"},rt={class:"flex-1 relative"},nt={class:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},ot={key:0,class:"p-8 text-center"},lt={key:1,class:"p-8 text-center"},ct={key:2,class:"min-w-full"},it={class:"divide-y divide-gray-200 dark:divide-gray-700"},dt={class:"px-5 py-4"},ut={class:"font-medium text-gray-800 dark:text-white"},pt={class:"px-5 py-4 text-sm text-gray-700 dark:text-gray-300"},ft={class:"px-5 py-4 text-sm text-gray-700 dark:text-gray-300"},vt={class:"px-5 py-4 text-sm text-gray-700 dark:text-gray-300"},yt={class:"px-5 py-4"},xt={key:0,class:"inline-flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400"},mt={class:"px-5 py-4"},gt={class:"flex items-center justify-end gap-2"},ht=["onClick"],_t=["onClick"];function kt(i,s,o,a,f,m){const k=R("router-link");return v(),U(a.AdminLayout,null,{default:S(()=>[t("div",et,[t("div",at,[s[2]||(s[2]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Contacts"),t("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"Manage your client contacts")],-1)),G(k,{to:"/crm/contacts/create",class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-brand-600 rounded-lg hover:bg-brand-700"},{default:S(()=>[...s[1]||(s[1]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),K(" New Contact ",-1)])]),_:1})]),t("div",st,[t("div",rt,[O(t("input",{"onUpdate:modelValue":s[0]||(s[0]=u=>a.searchTerm=u),onInput:a.handleSearch,type:"text",placeholder:"Search contacts...",class:"w-full px-4 py-2 pl-10 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 dark:bg-gray-800 dark:border-gray-600 dark:text-white"},null,544),[[Q,a.searchTerm]]),s[3]||(s[3]=t("svg",{class:"absolute left-3 top-2.5 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),t("div",nt,[a.contactStore.loading?(v(),_("div",ot,[...s[4]||(s[4]=[t("div",{class:"inline-block w-8 h-8 border-4 border-brand-500 border-t-transparent rounded-full animate-spin"},null,-1),t("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"Loading...",-1)])])):a.displayedContacts.length===0?(v(),_("div",lt,[...s[5]||(s[5]=[t("p",{class:"text-sm text-gray-900 dark:text-white font-medium"},"No contacts found",-1)])])):(v(),_("table",ct,[s[8]||(s[8]=t("thead",null,[t("tr",{class:"border-b border-gray-200 dark:border-gray-700"},[t("th",{class:"px-5 py-3 text-left"},[t("p",{class:"font-medium text-gray-500 text-xs dark:text-gray-400"},"Name")]),t("th",{class:"px-5 py-3 text-left"},[t("p",{class:"font-medium text-gray-500 text-xs dark:text-gray-400"},"Email")]),t("th",{class:"px-5 py-3 text-left"},[t("p",{class:"font-medium text-gray-500 text-xs dark:text-gray-400"},"Phone")]),t("th",{class:"px-5 py-3 text-left"},[t("p",{class:"font-medium text-gray-500 text-xs dark:text-gray-400"},"Client")]),t("th",{class:"px-5 py-3 text-left"},[t("p",{class:"font-medium text-gray-500 text-xs dark:text-gray-400"},"Primary")]),t("th",{class:"px-5 py-3 text-right"},[t("p",{class:"font-medium text-gray-500 text-xs dark:text-gray-400"},"Actions")])])],-1)),t("tbody",it,[(v(!0),_(W,null,X(a.displayedContacts,u=>(v(),_("tr",{key:u.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800/50"},[t("td",dt,[t("span",ut,L(a.contactStore.getFullName(u)),1)]),t("td",pt,L(u.email||"—"),1),t("td",ft,L(u.phone||"—"),1),t("td",vt,L(u.client_name||"—"),1),t("td",yt,[u.is_primary?(v(),_("span",xt,"Primary")):Y("v-if",!0)]),t("td",mt,[t("div",gt,[t("button",{onClick:w=>a.handleEdit(u),class:"p-1.5 text-gray-600 hover:text-brand-600 dark:text-gray-400",title:"Edit"},[...s[6]||(s[6]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,ht),t("button",{onClick:w=>a.confirmDelete(u),class:"p-1.5 text-gray-600 hover:text-red-600 dark:text-gray-400",title:"Delete"},[...s[7]||(s[7]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,_t)])])]))),128))])]))])])]),_:1})}const Lt=J(tt,[["render",kt],["__file","/home/btafoya/projects/openclient/resources/js/src/views/CRM/Contacts/ContactList.vue"]]);export{Lt as default};
