import{J as B,r as v,q as m}from"./main-DbkULGVR.js";import{a as d}from"./index-B9ygI19o.js";var j="clover",O=function(r){return r===3?"v3":r},R="https://js.stripe.com",z="".concat(R,"/").concat(j,"/stripe.js"),K=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,H=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var Q=function(r){return K.test(r)||H.test(r)},Y=function(){for(var r=document.querySelectorAll('script[src^="'.concat(R,'"]')),n=0;n<r.length;n++){var o=r[n];if(Q(o.src))return o}return null},L=function(r){var n="",o=document.createElement("script");o.src="".concat(z).concat(n);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(o),o},Z=function(r,n){!r||!r._registerWrapper||r._registerWrapper({name:"stripe-js",version:"8.5.3",startTime:n})},h=null,w=null,P=null,ee=function(r){return function(n){r(new Error("Failed to load Stripe.js",{cause:n}))}},te=function(r,n){return function(){window.Stripe?r(window.Stripe):n(new Error("Stripe.js not available"))}},re=function(r){return h!==null?h:(h=new Promise(function(n,o){if(typeof window>"u"||typeof document>"u"){n(null);return}if(window.Stripe){n(window.Stripe);return}try{var s=Y();if(!(s&&r)){if(!s)s=L(r);else if(s&&P!==null&&w!==null){var l;s.removeEventListener("load",P),s.removeEventListener("error",w),(l=s.parentNode)===null||l===void 0||l.removeChild(s),s=L(r)}}P=te(n,o),w=ee(o),s.addEventListener("load",P),s.addEventListener("error",w)}catch(c){o(c);return}}),h.catch(function(n){return h=null,Promise.reject(n)}))},ae=function(r,n,o){if(r===null)return null;var s=n[0],l=s.match(/^pk_test/),c=O(r.version),f=j;l&&c!==f&&console.warn("Stripe.js@".concat(c," was loaded on the page, but @stripe/stripe-js@").concat("8.5.3"," expected Stripe.js@").concat(f,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var g=r.apply(void 0,n);return Z(g,o),g},S,C=!1,T=function(){return S||(S=re(null).catch(function(r){return S=null,Promise.reject(r)}),S)};Promise.resolve().then(function(){return T()}).catch(function(i){C||console.warn(i)});var ne=function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];C=!0;var s=Date.now();return T().then(function(l){return ae(l,n,s)})};const ie=B("payments",()=>{const i=v([]),r=v(null),n=v({total_payments:0,succeeded:0,failed:0,pending:0,refunded:0,total_collected:0,total_refunded:0}),o=v({publishable_key:null,configured:!1}),s=v(null),l=v(!1),c=v(null),f=v(!1),g=m(()=>i.value.filter(e=>e.status==="succeeded")),k=m(()=>i.value.filter(e=>e.status==="pending"||e.status==="processing")),I=m(()=>i.value.filter(e=>e.status==="failed")),U=m(()=>i.value.filter(e=>e.status==="refunded")),x=m(()=>o.value.configured);async function E(e={}){var a,u;l.value=!0,c.value=null;try{const t=new URLSearchParams;e.status&&t.append("status",e.status),e.from_date&&t.append("from_date",e.from_date),e.to_date&&t.append("to_date",e.to_date);const y=t.toString(),p=`/api/payments${y?"?"+y:""}`,F=await d.get(p);F.data.success&&(i.value=F.data.data)}catch(t){c.value=((u=(a=t.response)==null?void 0:a.data)==null?void 0:u.error)||"Failed to fetch payments",console.error("Failed to fetch payments:",t)}finally{l.value=!1}}async function $(e){var a,u;l.value=!0,c.value=null;try{const t=await d.get(`/api/payments/${e}`);if(t.data.success)return r.value=t.data.data,t.data.data}catch(t){c.value=((u=(a=t.response)==null?void 0:a.data)==null?void 0:u.error)||"Failed to fetch payment",console.error("Failed to fetch payment:",t)}finally{l.value=!1}return null}async function q(e){var a,u;l.value=!0,c.value=null;try{const t=await d.get(`/api/invoices/${e}/payments`);if(t.data.success)return t.data.data}catch(t){c.value=((u=(a=t.response)==null?void 0:a.data)==null?void 0:u.error)||"Failed to fetch invoice payments",console.error("Failed to fetch invoice payments:",t)}finally{l.value=!1}return[]}async function V(){try{const e=await d.get("/api/payments/stats");e.data.success&&(n.value=e.data.data)}catch(e){console.error("Failed to fetch payment stats:",e)}}async function b(){try{const e=await d.get("/api/payments/config");e.data.success&&(o.value=e.data.data,o.value.publishable_key&&(s.value=ne(o.value.publishable_key)))}catch(e){console.error("Failed to fetch Stripe config:",e),o.value={publishable_key:null,configured:!1}}}async function _(e){var a,u;f.value=!0,c.value=null;try{const t=await d.post("/api/payments/checkout",{invoice_id:e});if(t.data.success)return t.data.data}catch(t){throw c.value=((u=(a=t.response)==null?void 0:a.data)==null?void 0:u.error)||"Failed to create checkout session",console.error("Failed to create checkout session:",t),t}finally{f.value=!1}}async function A(e){var a,u;f.value=!0,c.value=null;try{s.value||await b();const t=await _(e);if(!t||!t.url)throw new Error("Invalid checkout session response");return window.location.href=t.url,t}catch(t){throw c.value=((u=(a=t.response)==null?void 0:a.data)==null?void 0:u.error)||t.message||"Failed to redirect to checkout",f.value=!1,t}}async function G(e){try{const a=await d.get(`/api/payments/success?session_id=${e}`);if(a.data.success)return a.data.data}catch(a){console.error("Failed to verify payment:",a)}return null}async function J(e=null){try{const a=e?`/api/payments/cancel?session_id=${e}`:"/api/payments/cancel";await d.get(a)}catch(a){console.error("Failed to handle payment cancel:",a)}}async function D(e,a=null,u="requested_by_customer"){var t,y;l.value=!0,c.value=null;try{const p=await d.post(`/api/payments/${e}/refund`,{amount:a,reason:u});if(p.data.success)return await E(),p.data.data}catch(p){throw c.value=((y=(t=p.response)==null?void 0:t.data)==null?void 0:y.error)||"Failed to process refund",console.error("Failed to process refund:",p),p}finally{l.value=!1}}async function W(){return s.value||await b(),s.value}function M(e){return{pending:{label:"Pending",color:"yellow"},processing:{label:"Processing",color:"blue"},succeeded:{label:"Paid",color:"green"},failed:{label:"Failed",color:"red"},refunded:{label:"Refunded",color:"gray"},cancelled:{label:"Cancelled",color:"gray"}}[e]||{label:e,color:"gray"}}function N(e,a="USD"){return new Intl.NumberFormat("en-US",{style:"currency",currency:a}).format(e)}function X(){i.value=[],r.value=null,c.value=null}return{payments:i,currentPayment:r,stats:n,stripeConfig:o,loading:l,error:c,processingPayment:f,succeededPayments:g,pendingPayments:k,failedPayments:I,refundedPayments:U,isStripeConfigured:x,fetchPayments:E,fetchPayment:$,fetchPaymentsByInvoice:q,fetchStats:V,fetchStripeConfig:b,createCheckoutSession:_,redirectToCheckout:A,verifyPaymentSuccess:G,handlePaymentCancel:J,refundPayment:D,getStripe:W,getStatusDisplay:M,formatCurrency:N,clearState:X}});export{ie as u};
