import{J as K,r as k,q as D,_ as I,c,e as a,d as C,n as G,t as g,j as P,o as f,w as N,v as Q,z as E,F as H,g as L,E as W,C as X,K as T,k as A}from"./main-DU1UAF-x.js";import{a as b}from"./index-B9ygI19o.js";import{u as O}from"./clients-DvlY7_j-.js";import{u as q}from"./contacts-BXh8S6Af.js";import{u as R}from"./projects-B-uUOWY7.js";const Fe=K("notes",()=>{const d=k([]),e=k(null),n=k(!1),t=k(null),p=D(()=>d.value.filter(l=>l.is_pinned)),x=D(()=>d.value.length),r=D(()=>(l,i)=>{if(!l||!i)return[];const s=`${l}_id`;return d.value.filter(o=>o[s]===i)});async function _(l={}){var i,s;n.value=!0,t.value=null;try{const o=await b.get("/api/notes",{params:l});return d.value=o.data.data||[],d.value}catch(o){throw t.value=((s=(i=o.response)==null?void 0:i.data)==null?void 0:s.message)||"Failed to fetch notes",o}finally{n.value=!1}}async function w(l){var i,s;n.value=!0,t.value=null;try{const o=await b.get(`/api/notes/${l}`);return e.value=o.data.data,e.value}catch(o){throw t.value=((s=(i=o.response)==null?void 0:i.data)==null?void 0:s.message)||"Failed to fetch note",o}finally{n.value=!1}}async function y(l){var i,s;n.value=!0,t.value=null;try{return(await b.get(`/api/clients/${l}/notes`)).data.data||[]}catch(o){throw t.value=((s=(i=o.response)==null?void 0:i.data)==null?void 0:s.message)||"Failed to fetch client notes",o}finally{n.value=!1}}async function S(l){var i,s;n.value=!0,t.value=null;try{return(await b.get(`/api/contacts/${l}/notes`)).data.data||[]}catch(o){throw t.value=((s=(i=o.response)==null?void 0:i.data)==null?void 0:s.message)||"Failed to fetch contact notes",o}finally{n.value=!1}}async function u(l){var i,s;n.value=!0,t.value=null;try{return(await b.get(`/api/projects/${l}/notes`)).data.data||[]}catch(o){throw t.value=((s=(i=o.response)==null?void 0:i.data)==null?void 0:s.message)||"Failed to fetch project notes",o}finally{n.value=!1}}async function V(l){var i,s;n.value=!0,t.value=null;try{const v=(await b.post("/api/notes",l)).data.data;return d.value.unshift(v),v}catch(o){throw t.value=((s=(i=o.response)==null?void 0:i.data)==null?void 0:s.message)||"Failed to create note",o}finally{n.value=!1}}async function B(l,i){var s,o,v;n.value=!0,t.value=null;try{const j=(await b.put(`/api/notes/${l}`,i)).data.data,F=d.value.findIndex(J=>J.id===l);return F!==-1&&(d.value[F]=j),((s=e.value)==null?void 0:s.id)===l&&(e.value=j),j}catch(m){throw t.value=((v=(o=m.response)==null?void 0:o.data)==null?void 0:v.message)||"Failed to update note",m}finally{n.value=!1}}async function z(l,i=!1){var s,o,v;n.value=!0,t.value=null;try{return await b.delete(`/api/notes/${l}`,{params:{purge:i}}),d.value=d.value.filter(m=>m.id!==l),((s=e.value)==null?void 0:s.id)===l&&(e.value=null),!0}catch(m){throw t.value=((v=(o=m.response)==null?void 0:o.data)==null?void 0:v.message)||"Failed to delete note",m}finally{n.value=!1}}async function U(l){var i,s,o;n.value=!0,t.value=null;try{const m=(await b.post(`/api/notes/${l}/toggle-pin`)).data.data,j=d.value.findIndex(F=>F.id===l);return j!==-1&&(d.value[j]=m),((i=e.value)==null?void 0:i.id)===l&&(e.value=m),m}catch(v){throw t.value=((o=(s=v.response)==null?void 0:s.data)==null?void 0:o.message)||"Failed to toggle pin status",v}finally{n.value=!1}}function M(){t.value=null}function h(){d.value=[],e.value=null,n.value=!1,t.value=null}return{notes:d,currentNote:e,loading:n,error:t,pinnedNotes:p,noteCount:x,notesByEntity:r,fetchNotes:_,fetchNote:w,fetchNotesByClient:y,fetchNotesByContact:S,fetchNotesByProject:u,createNote:V,updateNote:B,deleteNote:z,togglePin:U,clearError:M,reset:h}}),Y={__name:"NoteCard",props:{note:{type:Object,required:!0},showActions:{type:Boolean,default:!0},showPinButton:{type:Boolean,default:!0}},emits:["edit","delete","toggle-pin"],setup(d,{expose:e,emit:n}){e();const t=d,p=n;function x(){p("toggle-pin",t.note)}function r(){confirm("Are you sure you want to delete this note?")&&p("delete",t.note)}function _(y){return y?new Date(y).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}const w={props:t,emit:p,handleTogglePin:x,handleDelete:r,formatDate:_};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}},Z={class:"rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-800 dark:bg-gray-900"},$={class:"flex items-start justify-between gap-4"},ee={class:"flex-1 min-w-0"},te={class:"flex items-center gap-2"},ae=["title"],ne={key:1,class:"inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400"},oe={class:"mt-2 text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},re={class:"mt-3 flex flex-wrap items-center gap-3 text-xs text-gray-500 dark:text-gray-400"},le={key:0,class:"inline-flex items-center gap-1"},se={key:1,class:"inline-flex items-center gap-1"},ie={key:2,class:"inline-flex items-center gap-1"},de={class:"inline-flex items-center gap-1"},ue={key:3,class:"inline-flex items-center gap-1"},ce={key:0,class:"flex items-center gap-1 flex-shrink-0"};function fe(d,e,n,t,p,x){return f(),c("div",Z,[a("div",$,[a("div",ee,[a("div",te,[n.showPinButton?(f(),c("button",{key:0,onClick:t.handleTogglePin,class:G([n.note.is_pinned?"text-yellow-500":"text-gray-400 hover:text-yellow-500","flex-shrink-0"]),title:n.note.is_pinned?"Unpin note":"Pin note"},[...e[1]||(e[1]=[a("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{d:"M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"})],-1)])],10,ae)):C("v-if",!0),n.note.is_pinned?(f(),c("span",ne," Pinned ")):C("v-if",!0)]),a("p",oe,g(n.note.content),1),a("div",re,[n.note.client_name?(f(),c("span",le,[e[2]||(e[2]=a("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})],-1)),P(" "+g(n.note.client_name),1)])):C("v-if",!0),n.note.contact_name?(f(),c("span",se,[e[3]||(e[3]=a("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),P(" "+g(n.note.contact_name),1)])):C("v-if",!0),n.note.project_name?(f(),c("span",ie,[e[4]||(e[4]=a("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),P(" "+g(n.note.project_name),1)])):C("v-if",!0),a("span",de,[e[5]||(e[5]=a("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),P(" "+g(t.formatDate(n.note.created_at)),1)]),n.note.created_by_name?(f(),c("span",ue," by "+g(n.note.created_by_name),1)):C("v-if",!0)])]),n.showActions?(f(),c("div",ce,[a("button",{onClick:e[0]||(e[0]=r=>d.$emit("edit",n.note)),class:"p-1.5 text-gray-500 hover:text-brand-600 dark:text-gray-400 dark:hover:text-brand-400",title:"Edit"},[...e[6]||(e[6]=[a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])]),a("button",{onClick:t.handleDelete,class:"p-1.5 text-gray-500 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400",title:"Delete"},[...e[7]||(e[7]=[a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])])])):C("v-if",!0)])])}const Pe=I(Y,[["render",fe],["__file","/home/btafoya/projects/openclient/resources/js/src/views/CRM/Notes/NoteCard.vue"]]),ve={__name:"NoteForm",props:{initialData:{type:Object,default:()=>({})},submitText:{type:String,default:"Save Note"},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(d,{expose:e,emit:n}){e();const t=d,p=n,x=O(),r=q(),_=R(),w=k([]),y=k([]),S=k([]),u=k({content:"",client_id:"",contact_id:"",project_id:"",is_pinned:!1,...t.initialData}),V=D(()=>u.value.client_id?y.value.filter(h=>h.client_id===u.value.client_id):y.value);async function B(){try{await Promise.all([x.fetchClients(),r.fetchContacts(),_.fetchProjects()]),w.value=x.clients,y.value=r.contacts,S.value=_.projects||[]}catch(h){console.error("Failed to load form data:",h)}}function z(){if(u.value.client_id&&u.value.contact_id){const h=y.value.find(l=>l.id===u.value.contact_id);h&&h.client_id!==u.value.client_id&&(u.value.contact_id="")}}function U(){p("submit",{...u.value,client_id:u.value.client_id||null,contact_id:u.value.contact_id||null,project_id:u.value.project_id||null})}T(()=>t.initialData,h=>{u.value={...u.value,...h}},{deep:!0}),A(()=>B());const M={props:t,emit:p,clientStore:x,contactStore:r,projectStore:_,clients:w,contacts:y,projects:S,formData:u,filteredContacts:V,loadData:B,onClientChange:z,handleSubmit:U,ref:k,computed:D,onMounted:A,watch:T,get useClientStore(){return O},get useContactStore(){return q},get useProjectStore(){return R}};return Object.defineProperty(M,"__isScriptSetup",{enumerable:!1,value:!0}),M}},me={class:"rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-gray-900"},ge={class:"space-y-4"},pe={class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},ye=["value"],he=["disabled"],xe=["value"],be=["value"],ke={class:"flex items-center"},_e={class:"flex items-center"},we={class:"mt-6 flex gap-3"},Ce=["disabled"];function je(d,e,n,t,p,x){return f(),c("div",me,[a("form",{onSubmit:X(t.handleSubmit,["prevent"])},[a("div",ge,[a("div",null,[e[6]||(e[6]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Note Content *",-1)),N(a("textarea",{"onUpdate:modelValue":e[0]||(e[0]=r=>t.formData.content=r),rows:"4",required:"",placeholder:"Enter your note...",class:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-brand-500 focus:ring-brand-500 dark:border-gray-600 dark:bg-gray-800 dark:text-white"},null,512),[[Q,t.formData.content]])]),a("div",pe,[a("div",null,[e[8]||(e[8]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Client",-1)),N(a("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>t.formData.client_id=r),onChange:t.onClientChange,class:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-white"},[e[7]||(e[7]=a("option",{value:""},"None",-1)),(f(!0),c(H,null,L(t.clients,r=>(f(),c("option",{key:r.id,value:r.id},g(r.name),9,ye))),128))],544),[[E,t.formData.client_id]])]),a("div",null,[e[10]||(e[10]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Contact",-1)),N(a("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>t.formData.contact_id=r),disabled:!t.formData.client_id&&t.contacts.length===0,class:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm disabled:opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:text-white"},[e[9]||(e[9]=a("option",{value:""},"None",-1)),(f(!0),c(H,null,L(t.filteredContacts,r=>(f(),c("option",{key:r.id,value:r.id},g(r.first_name)+" "+g(r.last_name),9,xe))),128))],8,he),[[E,t.formData.contact_id]])]),a("div",null,[e[12]||(e[12]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Project",-1)),N(a("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>t.formData.project_id=r),class:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-white"},[e[11]||(e[11]=a("option",{value:""},"None",-1)),(f(!0),c(H,null,L(t.projects,r=>(f(),c("option",{key:r.id,value:r.id},g(r.name),9,be))),128))],512),[[E,t.formData.project_id]])])]),a("div",ke,[a("label",_e,[N(a("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>t.formData.is_pinned=r),type:"checkbox",class:"rounded border-gray-300 text-brand-600 focus:ring-brand-500"},null,512),[[W,t.formData.is_pinned]]),e[13]||(e[13]=a("span",{class:"ml-2 text-sm text-gray-700 dark:text-gray-300"},"Pin this note",-1))])])]),a("div",we,[a("button",{type:"submit",disabled:n.loading||!t.formData.content,class:"inline-flex items-center gap-2 rounded-lg bg-brand-600 px-4 py-2 text-sm font-medium text-white hover:bg-brand-700 disabled:opacity-50"},g(n.loading?"Saving...":n.submitText),9,Ce),a("button",{type:"button",onClick:e[5]||(e[5]=r=>d.$emit("cancel")),class:"inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"}," Cancel ")])],32)])}const Ve=I(ve,[["render",je],["__file","/home/btafoya/projects/openclient/resources/js/src/views/CRM/Notes/NoteForm.vue"]]);export{Ve as N,Pe as a,Fe as u};
